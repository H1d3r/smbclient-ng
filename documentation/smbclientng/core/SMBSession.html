<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.5.0"/>
    <title>smbclientng.core.SMBSession API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../core.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;smbclientng.core</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#SMBSession">SMBSession</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SMBSession.__init__">SMBSession</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.config">config</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.address">address</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.domain">domain</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.username">username</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.password">password</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.lmhash">lmhash</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.nthash">nthash</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.use_kerberos">use_kerberos</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.kdcHost">kdcHost</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.smbClient">smbClient</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.connected">connected</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.available_shares">available_shares</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.smb_share">smb_share</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.smb_cwd">smb_cwd</a>
                        </li>
                        <li>
                                <a class="variable" href="#SMBSession.smb_tree_id">smb_tree_id</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.init_smb_session">init_smb_session</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.close_smb_session">close_smb_session</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.read_file">read_file</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.find">find</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.get_file">get_file</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.get_file_recursively">get_file_recursively</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.get_entry">get_entry</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.info">info</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.list_contents">list_contents</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.list_shares">list_shares</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.mkdir">mkdir</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.mount">mount</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.path_exists">path_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.path_isdir">path_isdir</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.path_isfile">path_isfile</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.ping_smb_session">ping_smb_session</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.put_file">put_file</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.put_file_recursively">put_file_recursively</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.rmdir">rmdir</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.rm">rm</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.tree">tree</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.umount">umount</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.test_rights">test_rights</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.set_share">set_share</a>
                        </li>
                        <li>
                                <a class="function" href="#SMBSession.set_cwd">set_cwd</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../smbclientng.html">smbclientng</a><wbr>.<a href="./../core.html">core</a><wbr>.SMBSession    </h1>

                
                        <input id="mod-SMBSession-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-SMBSession-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="c1"># File name          : smbclient-ng.py</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="c1"># Author             : Podalirius (@podalirius_)</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="c1"># Date created       : 20 may 2024</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span> <span class="nn">io</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span> <span class="nn">impacket.smbconnection</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">import</span> <span class="nn">ntpath</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span> <span class="nn">random</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">import</span> <span class="nn">re</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span> <span class="nn">traceback</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">from</span> <span class="nn">smbclientng.core.LocalFileIO</span> <span class="kn">import</span> <span class="n">LocalFileIO</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">from</span> <span class="nn">smbclientng.core.utils</span> <span class="kn">import</span> <span class="n">b_filesize</span><span class="p">,</span> <span class="n">STYPE_MASK</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="k">class</span> <span class="nc">SMBSession</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd">    Class SMBSession is designed to handle the session management for SMB (Server Message Block) protocol connections.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">    It provides functionalities to connect to an SMB server, authenticate using either NTLM or Kerberos, and manage SMB shares.</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">    Attributes:</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">        address (str): The IP address or hostname of the SMB server.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">        domain (str): The domain name for SMB server authentication.</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">        username (str): The username for SMB server authentication.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">        password (str): The password for SMB server authentication.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">        lmhash (str): The LM hash of the user&#39;s password, if available.</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">        nthash (str): The NT hash of the user&#39;s password, if available.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">        use_kerberos (bool): A flag to determine whether to use Kerberos for authentication.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">        kdcHost (str): The Key Distribution Center (KDC) host for Kerberos authentication.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">        debug (bool): A flag to enable debug output.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">        smbClient (object): The SMB client object used for the connection.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">        connected (bool): A flag to check the status of the connection.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">        smb_share (str): The current SMB share in use.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">        smb_path (str): The current path within the SMB share.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">    Methods:</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">        __init__(address, domain, username, password, lmhash, nthash, use_kerberos=False, kdcHost=None, debug=False):</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">            Initializes the SMBSession with the specified parameters.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">        init_smb_session():</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">            Initializes the SMB session by connecting to the server and authenticating using the specified method.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">lmhash</span><span class="p">,</span> <span class="n">nthash</span><span class="p">,</span> <span class="n">use_kerberos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kdcHost</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">SMBSession</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>        <span class="c1"># Objects</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>        <span class="c1"># Target server</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>        <span class="c1"># Credentials</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span> 
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lmhash</span> <span class="o">=</span> <span class="n">lmhash</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nthash</span> <span class="o">=</span> <span class="n">nthash</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_kerberos</span> <span class="o">=</span> <span class="n">use_kerberos</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kdcHost</span> <span class="o">=</span> <span class="n">kdcHost</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smb_tree_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">list_shares</span><span class="p">()</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>    <span class="c1"># Connect and disconnect SMB session</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>    <span class="k">def</span> <span class="nf">init_smb_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">        Initializes and establishes a session with the SMB server.</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">        This method sets up the SMB connection using either Kerberos or NTLM authentication based on the configuration.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">        It attempts to connect to the SMB server specified by the `address` attribute and authenticate using the credentials provided during the object&#39;s initialization.</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">        The method will print debug information if the `debug` attribute is set to True. Upon successful connection and authentication, it sets the `connected` attribute to True.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">        Returns:</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">            bool: True if the connection and authentication are successful, False otherwise.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] [&gt;] Connecting to remote SMB server &#39;</span><span class="si">%s</span><span class="s2">&#39; ... &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="o">=</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SMBConnection</span><span class="p">(</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>                <span class="n">remoteName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>                <span class="n">remoteHost</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>                <span class="n">sess_port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">445</span><span class="p">)</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>            <span class="p">)</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_kerberos</span><span class="p">:</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] [&gt;] Authenticating as &#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s2">&#39; with kerberos ... &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">kerberosLogin</span><span class="p">(</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>                        <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>                        <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>                        <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>                        <span class="n">lmhash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmhash</span><span class="p">,</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>                        <span class="n">nthash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nthash</span><span class="p">,</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>                        <span class="n">aesKey</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aesKey</span><span class="p">,</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>                        <span class="n">kdcHost</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdcHost</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>                    <span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>                <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>                        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Could not login: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] [&gt;] Authenticating as &#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s2">&#39; with NTLM ... &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">login</span><span class="p">(</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>                        <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>                        <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>                        <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>                        <span class="n">lmhash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmhash</span><span class="p">,</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>                        <span class="n">nthash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nthash</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>                    <span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>                <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>                        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Could not login: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Successfully authenticated to &#39;</span><span class="si">%s</span><span class="s2">&#39; as &#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s2">&#39;!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to authenticate to &#39;</span><span class="si">%s</span><span class="s2">&#39; as &#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s2">&#39;!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>    <span class="k">def</span> <span class="nf">close_smb_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">        Closes the current SMB session by disconnecting the SMB client.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">        This method ensures that the SMB client connection is properly closed. It checks if the client is connected</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">        and if so, it closes the connection and resets the connection status.</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        Raises:</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">            Exception: If the SMB client is not initialized or if there&#39;s an error during the disconnection process.</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] SMB connection closed successfully.&quot;</span><span class="p">)</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] No active SMB connection to close.&quot;</span><span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;SMB client is not initialized.&quot;</span><span class="p">)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>    <span class="c1"># Operations</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_isfile</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">):</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>            <span class="n">tmp_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>                <span class="n">path</span><span class="o">=</span><span class="n">tmp_file_path</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>            <span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>            <span class="n">fh</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>                <span class="c1"># opening the files in streams instead of mounting shares allows </span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>                <span class="c1"># for running the script from unprivileged containers</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="n">tmp_file_path</span><span class="p">,</span> <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>            <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>            <span class="n">rawdata</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>            <span class="k">return</span> <span class="n">rawdata</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Remote path &#39;</span><span class="si">%s</span><span class="s2">&#39; is not a file.&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="p">[],</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>        <span class="k">def</span> <span class="nf">recurse_action</span><span class="p">(</span><span class="n">paths</span><span class="o">=</span><span class="p">[],</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>            <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>                <span class="k">return</span> <span class="p">[]</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>            
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>            <span class="n">next_directories_to_explore</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>                <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>                <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>                
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>                    <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>                        <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>                        <span class="n">path</span><span class="o">=</span><span class="p">(</span><span class="n">remote_smb_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>                    <span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>                <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>                    <span class="k">continue</span> 
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>                <span class="c1"># Remove dot names</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>                <span class="n">entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">]]</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>                <span class="c1"># Sort the entries ignoring case</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>                <span class="n">entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>                
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>                        <span class="n">callback</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>                        <span class="n">callback</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">(),</span> <span class="n">depth</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>                <span class="c1"># Next directories to explore</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>                        <span class="n">next_directories_to_explore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>            
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>            <span class="k">return</span> <span class="n">next_directories_to_explore</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>        <span class="c1"># </span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>            <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>                <span class="n">paths</span> <span class="o">=</span> <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>                    <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>                    <span class="n">callback</span><span class="o">=</span><span class="n">callback</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>                <span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>                <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] SMBSession.find(), callback function cannot be None.&quot;</span><span class="p">)</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>    <span class="k">def</span> <span class="nf">get_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keepRemotePath</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">        Retrieves a file from the specified path on the SMB share.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        This method attempts to retrieve a file from the given path within the currently connected SMB share.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">        If the path points to a directory, it skips the retrieval. It handles file retrieval by creating a local</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">        file object and writing the contents of the remote file to it using the SMB client&#39;s getFile method.</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">        Parameters:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">            path (str): The path of the file to retrieve. If None, uses the current smb_path.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">        Returns:</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">            None</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>        <span class="c1"># Parse path</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>        <span class="k">if</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>        <span class="c1"># Parse filename</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>        <span class="c1"># Search for the file</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>            <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>            <span class="n">path</span><span class="o">=</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>        <span class="p">)</span>   
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>        <span class="c1"># Filter the entries</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>                <span class="c1"># Skip directories</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>                <span class="k">continue</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">==</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>                <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>            <span class="k">elif</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>                <span class="n">regexp</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;.*&#39;</span><span class="p">)</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()):</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>                    <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>        
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">matching_entries</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_longname</span><span class="p">())</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matching_entries</span><span class="p">:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] [&gt;] Skipping &#39;</span><span class="si">%s</span><span class="s2">&#39; because it is a directory.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>                    <span class="k">if</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>                        <span class="n">outputfile</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>                        <span class="n">outputfile</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>                    <span class="n">f</span> <span class="o">=</span> <span class="n">LocalFileIO</span><span class="p">(</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>                        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wb&quot;</span><span class="p">,</span> 
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>                        <span class="n">path</span><span class="o">=</span><span class="n">outputfile</span><span class="p">,</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>                        <span class="n">expected_size</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="n">get_filesize</span><span class="p">(),</span> 
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>                        <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>                        <span class="n">keepRemotePath</span><span class="o">=</span><span class="n">keepRemotePath</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>                    <span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>                        <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>                        <span class="n">pathName</span><span class="o">=</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">(),</span> 
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>                        <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">write</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>                    <span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">BrokenPipeError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[v</span><span class="se">\x1b</span><span class="s2">[o</span><span class="se">\r</span><span class="s2">[!] Interrupted.&quot;</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">close_smb_session</span><span class="p">()</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">init_smb_session</span><span class="p">()</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>                        
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>    <span class="k">def</span> <span class="nf">get_file_recursively</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">        Recursively retrieves files from a specified path on the SMB share.</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="sd">        This method navigates through all directories starting from the given path,</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="sd">        and downloads all files found. It handles directories recursively, ensuring</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="sd">        that all nested files are retrieved. The method skips over directory entries</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">        and handles errors gracefully, attempting to continue the operation where possible.</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="sd">        Parameters:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a><span class="sd">            path (str): The initial directory path from which to start the recursive file retrieval.</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="sd">                        If None, it starts from the root of the configured SMB share.</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>        
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>        <span class="k">def</span> <span class="nf">recurse_action</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="p">[]):</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>                <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>                <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>            <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">remote_smb_path</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>                <span class="n">path</span><span class="o">=</span><span class="n">remote_smb_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">*&#39;</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>            <span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">()]</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                <span class="n">directories</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">()</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">]]</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>                <span class="c1"># Files</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[&gt;] Retrieving files of &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">remote_smb_path</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>                <span class="k">for</span> <span class="n">entry_file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">entry_file</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>                        <span class="n">f</span> <span class="o">=</span> <span class="n">LocalFileIO</span><span class="p">(</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>                            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wb&quot;</span><span class="p">,</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>                            <span class="n">path</span><span class="o">=</span><span class="n">remote_smb_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry_file</span><span class="o">.</span><span class="n">get_longname</span><span class="p">(),</span> 
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>                            <span class="n">expected_size</span><span class="o">=</span><span class="n">entry_file</span><span class="o">.</span><span class="n">get_filesize</span><span class="p">(),</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>                            <span class="n">keepRemotePath</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>                            <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>                        <span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>                                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>                                <span class="n">pathName</span><span class="o">=</span><span class="n">remote_smb_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry_file</span><span class="o">.</span><span class="n">get_longname</span><span class="p">(),</span> 
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>                                <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">write</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>                            <span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>                        <span class="k">except</span> <span class="ne">BrokenPipeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">set_error</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;[bold red]Failed downloading &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>                            <span class="k">break</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">set_error</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;[bold red]Failed downloading &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>                
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>                <span class="c1"># Directories</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>                <span class="k">for</span> <span class="n">entry_directory</span> <span class="ow">in</span> <span class="n">directories</span><span class="p">:</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>                    <span class="k">if</span> <span class="n">entry_directory</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>                        <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>                            <span class="n">base_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="p">,</span> 
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>                            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry_directory</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()]</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>                        <span class="p">)</span>                   
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>        <span class="c1"># Entrypoint</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>                <span class="n">base_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="p">,</span> 
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>                <span class="n">path</span><span class="o">=</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>            <span class="p">)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">BrokenPipeError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[v</span><span class="se">\x1b</span><span class="s2">[o</span><span class="se">\r</span><span class="s2">[!] Interrupted.&quot;</span><span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">close_smb_session</span><span class="p">()</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_smb_session</span><span class="p">()</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>    <span class="k">def</span> <span class="nf">get_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">        Retrieves information about a specific entry located at the provided path on the SMB share.</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">        This method checks if the specified path exists on the SMB share. If the path exists, it retrieves the details of the entry at that path, including the directory name and file name. If the entry is found, it returns the entry object; otherwise, it returns None.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a><span class="sd">        Args:</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">            path (str): The path of the entry to retrieve information about.</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a><span class="sd">        Returns:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a><span class="sd">            Entry: An object representing the entry at the specified path, or None if the entry is not found.</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_exists</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">):</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span><span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>                <span class="k">return</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>            
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>            <span class="k">return</span> <span class="kc">None</span> 
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">share</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="sd">        Displays information about the server and optionally the shares.</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="sd">        This method prints detailed information about the server&#39;s characteristics such as NetBIOS names, DNS details, OS information, and SMB capabilities. If the `share` parameter is set to True and a share is currently set, it will also attempt to display information about the share.</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">        Parameters:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">            share (bool): If True, display information about the current share.</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="sd">            server (bool): If True, display information about the server.</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">        Returns:</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">            None</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>        <span class="k">if</span> <span class="n">server</span><span class="p">:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Server:&quot;</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─NetBIOS:&quot;</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ NetBIOS Hostname ──────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerName</span><span class="p">()))</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ NetBIOS Domain ────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDomain</span><span class="p">()))</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─DNS:&quot;</span><span class="p">)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ DNS Hostname ──────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDNSHostName</span><span class="p">()))</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ DNS Domain ────────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDNSDomainName</span><span class="p">()))</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─OS:&quot;</span><span class="p">)</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ OS Name ───────────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOS</span><span class="p">()))</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ OS Version ────────────── : </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSMajor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSMinor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSBuild</span><span class="p">()))</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─Server:&quot;</span><span class="p">)</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ Signing Required ──────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">isSigningRequired</span><span class="p">()))</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ Login Required ────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">isLoginRequired</span><span class="p">()))</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ Supports NTLMv2 ───────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">doesSupportNTLMv2</span><span class="p">()))</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>                <span class="n">MaxReadSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getIOCapabilities</span><span class="p">()[</span><span class="s2">&quot;MaxReadSize&quot;</span><span class="p">]</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ Max size of read chunk ── : </span><span class="si">%d</span><span class="s2"> bytes (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MaxReadSize</span><span class="p">,</span> <span class="n">b_filesize</span><span class="p">(</span><span class="n">MaxReadSize</span><span class="p">)))</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>                <span class="n">MaxWriteSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getIOCapabilities</span><span class="p">()[</span><span class="s2">&quot;MaxWriteSize&quot;</span><span class="p">]</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ Max size of write chunk ─ : </span><span class="si">%d</span><span class="s2"> bytes (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MaxWriteSize</span><span class="p">,</span> <span class="n">b_filesize</span><span class="p">(</span><span class="n">MaxWriteSize</span><span class="p">)))</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  └─&quot;</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Server:&quot;</span><span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─NetBIOS:&quot;</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mNetBIOS Hostname</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerName</span><span class="p">()))</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ </span><span class="se">\x1b</span><span class="s2">[94mNetBIOS Domain</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDomain</span><span class="p">()))</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─DNS:&quot;</span><span class="p">)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mDNS Hostname</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDNSHostName</span><span class="p">()))</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ </span><span class="se">\x1b</span><span class="s2">[94mDNS Domain</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDNSDomainName</span><span class="p">()))</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─OS:&quot;</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mOS Name</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m─────────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOS</span><span class="p">()))</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ </span><span class="se">\x1b</span><span class="s2">[94mOS Version</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSMajor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSMinor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSBuild</span><span class="p">()))</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─Server:&quot;</span><span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mSigning Required</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">isSigningRequired</span><span class="p">()))</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mLogin Required</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">isLoginRequired</span><span class="p">()))</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mSupports NTLMv2</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m─────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">doesSupportNTLMv2</span><span class="p">()))</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>                <span class="n">MaxReadSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getIOCapabilities</span><span class="p">()[</span><span class="s2">&quot;MaxReadSize&quot;</span><span class="p">]</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mMax size of read chunk</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%d</span><span class="s2"> bytes (</span><span class="si">%s</span><span class="s2">)</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MaxReadSize</span><span class="p">,</span> <span class="n">b_filesize</span><span class="p">(</span><span class="n">MaxReadSize</span><span class="p">)))</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>                <span class="n">MaxWriteSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getIOCapabilities</span><span class="p">()[</span><span class="s2">&quot;MaxWriteSize&quot;</span><span class="p">]</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ </span><span class="se">\x1b</span><span class="s2">[94mMax size of write chunk</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m─</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%d</span><span class="s2"> bytes (</span><span class="si">%s</span><span class="s2">)</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MaxWriteSize</span><span class="p">,</span> <span class="n">b_filesize</span><span class="p">(</span><span class="n">MaxWriteSize</span><span class="p">)))</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  └─&quot;</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>        <span class="k">if</span> <span class="n">share</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>            <span class="n">share_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>            <span class="n">share_comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>            <span class="n">share_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>            <span class="n">share_type</span> <span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;STYPE_&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">share_type</span><span class="p">])</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>            <span class="n">share_rawtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="s2">&quot;rawtype&quot;</span><span class="p">]</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[+] Share:&quot;</span><span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ Name ──────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_name</span><span class="p">))</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ Description ───── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_comment</span><span class="p">))</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ Type ──────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_type</span><span class="p">))</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  └─ Raw type value ── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_rawtype</span><span class="p">))</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[+] Share:&quot;</span><span class="p">)</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ </span><span class="se">\x1b</span><span class="s2">[94mName</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_name</span><span class="p">))</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ </span><span class="se">\x1b</span><span class="s2">[94mDescription</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m─────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_comment</span><span class="p">))</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ </span><span class="se">\x1b</span><span class="s2">[94mType</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_type</span><span class="p">))</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  └─ </span><span class="se">\x1b</span><span class="s2">[94mRaw type value</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_rawtype</span><span class="p">))</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>    <span class="k">def</span> <span class="nf">list_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="sd">        Lists the contents of a specified directory on the SMB share.</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a><span class="sd">        This method retrieves the contents of a directory specified by `shareName` and `path`. If `shareName` or `path`</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a><span class="sd">        is not provided, it defaults to the instance&#39;s current SMB share or path. The method returns a dictionary with</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a><span class="sd">        the long names of the files and directories as keys and their respective SMB entry objects as values.</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="sd">        Args:</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a><span class="sd">            shareName (str, optional): The name of the SMB share. Defaults to the current SMB share if None.</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a><span class="sd">            path (str, optional): The directory path to list contents from. Defaults to the current path if None.</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a><span class="sd">        Returns:</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a><span class="sd">            dict: A dictionary with file and directory names as keys and their SMB entry objects as values.</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>        
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>        <span class="n">dest_path</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">),]</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>            <span class="n">dest_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>        <span class="n">dest_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>        <span class="n">contents</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>        <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>            <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="n">path</span><span class="o">=</span><span class="n">path</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>        <span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>            <span class="n">contents</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()]</span> <span class="o">=</span> <span class="n">entry</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="k">return</span> <span class="n">contents</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>    <span class="k">def</span> <span class="nf">list_shares</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a><span class="sd">        Lists all the shares available on the connected SMB server.</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a><span class="sd">        This method queries the SMB server to retrieve a list of all available shares. It populates the `shares` dictionary</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="sd">        with key-value pairs where the key is the share name and the value is a dictionary containing details about the share</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a><span class="sd">        such as its name, type, raw type, and any comments associated with the share.</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">        Returns:</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">            dict: A dictionary containing information about each share available on the server.</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listShares</span><span class="p">()</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>                <span class="k">for</span> <span class="n">share</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>                    <span class="c1"># SHARE_INFO_1 structure (lmshare.h)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>                    <span class="c1"># https://learn.microsoft.com/en-us/windows/win32/api/lmshare/ns-lmshare-share_info_1</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>                    <span class="n">sharename</span> <span class="o">=</span> <span class="n">share</span><span class="p">[</span><span class="s2">&quot;shi1_netname&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>                    <span class="n">sharecomment</span> <span class="o">=</span> <span class="n">share</span><span class="p">[</span><span class="s2">&quot;shi1_remark&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>                    <span class="n">sharetype</span> <span class="o">=</span> <span class="n">share</span><span class="p">[</span><span class="s2">&quot;shi1_type&quot;</span><span class="p">]</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="p">[</span><span class="n">sharename</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">sharename</span><span class="p">,</span> 
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">STYPE_MASK</span><span class="p">(</span><span class="n">sharetype</span><span class="p">),</span> 
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>                        <span class="s2">&quot;rawtype&quot;</span><span class="p">:</span> <span class="n">sharetype</span><span class="p">,</span> 
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>                        <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="n">sharecomment</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>                    <span class="p">}</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Error: SMBSession.smbClient is None.&quot;</span><span class="p">)</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>    <span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">        Creates a directory at the specified path on the SMB share.</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="sd">        This method takes a path and attempts to create the directory structure on the SMB share. If the path includes</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">        nested directories, it will create each directory in the sequence. If a directory already exists, it will skip</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">        the creation for that directory without raising an error.</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="sd">        Args:</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a><span class="sd">            path (str, optional): The full path of the directory to create on the SMB share. Defaults to None.</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a><span class="sd">        Note:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">            The path should use forward slashes (&#39;/&#39;) which will be converted to backslashes (ntpath.sep) for SMB compatibility.</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>            <span class="c1"># Prepare path</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>            <span class="k">if</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>            <span class="c1"># Create each dir in the path</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>            <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>                <span class="n">tmp_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="n">depth</span><span class="p">])</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">createDirectory</span><span class="p">(</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>                        <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>                        <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">tmp_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>                    <span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>                <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>                    <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0xc0000035</span><span class="p">:</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>                        <span class="c1"># STATUS_OBJECT_NAME_COLLISION</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>                        <span class="c1"># Remote directory already created, this is normal</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>                        <span class="c1"># Src: https://github.com/fortra/impacket/blob/269ce69872f0e8f2188a80addb0c39fedfa6dcb8/impacket/nt_errors.py#L268C9-L268C19</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>                        <span class="k">pass</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to create directory &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>                            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>            <span class="k">pass</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>    <span class="k">def</span> <span class="nf">mount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_mount_point</span><span class="p">,</span> <span class="n">remote_path</span><span class="p">):</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">        Generates the command to mount an SMB share on different platforms.</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">        This method takes the local mount point and the remote path of the SMB share and generates the appropriate mount command based on the platform.</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="sd">        It constructs the mount command using the provided parameters and executes it using the os.system() function.</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a><span class="sd">        Args:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a><span class="sd">            local_mount_point (str): The local directory where the SMB share will be mounted.</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a><span class="sd">            remote_path (str): The remote path on the SMB share to be mounted.</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a><span class="sd">        Note:</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="sd">            - For Windows platform, the command uses &#39;net use&#39; to mount the share.</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a><span class="sd">            - For Linux platform, the command uses &#39;mount&#39; to mount the share.</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a><span class="sd">            - For macOS platform, the command uses &#39;mount_smbfs&#39; to mount the share.</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="sd">            - If the platform is not supported, an error message is displayed.</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">        Returns:</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="sd">            None</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_mount_point</span><span class="p">):</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>            <span class="k">pass</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>            <span class="n">remote_path</span> <span class="o">=</span> <span class="n">remote_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;net use </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2"> </span><span class="se">\\\\</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="se">\\</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="si">}</span><span class="se">\\</span><span class="si">{</span><span class="n">remote_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>        
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">):</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>            <span class="n">remote_path</span> <span class="o">=</span> <span class="n">remote_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mount -t cifs //</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">remote_path</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2"> -o username=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">,password=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;darwin&#39;</span><span class="p">):</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>            <span class="n">remote_path</span> <span class="o">=</span> <span class="n">remote_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mount_smbfs //</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">remote_path</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>        
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Unsupported platform for mounting SMB share.&quot;</span><span class="p">)</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>        
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>        <span class="k">if</span> <span class="n">command</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] Executing: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">command</span><span class="p">)</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>    <span class="k">def</span> <span class="nf">path_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">        Checks if the specified path exists on the SMB share.</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">        This method determines if a given path exists on the SMB share by attempting to list the contents of the path.</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">        If the path listing is successful and returns one or more entries, the path is considered to exist.</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a><span class="sd">        Args:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="sd">            path (str, optional): The path to check on the SMB share. Defaults to None.</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a><span class="sd">        Returns:</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a><span class="sd">            bool: True if the path exists, False otherwise or if an error occurs.</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>                <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>                    <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>                    <span class="n">path</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>                <span class="p">)</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>                <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>   
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>    <span class="k">def</span> <span class="nf">path_isdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathFromRoot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">        Checks if the specified path is a directory on the SMB share.</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">        This method determines if a given path corresponds to a directory on the SMB share. It does this by listing the</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">        contents of the path and filtering for entries that match the basename of the path and are marked as directories.</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="sd">        Args:</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">            path (str, optional): The path to check on the SMB share. Defaults to None.</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">        Returns:</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="sd">            bool: True if the path is a directory, False otherwise or if an error occurs.</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        <span class="k">if</span> <span class="n">pathFromRoot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>            <span class="c1"># Replace slashes if any</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">pathFromRoot</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>            
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>            <span class="c1"># Strip wildcards to avoid injections</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>            <span class="c1"># Normalize path and strip leading backslash</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">]:</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>                <span class="c1"># By defininition they exist on the filesystem</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>                    <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>                        <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>                        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;*&#39;</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>                    <span class="p">)</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>                    <span class="c1"># Filter on directories</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>                    <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>                        <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>                        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">==</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">is_directory</span><span class="p">()</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>                    <span class="p">]</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>                    <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>    <span class="k">def</span> <span class="nf">path_isfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">        Checks if the specified path is a file on the SMB share.</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">        This method determines if a given path corresponds to a file on the SMB share. It does this by listing the</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">        contents of the path and filtering for entries that match the basename of the path and are not marked as directories.</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">        Args:</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">            path (str, optional): The path to check on the SMB share. Defaults to None.</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="sd">        Returns:</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">            bool: True if the path is a file, False otherwise or if an error occurs.</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>            <span class="n">search_dir</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>            <span class="n">search_dir</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">search_dir</span><span class="p">)</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>                <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>                    <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>                    <span class="n">path</span><span class="o">=</span><span class="n">search_dir</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>                <span class="p">)</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>                <span class="c1"># Filter on files</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>                <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>                    <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>                    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">==</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">is_directory</span><span class="p">()</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>                <span class="p">]</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>                <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>    <span class="k">def</span> <span class="nf">ping_smb_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">        Tests the connectivity to the SMB server by sending an echo command.</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">        This method attempts to send an echo command to the SMB server to check if the session is still active.</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">        It updates the `connected` attribute of the class based on the success or failure of the echo command.</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">        Returns:</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">            bool: True if the echo command succeeds (indicating the session is active), False otherwise.</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getSMBServer</span><span class="p">()</span><span class="o">.</span><span class="n">echo</span><span class="p">()</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>    <span class="k">def</span> <span class="nf">put_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a><span class="sd">        Uploads a single file to the SMB share.</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a><span class="sd">        This method takes a local file path, opens the file, and uploads it to the SMB share at the specified path.</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a><span class="sd">        It handles exceptions such as broken pipe errors or keyboard interrupts by closing and reinitializing the SMB session.</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="sd">        General exceptions are caught and logged, with a traceback provided if debugging is enabled.</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="sd">        Args:</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a><span class="sd">            localpath (str, optional): The local file path of the file to be uploaded. Defaults to None.</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>        <span class="c1"># Parse path</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="n">localpath</span> <span class="o">=</span> <span class="n">localpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">localpath</span><span class="p">:</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">localpath</span><span class="p">))</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>        <span class="c1"># Parse filename</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">localpath</span><span class="p">)</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="c1"># Search for the file</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">tmp_search_path</span><span class="p">)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>        <span class="c1"># Filter the entries</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>            <span class="k">if</span> <span class="n">entry</span> <span class="o">==</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>                <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>            <span class="k">elif</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                <span class="n">regexp</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;.*&#39;</span><span class="p">)</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                    <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">matching_entries</span><span class="p">)))</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>        <span class="c1"># Loop and upload</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>        <span class="k">for</span> <span class="n">localpath</span> <span class="ow">in</span> <span class="n">matching_entries</span><span class="p">:</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>                        <span class="n">localfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">localpath</span><span class="p">)</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>                        <span class="n">f</span> <span class="o">=</span> <span class="n">LocalFileIO</span><span class="p">(</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>                            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">,</span> 
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>                            <span class="n">path</span><span class="o">=</span><span class="n">localpath</span><span class="p">,</span> 
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>                            <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>                        <span class="p">)</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">putFile</span><span class="p">(</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>                            <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>                            <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">localfile</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">),</span> 
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>                            <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>                        <span class="p">)</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>                        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>                    <span class="k">except</span> <span class="p">(</span><span class="ne">BrokenPipeError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Interrupted.&quot;</span><span class="p">)</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">close_smb_session</span><span class="p">()</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">init_smb_session</span><span class="p">()</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to upload &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">localfile</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>                            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>                    <span class="c1"># [!] The specified localpath is a directory. Use &#39;put -r &lt;directory&gt;&#39; instead.</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>                    <span class="k">pass</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>                <span class="c1"># [!] The specified localpath does not exist.</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>                <span class="k">pass</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>    <span class="k">def</span> <span class="nf">put_file_recursively</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="sd">        Recursively uploads files from a specified local directory to the SMB share.</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="sd">        This method walks through the given local directory and all its subdirectories, uploading each file to the</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="sd">        corresponding directory structure on the SMB share. It first checks if the local path is a directory. If it is,</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">        it iterates over all files and directories within the local path, creating necessary directories on the SMB share</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">        and uploading files. If the local path is not a directory, it prints an error message.</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">        Args:</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">            localpath (str, optional): The local directory path from which files will be uploaded. Defaults to None.</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>                <span class="c1"># Iterate over all files and directories within the local path</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>                <span class="n">local_files</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>                <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>                        <span class="n">local_files</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="n">files</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>                <span class="c1"># Iterate over the found files</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>                <span class="k">for</span> <span class="n">local_dir_path</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">local_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[&gt;] Putting files of &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">local_dir_path</span><span class="p">)</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>                    <span class="c1"># Create remote directory</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>                    <span class="n">remote_dir_path</span> <span class="o">=</span> <span class="n">local_dir_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>                        <span class="n">path</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">remote_dir_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>                    <span class="p">)</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>                    <span class="k">for</span> <span class="n">local_file_path</span> <span class="ow">in</span> <span class="n">local_files</span><span class="p">[</span><span class="n">local_dir_path</span><span class="p">]:</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>                            <span class="n">f</span> <span class="o">=</span> <span class="n">LocalFileIO</span><span class="p">(</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>                                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">,</span> 
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>                                <span class="n">path</span><span class="o">=</span><span class="n">local_dir_path</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">local_file_path</span><span class="p">,</span> 
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>                                <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>                            <span class="p">)</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">putFile</span><span class="p">(</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>                                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>                                <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">remote_dir_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">local_file_path</span><span class="p">),</span> 
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>                                <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>                            <span class="p">)</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>                        <span class="k">except</span> <span class="ne">BrokenPipeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">set_error</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;[bold red]Failed uploading &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>                            <span class="k">break</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">set_error</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;[bold red]Failed uploading &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] The specified localpath is a file. Use &#39;put &lt;file&gt;&#39; instead.&quot;</span><span class="p">)</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] The specified localpath does not exist.&quot;</span><span class="p">)</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>    <span class="k">def</span> <span class="nf">rmdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a><span class="sd">        Removes a directory from the SMB share at the specified path.</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a><span class="sd">        This method attempts to delete a directory located at the given path on the SMB share. If the operation fails,</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="sd">        it prints an error message indicating the failure and the reason. If debugging is enabled, it also prints</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a><span class="sd">        the stack trace of the exception.</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="sd">        Args:</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="sd">            path (str, optional): The path of the directory to be removed on the SMB share. Defaults to None.</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">deleteDirectory</span><span class="p">(</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>                <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span><span class="p">),</span> 
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>            <span class="p">)</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to remove directory &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>    <span class="k">def</span> <span class="nf">rm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="sd">        Removes a file from the SMB share at the specified path.</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">        This method attempts to delete a file located at the given path on the SMB share. If the operation fails,</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">        it prints an error message indicating the failure and the reason. If debugging is enabled, it also prints</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">        the stack trace of the exception.</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">        Args:</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">            path (str, optional): The path of the file to be removed on the SMB share. Defaults to None.</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>        <span class="c1"># Parse path</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>        <span class="k">if</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>        <span class="c1"># Parse filename</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>        <span class="c1"># Search for the file</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>            <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>            <span class="n">path</span><span class="o">=</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>        <span class="p">)</span>   
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>        <span class="c1"># Filter the entries</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>                <span class="c1"># Skip directories</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>                <span class="k">continue</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">==</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>                <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>            <span class="k">elif</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>                <span class="n">regexp</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;.*&#39;</span><span class="p">)</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()):</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>                    <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>        
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">matching_entries</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_longname</span><span class="p">())</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matching_entries</span><span class="p">:</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">deleteFile</span><span class="p">(</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>                    <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>                    <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()),</span> 
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>                <span class="p">)</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to remove file &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>                    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>    <span class="k">def</span> <span class="nf">tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="sd">        Recursively lists the directory structure of the SMB share starting from the specified path.</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="sd">        This function prints a visual representation of the directory tree of the remote SMB share. It uses</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="sd">        recursion to navigate through directories and lists all files and subdirectories in each directory.</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="sd">        The output is color-coded and formatted to enhance readability, with directories highlighted in cyan.</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">        Args:</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="sd">            path (str, optional): The starting path on the SMB share from which to begin listing the tree.</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="sd">                                  Defaults to the root of the current share.</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>        
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>        <span class="k">def</span> <span class="nf">recurse_action</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="p">[],</span> <span class="n">prompt</span><span class="o">=</span><span class="p">[]):</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>            <span class="n">bars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;│   &quot;</span><span class="p">,</span> <span class="s2">&quot;├── &quot;</span><span class="p">,</span> <span class="s2">&quot;└── &quot;</span><span class="p">]</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>            <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">base_dir</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>                <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                    <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>                    <span class="n">path</span><span class="o">=</span><span class="n">remote_smb_path</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">*&#39;</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>                <span class="p">)</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>            <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>                <span class="n">code</span><span class="p">,</span> <span class="n">const</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">getErrorCode</span><span class="p">(),</span> <span class="n">err</span><span class="o">.</span><span class="n">getErrorString</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">err</span><span class="o">.</span><span class="n">getErrorString</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>                <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;Error 0x</span><span class="si">%08x</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">const</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">errmsg</span><span class="p">))</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;91m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">errmsg</span><span class="p">))</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>                <span class="k">return</span> 
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">]]</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">get_longname</span><span class="p">())</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>            <span class="c1"># </span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>                <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>                    <span class="c1"># This is the first entry </span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>                    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>                        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>                            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>                                <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> 
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>                                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()],</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>                                <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;│   &quot;</span><span class="p">]</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>                            <span class="p">)</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                    <span class="c1"># This is the last entry</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>                    <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>                        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>                            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                                <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> 
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>                                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()],</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                                <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;    &quot;</span><span class="p">]</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                            <span class="p">)</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>                        
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>                    <span class="c1"># These are entries in the middle</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>                            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>                                <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> 
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>                                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()],</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>                                <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;│   &quot;</span><span class="p">]</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>                            <span class="p">)</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>            <span class="c1"># </span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>                <span class="n">entry</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>                    <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                        <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> 
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>                        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()],</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>                        <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;    &quot;</span><span class="p">]</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>                    <span class="p">)</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>        <span class="c1"># Entrypoint</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>                <span class="n">base_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="p">,</span> 
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>                <span class="n">path</span><span class="o">=</span><span class="p">[</span><span class="n">path</span><span class="p">],</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>                <span class="n">prompt</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>            <span class="p">)</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">BrokenPipeError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Interrupted.&quot;</span><span class="p">)</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">close_smb_session</span><span class="p">()</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_smb_session</span><span class="p">()</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>    <span class="k">def</span> <span class="nf">umount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_mount_point</span><span class="p">):</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a><span class="sd">        Unmounts the specified local mount point of the remote share.</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="sd">        This method unmounts the specified local mount point of the remote share based on the platform.</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a><span class="sd">        It supports Windows, Linux, and macOS platforms for unmounting.</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="sd">        Parameters:</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a><span class="sd">            local_mount_point (str): The local mount point to unmount.</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a><span class="sd">        Raises:</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="sd">            None</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_mount_point</span><span class="p">):</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>                <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;net use </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2"> /delete&quot;</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>            <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;darwin&#39;</span><span class="p">):</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>                <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;umount </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>                <span class="n">command</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Unsupported platform for unmounting SMB share.&quot;</span><span class="p">)</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>        
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>            <span class="k">if</span> <span class="n">command</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] Executing: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">command</span><span class="p">)</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Cannot unmount a non existing path.&quot;</span><span class="p">)</span>        
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>    <span class="c1"># Other functions</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>    <span class="k">def</span> <span class="nf">test_rights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sharename</span><span class="p">):</span> 
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">        Tests the read and write access rights of the current SMB session.</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">        This method checks the read and write access rights of the current SMB session by attempting to list paths and create/delete temporary directories.</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">        </span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="sd">        Returns:</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">            dict: A dictionary containing the read and write access rights status.</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">                - &quot;readable&quot; (bool): Indicates if the session has read access rights.</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a><span class="sd">                - &quot;writable&quot; (bool): Indicates if the session has write access rights.</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>        <span class="c1"># Restore the current share</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>        <span class="n">current_share</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_share</span><span class="p">(</span><span class="n">shareName</span><span class="o">=</span><span class="n">sharename</span><span class="p">)</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>        <span class="n">access_rights</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;readable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;writable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>            <span class="n">access_rights</span><span class="p">[</span><span class="s2">&quot;readable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>        <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>            <span class="n">access_rights</span><span class="p">[</span><span class="s2">&quot;readable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>            <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s2">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPRSTUVWXYZ0123456759&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)]))</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">createDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="n">temp_dir</span><span class="p">)</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">deleteDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="n">temp_dir</span><span class="p">)</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>            <span class="n">access_rights</span><span class="p">[</span><span class="s2">&quot;writable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>        <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>            <span class="n">access_rights</span><span class="p">[</span><span class="s2">&quot;writable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>        <span class="c1"># Restore the current share</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_share</span><span class="p">(</span><span class="n">shareName</span><span class="o">=</span><span class="n">current_share</span><span class="p">)</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>        <span class="k">return</span> <span class="n">access_rights</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>    <span class="c1"># Setter / Getter</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>    <span class="k">def</span> <span class="nf">set_share</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shareName</span><span class="p">):</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="sd">        Sets the current SMB share to the specified share name.</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">        This method updates the SMB session to use the specified share name. It checks if the share name is valid</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a><span class="sd">        and updates the smb_share attribute of the SMBSession instance.</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="sd">        Parameters:</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a><span class="sd">            shareName (str): The name of the share to set as the current SMB share.</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">        Raises:</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">            ValueError: If the shareName is None or an empty string.</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>        <span class="k">if</span> <span class="n">shareName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">list_shares</span><span class="p">()</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>            <span class="k">if</span> <span class="n">shareName</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>                <span class="c1"># Doing this in order to keep the case of the share adevertised by the remote machine</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="p">[</span><span class="n">shareName</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>                <span class="c1"># Connects the tree</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smb_tree_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">connectTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">)</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Could not set share &#39;</span><span class="si">%s</span><span class="s2">&#39;, it does not exist remotely.&quot;</span> <span class="o">%</span> <span class="n">shareName</span><span class="p">)</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>            
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>    <span class="k">def</span> <span class="nf">set_cwd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="sd">        Sets the current working directory on the SMB share to the specified path.</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a><span class="sd">        This method updates the current working directory (cwd) of the SMB session to the given path if it is a valid directory.</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="sd">        If the specified path is not a directory, the cwd remains unchanged.</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a><span class="sd">        Parameters:</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a><span class="sd">            path (str): The path to set as the current working directory.</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a><span class="sd">        Raises:</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a><span class="sd">            ValueError: If the specified path is not a directory.</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>            <span class="c1"># Set path separators to ntpath sep </span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>            <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">):</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>                <span class="c1"># Absolute path</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>                <span class="c1"># Relative path to the CWD</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>            
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>            <span class="c1"># Path normalization</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>            <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">]:</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_isdir</span><span class="p">(</span><span class="n">pathFromRoot</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)):</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>                    <span class="c1"># Path exists on the remote </span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>                    <span class="c1"># Path does not exists or is not a directory on the remote </span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Remote directory &#39;</span><span class="si">%s</span><span class="s2">&#39; does not exist.&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="SMBSession">
                            <input id="SMBSession-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SMBSession</span>:

                <label class="view-source-button" for="SMBSession-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession-21"><a href="#SMBSession-21"><span class="linenos">  21</span></a><span class="k">class</span> <span class="nc">SMBSession</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="SMBSession-22"><a href="#SMBSession-22"><span class="linenos">  22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-23"><a href="#SMBSession-23"><span class="linenos">  23</span></a><span class="sd">    Class SMBSession is designed to handle the session management for SMB (Server Message Block) protocol connections.</span>
</span><span id="SMBSession-24"><a href="#SMBSession-24"><span class="linenos">  24</span></a><span class="sd">    It provides functionalities to connect to an SMB server, authenticate using either NTLM or Kerberos, and manage SMB shares.</span>
</span><span id="SMBSession-25"><a href="#SMBSession-25"><span class="linenos">  25</span></a>
</span><span id="SMBSession-26"><a href="#SMBSession-26"><span class="linenos">  26</span></a><span class="sd">    Attributes:</span>
</span><span id="SMBSession-27"><a href="#SMBSession-27"><span class="linenos">  27</span></a><span class="sd">        address (str): The IP address or hostname of the SMB server.</span>
</span><span id="SMBSession-28"><a href="#SMBSession-28"><span class="linenos">  28</span></a><span class="sd">        domain (str): The domain name for SMB server authentication.</span>
</span><span id="SMBSession-29"><a href="#SMBSession-29"><span class="linenos">  29</span></a><span class="sd">        username (str): The username for SMB server authentication.</span>
</span><span id="SMBSession-30"><a href="#SMBSession-30"><span class="linenos">  30</span></a><span class="sd">        password (str): The password for SMB server authentication.</span>
</span><span id="SMBSession-31"><a href="#SMBSession-31"><span class="linenos">  31</span></a><span class="sd">        lmhash (str): The LM hash of the user&#39;s password, if available.</span>
</span><span id="SMBSession-32"><a href="#SMBSession-32"><span class="linenos">  32</span></a><span class="sd">        nthash (str): The NT hash of the user&#39;s password, if available.</span>
</span><span id="SMBSession-33"><a href="#SMBSession-33"><span class="linenos">  33</span></a><span class="sd">        use_kerberos (bool): A flag to determine whether to use Kerberos for authentication.</span>
</span><span id="SMBSession-34"><a href="#SMBSession-34"><span class="linenos">  34</span></a><span class="sd">        kdcHost (str): The Key Distribution Center (KDC) host for Kerberos authentication.</span>
</span><span id="SMBSession-35"><a href="#SMBSession-35"><span class="linenos">  35</span></a><span class="sd">        debug (bool): A flag to enable debug output.</span>
</span><span id="SMBSession-36"><a href="#SMBSession-36"><span class="linenos">  36</span></a><span class="sd">        smbClient (object): The SMB client object used for the connection.</span>
</span><span id="SMBSession-37"><a href="#SMBSession-37"><span class="linenos">  37</span></a><span class="sd">        connected (bool): A flag to check the status of the connection.</span>
</span><span id="SMBSession-38"><a href="#SMBSession-38"><span class="linenos">  38</span></a><span class="sd">        smb_share (str): The current SMB share in use.</span>
</span><span id="SMBSession-39"><a href="#SMBSession-39"><span class="linenos">  39</span></a><span class="sd">        smb_path (str): The current path within the SMB share.</span>
</span><span id="SMBSession-40"><a href="#SMBSession-40"><span class="linenos">  40</span></a>
</span><span id="SMBSession-41"><a href="#SMBSession-41"><span class="linenos">  41</span></a><span class="sd">    Methods:</span>
</span><span id="SMBSession-42"><a href="#SMBSession-42"><span class="linenos">  42</span></a><span class="sd">        __init__(address, domain, username, password, lmhash, nthash, use_kerberos=False, kdcHost=None, debug=False):</span>
</span><span id="SMBSession-43"><a href="#SMBSession-43"><span class="linenos">  43</span></a><span class="sd">            Initializes the SMBSession with the specified parameters.</span>
</span><span id="SMBSession-44"><a href="#SMBSession-44"><span class="linenos">  44</span></a><span class="sd">        init_smb_session():</span>
</span><span id="SMBSession-45"><a href="#SMBSession-45"><span class="linenos">  45</span></a><span class="sd">            Initializes the SMB session by connecting to the server and authenticating using the specified method.</span>
</span><span id="SMBSession-46"><a href="#SMBSession-46"><span class="linenos">  46</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SMBSession-47"><a href="#SMBSession-47"><span class="linenos">  47</span></a>
</span><span id="SMBSession-48"><a href="#SMBSession-48"><span class="linenos">  48</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">lmhash</span><span class="p">,</span> <span class="n">nthash</span><span class="p">,</span> <span class="n">use_kerberos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kdcHost</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-49"><a href="#SMBSession-49"><span class="linenos">  49</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">SMBSession</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="SMBSession-50"><a href="#SMBSession-50"><span class="linenos">  50</span></a>        <span class="c1"># Objects</span>
</span><span id="SMBSession-51"><a href="#SMBSession-51"><span class="linenos">  51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span><span id="SMBSession-52"><a href="#SMBSession-52"><span class="linenos">  52</span></a>
</span><span id="SMBSession-53"><a href="#SMBSession-53"><span class="linenos">  53</span></a>        <span class="c1"># Target server</span>
</span><span id="SMBSession-54"><a href="#SMBSession-54"><span class="linenos">  54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
</span><span id="SMBSession-55"><a href="#SMBSession-55"><span class="linenos">  55</span></a>
</span><span id="SMBSession-56"><a href="#SMBSession-56"><span class="linenos">  56</span></a>        <span class="c1"># Credentials</span>
</span><span id="SMBSession-57"><a href="#SMBSession-57"><span class="linenos">  57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
</span><span id="SMBSession-58"><a href="#SMBSession-58"><span class="linenos">  58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
</span><span id="SMBSession-59"><a href="#SMBSession-59"><span class="linenos">  59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span> 
</span><span id="SMBSession-60"><a href="#SMBSession-60"><span class="linenos">  60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lmhash</span> <span class="o">=</span> <span class="n">lmhash</span>
</span><span id="SMBSession-61"><a href="#SMBSession-61"><span class="linenos">  61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nthash</span> <span class="o">=</span> <span class="n">nthash</span>
</span><span id="SMBSession-62"><a href="#SMBSession-62"><span class="linenos">  62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_kerberos</span> <span class="o">=</span> <span class="n">use_kerberos</span>
</span><span id="SMBSession-63"><a href="#SMBSession-63"><span class="linenos">  63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kdcHost</span> <span class="o">=</span> <span class="n">kdcHost</span>
</span><span id="SMBSession-64"><a href="#SMBSession-64"><span class="linenos">  64</span></a>
</span><span id="SMBSession-65"><a href="#SMBSession-65"><span class="linenos">  65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SMBSession-66"><a href="#SMBSession-66"><span class="linenos">  66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession-67"><a href="#SMBSession-67"><span class="linenos">  67</span></a>
</span><span id="SMBSession-68"><a href="#SMBSession-68"><span class="linenos">  68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SMBSession-69"><a href="#SMBSession-69"><span class="linenos">  69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SMBSession-70"><a href="#SMBSession-70"><span class="linenos">  70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="SMBSession-71"><a href="#SMBSession-71"><span class="linenos">  71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smb_tree_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SMBSession-72"><a href="#SMBSession-72"><span class="linenos">  72</span></a>
</span><span id="SMBSession-73"><a href="#SMBSession-73"><span class="linenos">  73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">list_shares</span><span class="p">()</span>
</span><span id="SMBSession-74"><a href="#SMBSession-74"><span class="linenos">  74</span></a>
</span><span id="SMBSession-75"><a href="#SMBSession-75"><span class="linenos">  75</span></a>    <span class="c1"># Connect and disconnect SMB session</span>
</span><span id="SMBSession-76"><a href="#SMBSession-76"><span class="linenos">  76</span></a>
</span><span id="SMBSession-77"><a href="#SMBSession-77"><span class="linenos">  77</span></a>    <span class="k">def</span> <span class="nf">init_smb_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SMBSession-78"><a href="#SMBSession-78"><span class="linenos">  78</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-79"><a href="#SMBSession-79"><span class="linenos">  79</span></a><span class="sd">        Initializes and establishes a session with the SMB server.</span>
</span><span id="SMBSession-80"><a href="#SMBSession-80"><span class="linenos">  80</span></a>
</span><span id="SMBSession-81"><a href="#SMBSession-81"><span class="linenos">  81</span></a><span class="sd">        This method sets up the SMB connection using either Kerberos or NTLM authentication based on the configuration.</span>
</span><span id="SMBSession-82"><a href="#SMBSession-82"><span class="linenos">  82</span></a><span class="sd">        It attempts to connect to the SMB server specified by the `address` attribute and authenticate using the credentials provided during the object&#39;s initialization.</span>
</span><span id="SMBSession-83"><a href="#SMBSession-83"><span class="linenos">  83</span></a>
</span><span id="SMBSession-84"><a href="#SMBSession-84"><span class="linenos">  84</span></a><span class="sd">        The method will print debug information if the `debug` attribute is set to True. Upon successful connection and authentication, it sets the `connected` attribute to True.</span>
</span><span id="SMBSession-85"><a href="#SMBSession-85"><span class="linenos">  85</span></a>
</span><span id="SMBSession-86"><a href="#SMBSession-86"><span class="linenos">  86</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession-87"><a href="#SMBSession-87"><span class="linenos">  87</span></a><span class="sd">            bool: True if the connection and authentication are successful, False otherwise.</span>
</span><span id="SMBSession-88"><a href="#SMBSession-88"><span class="linenos">  88</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-89"><a href="#SMBSession-89"><span class="linenos">  89</span></a>
</span><span id="SMBSession-90"><a href="#SMBSession-90"><span class="linenos">  90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession-91"><a href="#SMBSession-91"><span class="linenos">  91</span></a>
</span><span id="SMBSession-92"><a href="#SMBSession-92"><span class="linenos">  92</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-93"><a href="#SMBSession-93"><span class="linenos">  93</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] [&gt;] Connecting to remote SMB server &#39;</span><span class="si">%s</span><span class="s2">&#39; ... &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
</span><span id="SMBSession-94"><a href="#SMBSession-94"><span class="linenos">  94</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-95"><a href="#SMBSession-95"><span class="linenos">  95</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="o">=</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SMBConnection</span><span class="p">(</span>
</span><span id="SMBSession-96"><a href="#SMBSession-96"><span class="linenos">  96</span></a>                <span class="n">remoteName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
</span><span id="SMBSession-97"><a href="#SMBSession-97"><span class="linenos">  97</span></a>                <span class="n">remoteHost</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
</span><span id="SMBSession-98"><a href="#SMBSession-98"><span class="linenos">  98</span></a>                <span class="n">sess_port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">445</span><span class="p">)</span>
</span><span id="SMBSession-99"><a href="#SMBSession-99"><span class="linenos">  99</span></a>            <span class="p">)</span>
</span><span id="SMBSession-100"><a href="#SMBSession-100"><span class="linenos"> 100</span></a>        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-101"><a href="#SMBSession-101"><span class="linenos"> 101</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
</span><span id="SMBSession-102"><a href="#SMBSession-102"><span class="linenos"> 102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SMBSession-103"><a href="#SMBSession-103"><span class="linenos"> 103</span></a>
</span><span id="SMBSession-104"><a href="#SMBSession-104"><span class="linenos"> 104</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-105"><a href="#SMBSession-105"><span class="linenos"> 105</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_kerberos</span><span class="p">:</span>
</span><span id="SMBSession-106"><a href="#SMBSession-106"><span class="linenos"> 106</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-107"><a href="#SMBSession-107"><span class="linenos"> 107</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] [&gt;] Authenticating as &#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s2">&#39; with kerberos ... &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</span><span id="SMBSession-108"><a href="#SMBSession-108"><span class="linenos"> 108</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-109"><a href="#SMBSession-109"><span class="linenos"> 109</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">kerberosLogin</span><span class="p">(</span>
</span><span id="SMBSession-110"><a href="#SMBSession-110"><span class="linenos"> 110</span></a>                        <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
</span><span id="SMBSession-111"><a href="#SMBSession-111"><span class="linenos"> 111</span></a>                        <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="SMBSession-112"><a href="#SMBSession-112"><span class="linenos"> 112</span></a>                        <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span>
</span><span id="SMBSession-113"><a href="#SMBSession-113"><span class="linenos"> 113</span></a>                        <span class="n">lmhash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmhash</span><span class="p">,</span>
</span><span id="SMBSession-114"><a href="#SMBSession-114"><span class="linenos"> 114</span></a>                        <span class="n">nthash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nthash</span><span class="p">,</span>
</span><span id="SMBSession-115"><a href="#SMBSession-115"><span class="linenos"> 115</span></a>                        <span class="n">aesKey</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aesKey</span><span class="p">,</span>
</span><span id="SMBSession-116"><a href="#SMBSession-116"><span class="linenos"> 116</span></a>                        <span class="n">kdcHost</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdcHost</span>
</span><span id="SMBSession-117"><a href="#SMBSession-117"><span class="linenos"> 117</span></a>                    <span class="p">)</span>
</span><span id="SMBSession-118"><a href="#SMBSession-118"><span class="linenos"> 118</span></a>                <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-119"><a href="#SMBSession-119"><span class="linenos"> 119</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-120"><a href="#SMBSession-120"><span class="linenos"> 120</span></a>                        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="SMBSession-121"><a href="#SMBSession-121"><span class="linenos"> 121</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Could not login: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
</span><span id="SMBSession-122"><a href="#SMBSession-122"><span class="linenos"> 122</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession-123"><a href="#SMBSession-123"><span class="linenos"> 123</span></a>
</span><span id="SMBSession-124"><a href="#SMBSession-124"><span class="linenos"> 124</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-125"><a href="#SMBSession-125"><span class="linenos"> 125</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-126"><a href="#SMBSession-126"><span class="linenos"> 126</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] [&gt;] Authenticating as &#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s2">&#39; with NTLM ... &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</span><span id="SMBSession-127"><a href="#SMBSession-127"><span class="linenos"> 127</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-128"><a href="#SMBSession-128"><span class="linenos"> 128</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">login</span><span class="p">(</span>
</span><span id="SMBSession-129"><a href="#SMBSession-129"><span class="linenos"> 129</span></a>                        <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
</span><span id="SMBSession-130"><a href="#SMBSession-130"><span class="linenos"> 130</span></a>                        <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="SMBSession-131"><a href="#SMBSession-131"><span class="linenos"> 131</span></a>                        <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span>
</span><span id="SMBSession-132"><a href="#SMBSession-132"><span class="linenos"> 132</span></a>                        <span class="n">lmhash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmhash</span><span class="p">,</span>
</span><span id="SMBSession-133"><a href="#SMBSession-133"><span class="linenos"> 133</span></a>                        <span class="n">nthash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nthash</span>
</span><span id="SMBSession-134"><a href="#SMBSession-134"><span class="linenos"> 134</span></a>                    <span class="p">)</span>
</span><span id="SMBSession-135"><a href="#SMBSession-135"><span class="linenos"> 135</span></a>                <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-136"><a href="#SMBSession-136"><span class="linenos"> 136</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-137"><a href="#SMBSession-137"><span class="linenos"> 137</span></a>                        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="SMBSession-138"><a href="#SMBSession-138"><span class="linenos"> 138</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Could not login: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
</span><span id="SMBSession-139"><a href="#SMBSession-139"><span class="linenos"> 139</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession-140"><a href="#SMBSession-140"><span class="linenos"> 140</span></a>
</span><span id="SMBSession-141"><a href="#SMBSession-141"><span class="linenos"> 141</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="SMBSession-142"><a href="#SMBSession-142"><span class="linenos"> 142</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Successfully authenticated to &#39;</span><span class="si">%s</span><span class="s2">&#39; as &#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s2">&#39;!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</span><span id="SMBSession-143"><a href="#SMBSession-143"><span class="linenos"> 143</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-144"><a href="#SMBSession-144"><span class="linenos"> 144</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to authenticate to &#39;</span><span class="si">%s</span><span class="s2">&#39; as &#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s2">&#39;!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</span><span id="SMBSession-145"><a href="#SMBSession-145"><span class="linenos"> 145</span></a>
</span><span id="SMBSession-146"><a href="#SMBSession-146"><span class="linenos"> 146</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span>
</span><span id="SMBSession-147"><a href="#SMBSession-147"><span class="linenos"> 147</span></a>
</span><span id="SMBSession-148"><a href="#SMBSession-148"><span class="linenos"> 148</span></a>    <span class="k">def</span> <span class="nf">close_smb_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SMBSession-149"><a href="#SMBSession-149"><span class="linenos"> 149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-150"><a href="#SMBSession-150"><span class="linenos"> 150</span></a><span class="sd">        Closes the current SMB session by disconnecting the SMB client.</span>
</span><span id="SMBSession-151"><a href="#SMBSession-151"><span class="linenos"> 151</span></a>
</span><span id="SMBSession-152"><a href="#SMBSession-152"><span class="linenos"> 152</span></a><span class="sd">        This method ensures that the SMB client connection is properly closed. It checks if the client is connected</span>
</span><span id="SMBSession-153"><a href="#SMBSession-153"><span class="linenos"> 153</span></a><span class="sd">        and if so, it closes the connection and resets the connection status.</span>
</span><span id="SMBSession-154"><a href="#SMBSession-154"><span class="linenos"> 154</span></a>
</span><span id="SMBSession-155"><a href="#SMBSession-155"><span class="linenos"> 155</span></a><span class="sd">        Raises:</span>
</span><span id="SMBSession-156"><a href="#SMBSession-156"><span class="linenos"> 156</span></a><span class="sd">            Exception: If the SMB client is not initialized or if there&#39;s an error during the disconnection process.</span>
</span><span id="SMBSession-157"><a href="#SMBSession-157"><span class="linenos"> 157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-158"><a href="#SMBSession-158"><span class="linenos"> 158</span></a>
</span><span id="SMBSession-159"><a href="#SMBSession-159"><span class="linenos"> 159</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-160"><a href="#SMBSession-160"><span class="linenos"> 160</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="SMBSession-161"><a href="#SMBSession-161"><span class="linenos"> 161</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession-162"><a href="#SMBSession-162"><span class="linenos"> 162</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession-163"><a href="#SMBSession-163"><span class="linenos"> 163</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-164"><a href="#SMBSession-164"><span class="linenos"> 164</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] SMB connection closed successfully.&quot;</span><span class="p">)</span>
</span><span id="SMBSession-165"><a href="#SMBSession-165"><span class="linenos"> 165</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-166"><a href="#SMBSession-166"><span class="linenos"> 166</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-167"><a href="#SMBSession-167"><span class="linenos"> 167</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] No active SMB connection to close.&quot;</span><span class="p">)</span>
</span><span id="SMBSession-168"><a href="#SMBSession-168"><span class="linenos"> 168</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-169"><a href="#SMBSession-169"><span class="linenos"> 169</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;SMB client is not initialized.&quot;</span><span class="p">)</span>
</span><span id="SMBSession-170"><a href="#SMBSession-170"><span class="linenos"> 170</span></a>
</span><span id="SMBSession-171"><a href="#SMBSession-171"><span class="linenos"> 171</span></a>    <span class="c1"># Operations</span>
</span><span id="SMBSession-172"><a href="#SMBSession-172"><span class="linenos"> 172</span></a>
</span><span id="SMBSession-173"><a href="#SMBSession-173"><span class="linenos"> 173</span></a>    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-174"><a href="#SMBSession-174"><span class="linenos"> 174</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_isfile</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">):</span>
</span><span id="SMBSession-175"><a href="#SMBSession-175"><span class="linenos"> 175</span></a>            <span class="n">tmp_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span>
</span><span id="SMBSession-176"><a href="#SMBSession-176"><span class="linenos"> 176</span></a>            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession-177"><a href="#SMBSession-177"><span class="linenos"> 177</span></a>                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-178"><a href="#SMBSession-178"><span class="linenos"> 178</span></a>                <span class="n">path</span><span class="o">=</span><span class="n">tmp_file_path</span>
</span><span id="SMBSession-179"><a href="#SMBSession-179"><span class="linenos"> 179</span></a>            <span class="p">)</span>
</span><span id="SMBSession-180"><a href="#SMBSession-180"><span class="linenos"> 180</span></a>
</span><span id="SMBSession-181"><a href="#SMBSession-181"><span class="linenos"> 181</span></a>            <span class="n">fh</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
</span><span id="SMBSession-182"><a href="#SMBSession-182"><span class="linenos"> 182</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-183"><a href="#SMBSession-183"><span class="linenos"> 183</span></a>                <span class="c1"># opening the files in streams instead of mounting shares allows </span>
</span><span id="SMBSession-184"><a href="#SMBSession-184"><span class="linenos"> 184</span></a>                <span class="c1"># for running the script from unprivileged containers</span>
</span><span id="SMBSession-185"><a href="#SMBSession-185"><span class="linenos"> 185</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="n">tmp_file_path</span><span class="p">,</span> <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
</span><span id="SMBSession-186"><a href="#SMBSession-186"><span class="linenos"> 186</span></a>            <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession-187"><a href="#SMBSession-187"><span class="linenos"> 187</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="SMBSession-188"><a href="#SMBSession-188"><span class="linenos"> 188</span></a>            <span class="n">rawdata</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span><span id="SMBSession-189"><a href="#SMBSession-189"><span class="linenos"> 189</span></a>            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession-190"><a href="#SMBSession-190"><span class="linenos"> 190</span></a>            <span class="k">return</span> <span class="n">rawdata</span>
</span><span id="SMBSession-191"><a href="#SMBSession-191"><span class="linenos"> 191</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-192"><a href="#SMBSession-192"><span class="linenos"> 192</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Remote path &#39;</span><span class="si">%s</span><span class="s2">&#39; is not a file.&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession-193"><a href="#SMBSession-193"><span class="linenos"> 193</span></a>
</span><span id="SMBSession-194"><a href="#SMBSession-194"><span class="linenos"> 194</span></a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="p">[],</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-195"><a href="#SMBSession-195"><span class="linenos"> 195</span></a>        <span class="k">def</span> <span class="nf">recurse_action</span><span class="p">(</span><span class="n">paths</span><span class="o">=</span><span class="p">[],</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-196"><a href="#SMBSession-196"><span class="linenos"> 196</span></a>            <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-197"><a href="#SMBSession-197"><span class="linenos"> 197</span></a>                <span class="k">return</span> <span class="p">[]</span>
</span><span id="SMBSession-198"><a href="#SMBSession-198"><span class="linenos"> 198</span></a>            
</span><span id="SMBSession-199"><a href="#SMBSession-199"><span class="linenos"> 199</span></a>            <span class="n">next_directories_to_explore</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SMBSession-200"><a href="#SMBSession-200"><span class="linenos"> 200</span></a>
</span><span id="SMBSession-201"><a href="#SMBSession-201"><span class="linenos"> 201</span></a>            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
</span><span id="SMBSession-202"><a href="#SMBSession-202"><span class="linenos"> 202</span></a>                <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession-203"><a href="#SMBSession-203"><span class="linenos"> 203</span></a>                <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SMBSession-204"><a href="#SMBSession-204"><span class="linenos"> 204</span></a>                
</span><span id="SMBSession-205"><a href="#SMBSession-205"><span class="linenos"> 205</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-206"><a href="#SMBSession-206"><span class="linenos"> 206</span></a>                    <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession-207"><a href="#SMBSession-207"><span class="linenos"> 207</span></a>                        <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-208"><a href="#SMBSession-208"><span class="linenos"> 208</span></a>                        <span class="n">path</span><span class="o">=</span><span class="p">(</span><span class="n">remote_smb_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="SMBSession-209"><a href="#SMBSession-209"><span class="linenos"> 209</span></a>                    <span class="p">)</span>
</span><span id="SMBSession-210"><a href="#SMBSession-210"><span class="linenos"> 210</span></a>                <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-211"><a href="#SMBSession-211"><span class="linenos"> 211</span></a>                    <span class="k">continue</span> 
</span><span id="SMBSession-212"><a href="#SMBSession-212"><span class="linenos"> 212</span></a>                <span class="c1"># Remove dot names</span>
</span><span id="SMBSession-213"><a href="#SMBSession-213"><span class="linenos"> 213</span></a>                <span class="n">entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">]]</span>
</span><span id="SMBSession-214"><a href="#SMBSession-214"><span class="linenos"> 214</span></a>                <span class="c1"># Sort the entries ignoring case</span>
</span><span id="SMBSession-215"><a href="#SMBSession-215"><span class="linenos"> 215</span></a>                <span class="n">entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="SMBSession-216"><a href="#SMBSession-216"><span class="linenos"> 216</span></a>                
</span><span id="SMBSession-217"><a href="#SMBSession-217"><span class="linenos"> 217</span></a>                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="SMBSession-218"><a href="#SMBSession-218"><span class="linenos"> 218</span></a>                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession-219"><a href="#SMBSession-219"><span class="linenos"> 219</span></a>                        <span class="n">callback</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>
</span><span id="SMBSession-220"><a href="#SMBSession-220"><span class="linenos"> 220</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-221"><a href="#SMBSession-221"><span class="linenos"> 221</span></a>                        <span class="n">callback</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">(),</span> <span class="n">depth</span><span class="p">)</span>
</span><span id="SMBSession-222"><a href="#SMBSession-222"><span class="linenos"> 222</span></a>
</span><span id="SMBSession-223"><a href="#SMBSession-223"><span class="linenos"> 223</span></a>                <span class="c1"># Next directories to explore</span>
</span><span id="SMBSession-224"><a href="#SMBSession-224"><span class="linenos"> 224</span></a>                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="SMBSession-225"><a href="#SMBSession-225"><span class="linenos"> 225</span></a>                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession-226"><a href="#SMBSession-226"><span class="linenos"> 226</span></a>                        <span class="n">next_directories_to_explore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-227"><a href="#SMBSession-227"><span class="linenos"> 227</span></a>            
</span><span id="SMBSession-228"><a href="#SMBSession-228"><span class="linenos"> 228</span></a>            <span class="k">return</span> <span class="n">next_directories_to_explore</span>
</span><span id="SMBSession-229"><a href="#SMBSession-229"><span class="linenos"> 229</span></a>        <span class="c1"># </span>
</span><span id="SMBSession-230"><a href="#SMBSession-230"><span class="linenos"> 230</span></a>        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-231"><a href="#SMBSession-231"><span class="linenos"> 231</span></a>            <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SMBSession-232"><a href="#SMBSession-232"><span class="linenos"> 232</span></a>            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession-233"><a href="#SMBSession-233"><span class="linenos"> 233</span></a>                <span class="n">paths</span> <span class="o">=</span> <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession-234"><a href="#SMBSession-234"><span class="linenos"> 234</span></a>                    <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span>
</span><span id="SMBSession-235"><a href="#SMBSession-235"><span class="linenos"> 235</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="SMBSession-236"><a href="#SMBSession-236"><span class="linenos"> 236</span></a>                    <span class="n">callback</span><span class="o">=</span><span class="n">callback</span>
</span><span id="SMBSession-237"><a href="#SMBSession-237"><span class="linenos"> 237</span></a>                <span class="p">)</span>
</span><span id="SMBSession-238"><a href="#SMBSession-238"><span class="linenos"> 238</span></a>                <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="SMBSession-239"><a href="#SMBSession-239"><span class="linenos"> 239</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-240"><a href="#SMBSession-240"><span class="linenos"> 240</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] SMBSession.find(), callback function cannot be None.&quot;</span><span class="p">)</span>
</span><span id="SMBSession-241"><a href="#SMBSession-241"><span class="linenos"> 241</span></a>
</span><span id="SMBSession-242"><a href="#SMBSession-242"><span class="linenos"> 242</span></a>    <span class="k">def</span> <span class="nf">get_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keepRemotePath</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SMBSession-243"><a href="#SMBSession-243"><span class="linenos"> 243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-244"><a href="#SMBSession-244"><span class="linenos"> 244</span></a><span class="sd">        Retrieves a file from the specified path on the SMB share.</span>
</span><span id="SMBSession-245"><a href="#SMBSession-245"><span class="linenos"> 245</span></a>
</span><span id="SMBSession-246"><a href="#SMBSession-246"><span class="linenos"> 246</span></a><span class="sd">        This method attempts to retrieve a file from the given path within the currently connected SMB share.</span>
</span><span id="SMBSession-247"><a href="#SMBSession-247"><span class="linenos"> 247</span></a><span class="sd">        If the path points to a directory, it skips the retrieval. It handles file retrieval by creating a local</span>
</span><span id="SMBSession-248"><a href="#SMBSession-248"><span class="linenos"> 248</span></a><span class="sd">        file object and writing the contents of the remote file to it using the SMB client&#39;s getFile method.</span>
</span><span id="SMBSession-249"><a href="#SMBSession-249"><span class="linenos"> 249</span></a>
</span><span id="SMBSession-250"><a href="#SMBSession-250"><span class="linenos"> 250</span></a><span class="sd">        Parameters:</span>
</span><span id="SMBSession-251"><a href="#SMBSession-251"><span class="linenos"> 251</span></a><span class="sd">            path (str): The path of the file to retrieve. If None, uses the current smb_path.</span>
</span><span id="SMBSession-252"><a href="#SMBSession-252"><span class="linenos"> 252</span></a>
</span><span id="SMBSession-253"><a href="#SMBSession-253"><span class="linenos"> 253</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession-254"><a href="#SMBSession-254"><span class="linenos"> 254</span></a><span class="sd">            None</span>
</span><span id="SMBSession-255"><a href="#SMBSession-255"><span class="linenos"> 255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-256"><a href="#SMBSession-256"><span class="linenos"> 256</span></a>
</span><span id="SMBSession-257"><a href="#SMBSession-257"><span class="linenos"> 257</span></a>        <span class="c1"># Parse path</span>
</span><span id="SMBSession-258"><a href="#SMBSession-258"><span class="linenos"> 258</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-259"><a href="#SMBSession-259"><span class="linenos"> 259</span></a>        <span class="k">if</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="SMBSession-260"><a href="#SMBSession-260"><span class="linenos"> 260</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="SMBSession-261"><a href="#SMBSession-261"><span class="linenos"> 261</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-262"><a href="#SMBSession-262"><span class="linenos"> 262</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-263"><a href="#SMBSession-263"><span class="linenos"> 263</span></a>        <span class="c1"># Parse filename</span>
</span><span id="SMBSession-264"><a href="#SMBSession-264"><span class="linenos"> 264</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession-265"><a href="#SMBSession-265"><span class="linenos"> 265</span></a>
</span><span id="SMBSession-266"><a href="#SMBSession-266"><span class="linenos"> 266</span></a>        <span class="c1"># Search for the file</span>
</span><span id="SMBSession-267"><a href="#SMBSession-267"><span class="linenos"> 267</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession-268"><a href="#SMBSession-268"><span class="linenos"> 268</span></a>            <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-269"><a href="#SMBSession-269"><span class="linenos"> 269</span></a>            <span class="n">path</span><span class="o">=</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span>
</span><span id="SMBSession-270"><a href="#SMBSession-270"><span class="linenos"> 270</span></a>        <span class="p">)</span>   
</span><span id="SMBSession-271"><a href="#SMBSession-271"><span class="linenos"> 271</span></a>
</span><span id="SMBSession-272"><a href="#SMBSession-272"><span class="linenos"> 272</span></a>        <span class="c1"># Filter the entries</span>
</span><span id="SMBSession-273"><a href="#SMBSession-273"><span class="linenos"> 273</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SMBSession-274"><a href="#SMBSession-274"><span class="linenos"> 274</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="SMBSession-275"><a href="#SMBSession-275"><span class="linenos"> 275</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession-276"><a href="#SMBSession-276"><span class="linenos"> 276</span></a>                <span class="c1"># Skip directories</span>
</span><span id="SMBSession-277"><a href="#SMBSession-277"><span class="linenos"> 277</span></a>                <span class="k">continue</span>
</span><span id="SMBSession-278"><a href="#SMBSession-278"><span class="linenos"> 278</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">==</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SMBSession-279"><a href="#SMBSession-279"><span class="linenos"> 279</span></a>                <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="SMBSession-280"><a href="#SMBSession-280"><span class="linenos"> 280</span></a>            <span class="k">elif</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SMBSession-281"><a href="#SMBSession-281"><span class="linenos"> 281</span></a>                <span class="n">regexp</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;.*&#39;</span><span class="p">)</span>
</span><span id="SMBSession-282"><a href="#SMBSession-282"><span class="linenos"> 282</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()):</span>
</span><span id="SMBSession-283"><a href="#SMBSession-283"><span class="linenos"> 283</span></a>                    <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="SMBSession-284"><a href="#SMBSession-284"><span class="linenos"> 284</span></a>        
</span><span id="SMBSession-285"><a href="#SMBSession-285"><span class="linenos"> 285</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">matching_entries</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_longname</span><span class="p">())</span>
</span><span id="SMBSession-286"><a href="#SMBSession-286"><span class="linenos"> 286</span></a>
</span><span id="SMBSession-287"><a href="#SMBSession-287"><span class="linenos"> 287</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matching_entries</span><span class="p">:</span>
</span><span id="SMBSession-288"><a href="#SMBSession-288"><span class="linenos"> 288</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession-289"><a href="#SMBSession-289"><span class="linenos"> 289</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-290"><a href="#SMBSession-290"><span class="linenos"> 290</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] [&gt;] Skipping &#39;</span><span class="si">%s</span><span class="s2">&#39; because it is a directory.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-291"><a href="#SMBSession-291"><span class="linenos"> 291</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-292"><a href="#SMBSession-292"><span class="linenos"> 292</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-293"><a href="#SMBSession-293"><span class="linenos"> 293</span></a>                    <span class="k">if</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="SMBSession-294"><a href="#SMBSession-294"><span class="linenos"> 294</span></a>                        <span class="n">outputfile</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span>
</span><span id="SMBSession-295"><a href="#SMBSession-295"><span class="linenos"> 295</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-296"><a href="#SMBSession-296"><span class="linenos"> 296</span></a>                        <span class="n">outputfile</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span>
</span><span id="SMBSession-297"><a href="#SMBSession-297"><span class="linenos"> 297</span></a>                    <span class="n">f</span> <span class="o">=</span> <span class="n">LocalFileIO</span><span class="p">(</span>
</span><span id="SMBSession-298"><a href="#SMBSession-298"><span class="linenos"> 298</span></a>                        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wb&quot;</span><span class="p">,</span> 
</span><span id="SMBSession-299"><a href="#SMBSession-299"><span class="linenos"> 299</span></a>                        <span class="n">path</span><span class="o">=</span><span class="n">outputfile</span><span class="p">,</span>
</span><span id="SMBSession-300"><a href="#SMBSession-300"><span class="linenos"> 300</span></a>                        <span class="n">expected_size</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="n">get_filesize</span><span class="p">(),</span> 
</span><span id="SMBSession-301"><a href="#SMBSession-301"><span class="linenos"> 301</span></a>                        <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
</span><span id="SMBSession-302"><a href="#SMBSession-302"><span class="linenos"> 302</span></a>                        <span class="n">keepRemotePath</span><span class="o">=</span><span class="n">keepRemotePath</span>
</span><span id="SMBSession-303"><a href="#SMBSession-303"><span class="linenos"> 303</span></a>                    <span class="p">)</span>
</span><span id="SMBSession-304"><a href="#SMBSession-304"><span class="linenos"> 304</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span>
</span><span id="SMBSession-305"><a href="#SMBSession-305"><span class="linenos"> 305</span></a>                        <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-306"><a href="#SMBSession-306"><span class="linenos"> 306</span></a>                        <span class="n">pathName</span><span class="o">=</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">(),</span> 
</span><span id="SMBSession-307"><a href="#SMBSession-307"><span class="linenos"> 307</span></a>                        <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">write</span>
</span><span id="SMBSession-308"><a href="#SMBSession-308"><span class="linenos"> 308</span></a>                    <span class="p">)</span>
</span><span id="SMBSession-309"><a href="#SMBSession-309"><span class="linenos"> 309</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession-310"><a href="#SMBSession-310"><span class="linenos"> 310</span></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">BrokenPipeError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession-311"><a href="#SMBSession-311"><span class="linenos"> 311</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession-312"><a href="#SMBSession-312"><span class="linenos"> 312</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[v</span><span class="se">\x1b</span><span class="s2">[o</span><span class="se">\r</span><span class="s2">[!] Interrupted.&quot;</span><span class="p">)</span>
</span><span id="SMBSession-313"><a href="#SMBSession-313"><span class="linenos"> 313</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">close_smb_session</span><span class="p">()</span>
</span><span id="SMBSession-314"><a href="#SMBSession-314"><span class="linenos"> 314</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">init_smb_session</span><span class="p">()</span>
</span><span id="SMBSession-315"><a href="#SMBSession-315"><span class="linenos"> 315</span></a>                        
</span><span id="SMBSession-316"><a href="#SMBSession-316"><span class="linenos"> 316</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="SMBSession-317"><a href="#SMBSession-317"><span class="linenos"> 317</span></a>
</span><span id="SMBSession-318"><a href="#SMBSession-318"><span class="linenos"> 318</span></a>    <span class="k">def</span> <span class="nf">get_file_recursively</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-319"><a href="#SMBSession-319"><span class="linenos"> 319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-320"><a href="#SMBSession-320"><span class="linenos"> 320</span></a><span class="sd">        Recursively retrieves files from a specified path on the SMB share.</span>
</span><span id="SMBSession-321"><a href="#SMBSession-321"><span class="linenos"> 321</span></a>
</span><span id="SMBSession-322"><a href="#SMBSession-322"><span class="linenos"> 322</span></a><span class="sd">        This method navigates through all directories starting from the given path,</span>
</span><span id="SMBSession-323"><a href="#SMBSession-323"><span class="linenos"> 323</span></a><span class="sd">        and downloads all files found. It handles directories recursively, ensuring</span>
</span><span id="SMBSession-324"><a href="#SMBSession-324"><span class="linenos"> 324</span></a><span class="sd">        that all nested files are retrieved. The method skips over directory entries</span>
</span><span id="SMBSession-325"><a href="#SMBSession-325"><span class="linenos"> 325</span></a><span class="sd">        and handles errors gracefully, attempting to continue the operation where possible.</span>
</span><span id="SMBSession-326"><a href="#SMBSession-326"><span class="linenos"> 326</span></a>
</span><span id="SMBSession-327"><a href="#SMBSession-327"><span class="linenos"> 327</span></a><span class="sd">        Parameters:</span>
</span><span id="SMBSession-328"><a href="#SMBSession-328"><span class="linenos"> 328</span></a><span class="sd">            path (str): The initial directory path from which to start the recursive file retrieval.</span>
</span><span id="SMBSession-329"><a href="#SMBSession-329"><span class="linenos"> 329</span></a><span class="sd">                        If None, it starts from the root of the configured SMB share.</span>
</span><span id="SMBSession-330"><a href="#SMBSession-330"><span class="linenos"> 330</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-331"><a href="#SMBSession-331"><span class="linenos"> 331</span></a>        
</span><span id="SMBSession-332"><a href="#SMBSession-332"><span class="linenos"> 332</span></a>        <span class="k">def</span> <span class="nf">recurse_action</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="p">[]):</span>
</span><span id="SMBSession-333"><a href="#SMBSession-333"><span class="linenos"> 333</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession-334"><a href="#SMBSession-334"><span class="linenos"> 334</span></a>                <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession-335"><a href="#SMBSession-335"><span class="linenos"> 335</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-336"><a href="#SMBSession-336"><span class="linenos"> 336</span></a>                <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession-337"><a href="#SMBSession-337"><span class="linenos"> 337</span></a>            <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">remote_smb_path</span><span class="p">)</span>
</span><span id="SMBSession-338"><a href="#SMBSession-338"><span class="linenos"> 338</span></a>
</span><span id="SMBSession-339"><a href="#SMBSession-339"><span class="linenos"> 339</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession-340"><a href="#SMBSession-340"><span class="linenos"> 340</span></a>                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-341"><a href="#SMBSession-341"><span class="linenos"> 341</span></a>                <span class="n">path</span><span class="o">=</span><span class="n">remote_smb_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">*&#39;</span>
</span><span id="SMBSession-342"><a href="#SMBSession-342"><span class="linenos"> 342</span></a>            <span class="p">)</span>
</span><span id="SMBSession-343"><a href="#SMBSession-343"><span class="linenos"> 343</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession-344"><a href="#SMBSession-344"><span class="linenos"> 344</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">()]</span>
</span><span id="SMBSession-345"><a href="#SMBSession-345"><span class="linenos"> 345</span></a>                <span class="n">directories</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">()</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">]]</span>
</span><span id="SMBSession-346"><a href="#SMBSession-346"><span class="linenos"> 346</span></a>
</span><span id="SMBSession-347"><a href="#SMBSession-347"><span class="linenos"> 347</span></a>                <span class="c1"># Files</span>
</span><span id="SMBSession-348"><a href="#SMBSession-348"><span class="linenos"> 348</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession-349"><a href="#SMBSession-349"><span class="linenos"> 349</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[&gt;] Retrieving files of &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">remote_smb_path</span><span class="p">)</span>
</span><span id="SMBSession-350"><a href="#SMBSession-350"><span class="linenos"> 350</span></a>                <span class="k">for</span> <span class="n">entry_file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="SMBSession-351"><a href="#SMBSession-351"><span class="linenos"> 351</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">entry_file</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession-352"><a href="#SMBSession-352"><span class="linenos"> 352</span></a>                        <span class="n">f</span> <span class="o">=</span> <span class="n">LocalFileIO</span><span class="p">(</span>
</span><span id="SMBSession-353"><a href="#SMBSession-353"><span class="linenos"> 353</span></a>                            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wb&quot;</span><span class="p">,</span>
</span><span id="SMBSession-354"><a href="#SMBSession-354"><span class="linenos"> 354</span></a>                            <span class="n">path</span><span class="o">=</span><span class="n">remote_smb_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry_file</span><span class="o">.</span><span class="n">get_longname</span><span class="p">(),</span> 
</span><span id="SMBSession-355"><a href="#SMBSession-355"><span class="linenos"> 355</span></a>                            <span class="n">expected_size</span><span class="o">=</span><span class="n">entry_file</span><span class="o">.</span><span class="n">get_filesize</span><span class="p">(),</span>
</span><span id="SMBSession-356"><a href="#SMBSession-356"><span class="linenos"> 356</span></a>                            <span class="n">keepRemotePath</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SMBSession-357"><a href="#SMBSession-357"><span class="linenos"> 357</span></a>                            <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span>
</span><span id="SMBSession-358"><a href="#SMBSession-358"><span class="linenos"> 358</span></a>                        <span class="p">)</span>
</span><span id="SMBSession-359"><a href="#SMBSession-359"><span class="linenos"> 359</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-360"><a href="#SMBSession-360"><span class="linenos"> 360</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span>
</span><span id="SMBSession-361"><a href="#SMBSession-361"><span class="linenos"> 361</span></a>                                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-362"><a href="#SMBSession-362"><span class="linenos"> 362</span></a>                                <span class="n">pathName</span><span class="o">=</span><span class="n">remote_smb_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry_file</span><span class="o">.</span><span class="n">get_longname</span><span class="p">(),</span> 
</span><span id="SMBSession-363"><a href="#SMBSession-363"><span class="linenos"> 363</span></a>                                <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">write</span>
</span><span id="SMBSession-364"><a href="#SMBSession-364"><span class="linenos"> 364</span></a>                            <span class="p">)</span>
</span><span id="SMBSession-365"><a href="#SMBSession-365"><span class="linenos"> 365</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession-366"><a href="#SMBSession-366"><span class="linenos"> 366</span></a>                        <span class="k">except</span> <span class="ne">BrokenPipeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-367"><a href="#SMBSession-367"><span class="linenos"> 367</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">set_error</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;[bold red]Failed downloading &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession-368"><a href="#SMBSession-368"><span class="linenos"> 368</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SMBSession-369"><a href="#SMBSession-369"><span class="linenos"> 369</span></a>                            <span class="k">break</span>
</span><span id="SMBSession-370"><a href="#SMBSession-370"><span class="linenos"> 370</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-371"><a href="#SMBSession-371"><span class="linenos"> 371</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">set_error</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;[bold red]Failed downloading &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession-372"><a href="#SMBSession-372"><span class="linenos"> 372</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SMBSession-373"><a href="#SMBSession-373"><span class="linenos"> 373</span></a>                
</span><span id="SMBSession-374"><a href="#SMBSession-374"><span class="linenos"> 374</span></a>                <span class="c1"># Directories</span>
</span><span id="SMBSession-375"><a href="#SMBSession-375"><span class="linenos"> 375</span></a>                <span class="k">for</span> <span class="n">entry_directory</span> <span class="ow">in</span> <span class="n">directories</span><span class="p">:</span>
</span><span id="SMBSession-376"><a href="#SMBSession-376"><span class="linenos"> 376</span></a>                    <span class="k">if</span> <span class="n">entry_directory</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession-377"><a href="#SMBSession-377"><span class="linenos"> 377</span></a>                        <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession-378"><a href="#SMBSession-378"><span class="linenos"> 378</span></a>                            <span class="n">base_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="p">,</span> 
</span><span id="SMBSession-379"><a href="#SMBSession-379"><span class="linenos"> 379</span></a>                            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry_directory</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()]</span>
</span><span id="SMBSession-380"><a href="#SMBSession-380"><span class="linenos"> 380</span></a>                        <span class="p">)</span>                   
</span><span id="SMBSession-381"><a href="#SMBSession-381"><span class="linenos"> 381</span></a>        <span class="c1"># Entrypoint</span>
</span><span id="SMBSession-382"><a href="#SMBSession-382"><span class="linenos"> 382</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-383"><a href="#SMBSession-383"><span class="linenos"> 383</span></a>            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession-384"><a href="#SMBSession-384"><span class="linenos"> 384</span></a>                <span class="n">base_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="p">,</span> 
</span><span id="SMBSession-385"><a href="#SMBSession-385"><span class="linenos"> 385</span></a>                <span class="n">path</span><span class="o">=</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
</span><span id="SMBSession-386"><a href="#SMBSession-386"><span class="linenos"> 386</span></a>            <span class="p">)</span>
</span><span id="SMBSession-387"><a href="#SMBSession-387"><span class="linenos"> 387</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">BrokenPipeError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession-388"><a href="#SMBSession-388"><span class="linenos"> 388</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[v</span><span class="se">\x1b</span><span class="s2">[o</span><span class="se">\r</span><span class="s2">[!] Interrupted.&quot;</span><span class="p">)</span>
</span><span id="SMBSession-389"><a href="#SMBSession-389"><span class="linenos"> 389</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">close_smb_session</span><span class="p">()</span>
</span><span id="SMBSession-390"><a href="#SMBSession-390"><span class="linenos"> 390</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_smb_session</span><span class="p">()</span>
</span><span id="SMBSession-391"><a href="#SMBSession-391"><span class="linenos"> 391</span></a>
</span><span id="SMBSession-392"><a href="#SMBSession-392"><span class="linenos"> 392</span></a>    <span class="k">def</span> <span class="nf">get_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-393"><a href="#SMBSession-393"><span class="linenos"> 393</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-394"><a href="#SMBSession-394"><span class="linenos"> 394</span></a><span class="sd">        Retrieves information about a specific entry located at the provided path on the SMB share.</span>
</span><span id="SMBSession-395"><a href="#SMBSession-395"><span class="linenos"> 395</span></a>
</span><span id="SMBSession-396"><a href="#SMBSession-396"><span class="linenos"> 396</span></a><span class="sd">        This method checks if the specified path exists on the SMB share. If the path exists, it retrieves the details of the entry at that path, including the directory name and file name. If the entry is found, it returns the entry object; otherwise, it returns None.</span>
</span><span id="SMBSession-397"><a href="#SMBSession-397"><span class="linenos"> 397</span></a>
</span><span id="SMBSession-398"><a href="#SMBSession-398"><span class="linenos"> 398</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession-399"><a href="#SMBSession-399"><span class="linenos"> 399</span></a><span class="sd">            path (str): The path of the entry to retrieve information about.</span>
</span><span id="SMBSession-400"><a href="#SMBSession-400"><span class="linenos"> 400</span></a>
</span><span id="SMBSession-401"><a href="#SMBSession-401"><span class="linenos"> 401</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession-402"><a href="#SMBSession-402"><span class="linenos"> 402</span></a><span class="sd">            Entry: An object representing the entry at the specified path, or None if the entry is not found.</span>
</span><span id="SMBSession-403"><a href="#SMBSession-403"><span class="linenos"> 403</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-404"><a href="#SMBSession-404"><span class="linenos"> 404</span></a>
</span><span id="SMBSession-405"><a href="#SMBSession-405"><span class="linenos"> 405</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_exists</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">):</span>
</span><span id="SMBSession-406"><a href="#SMBSession-406"><span class="linenos"> 406</span></a>            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span><span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession-407"><a href="#SMBSession-407"><span class="linenos"> 407</span></a>
</span><span id="SMBSession-408"><a href="#SMBSession-408"><span class="linenos"> 408</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SMBSession-409"><a href="#SMBSession-409"><span class="linenos"> 409</span></a>                <span class="k">return</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SMBSession-410"><a href="#SMBSession-410"><span class="linenos"> 410</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-411"><a href="#SMBSession-411"><span class="linenos"> 411</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="SMBSession-412"><a href="#SMBSession-412"><span class="linenos"> 412</span></a>            
</span><span id="SMBSession-413"><a href="#SMBSession-413"><span class="linenos"> 413</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-414"><a href="#SMBSession-414"><span class="linenos"> 414</span></a>            <span class="k">return</span> <span class="kc">None</span> 
</span><span id="SMBSession-415"><a href="#SMBSession-415"><span class="linenos"> 415</span></a>
</span><span id="SMBSession-416"><a href="#SMBSession-416"><span class="linenos"> 416</span></a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">share</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="SMBSession-417"><a href="#SMBSession-417"><span class="linenos"> 417</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-418"><a href="#SMBSession-418"><span class="linenos"> 418</span></a><span class="sd">        Displays information about the server and optionally the shares.</span>
</span><span id="SMBSession-419"><a href="#SMBSession-419"><span class="linenos"> 419</span></a>
</span><span id="SMBSession-420"><a href="#SMBSession-420"><span class="linenos"> 420</span></a><span class="sd">        This method prints detailed information about the server&#39;s characteristics such as NetBIOS names, DNS details, OS information, and SMB capabilities. If the `share` parameter is set to True and a share is currently set, it will also attempt to display information about the share.</span>
</span><span id="SMBSession-421"><a href="#SMBSession-421"><span class="linenos"> 421</span></a>
</span><span id="SMBSession-422"><a href="#SMBSession-422"><span class="linenos"> 422</span></a><span class="sd">        Parameters:</span>
</span><span id="SMBSession-423"><a href="#SMBSession-423"><span class="linenos"> 423</span></a><span class="sd">            share (bool): If True, display information about the current share.</span>
</span><span id="SMBSession-424"><a href="#SMBSession-424"><span class="linenos"> 424</span></a><span class="sd">            server (bool): If True, display information about the server.</span>
</span><span id="SMBSession-425"><a href="#SMBSession-425"><span class="linenos"> 425</span></a>
</span><span id="SMBSession-426"><a href="#SMBSession-426"><span class="linenos"> 426</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession-427"><a href="#SMBSession-427"><span class="linenos"> 427</span></a><span class="sd">            None</span>
</span><span id="SMBSession-428"><a href="#SMBSession-428"><span class="linenos"> 428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-429"><a href="#SMBSession-429"><span class="linenos"> 429</span></a>
</span><span id="SMBSession-430"><a href="#SMBSession-430"><span class="linenos"> 430</span></a>        <span class="k">if</span> <span class="n">server</span><span class="p">:</span>
</span><span id="SMBSession-431"><a href="#SMBSession-431"><span class="linenos"> 431</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession-432"><a href="#SMBSession-432"><span class="linenos"> 432</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Server:&quot;</span><span class="p">)</span>
</span><span id="SMBSession-433"><a href="#SMBSession-433"><span class="linenos"> 433</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─NetBIOS:&quot;</span><span class="p">)</span>
</span><span id="SMBSession-434"><a href="#SMBSession-434"><span class="linenos"> 434</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ NetBIOS Hostname ──────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerName</span><span class="p">()))</span>
</span><span id="SMBSession-435"><a href="#SMBSession-435"><span class="linenos"> 435</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ NetBIOS Domain ────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDomain</span><span class="p">()))</span>
</span><span id="SMBSession-436"><a href="#SMBSession-436"><span class="linenos"> 436</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─DNS:&quot;</span><span class="p">)</span>
</span><span id="SMBSession-437"><a href="#SMBSession-437"><span class="linenos"> 437</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ DNS Hostname ──────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDNSHostName</span><span class="p">()))</span>
</span><span id="SMBSession-438"><a href="#SMBSession-438"><span class="linenos"> 438</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ DNS Domain ────────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDNSDomainName</span><span class="p">()))</span>
</span><span id="SMBSession-439"><a href="#SMBSession-439"><span class="linenos"> 439</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─OS:&quot;</span><span class="p">)</span>
</span><span id="SMBSession-440"><a href="#SMBSession-440"><span class="linenos"> 440</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ OS Name ───────────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOS</span><span class="p">()))</span>
</span><span id="SMBSession-441"><a href="#SMBSession-441"><span class="linenos"> 441</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ OS Version ────────────── : </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSMajor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSMinor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSBuild</span><span class="p">()))</span>
</span><span id="SMBSession-442"><a href="#SMBSession-442"><span class="linenos"> 442</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─Server:&quot;</span><span class="p">)</span>
</span><span id="SMBSession-443"><a href="#SMBSession-443"><span class="linenos"> 443</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ Signing Required ──────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">isSigningRequired</span><span class="p">()))</span>
</span><span id="SMBSession-444"><a href="#SMBSession-444"><span class="linenos"> 444</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ Login Required ────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">isLoginRequired</span><span class="p">()))</span>
</span><span id="SMBSession-445"><a href="#SMBSession-445"><span class="linenos"> 445</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ Supports NTLMv2 ───────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">doesSupportNTLMv2</span><span class="p">()))</span>
</span><span id="SMBSession-446"><a href="#SMBSession-446"><span class="linenos"> 446</span></a>                <span class="n">MaxReadSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getIOCapabilities</span><span class="p">()[</span><span class="s2">&quot;MaxReadSize&quot;</span><span class="p">]</span>
</span><span id="SMBSession-447"><a href="#SMBSession-447"><span class="linenos"> 447</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ Max size of read chunk ── : </span><span class="si">%d</span><span class="s2"> bytes (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MaxReadSize</span><span class="p">,</span> <span class="n">b_filesize</span><span class="p">(</span><span class="n">MaxReadSize</span><span class="p">)))</span>
</span><span id="SMBSession-448"><a href="#SMBSession-448"><span class="linenos"> 448</span></a>                <span class="n">MaxWriteSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getIOCapabilities</span><span class="p">()[</span><span class="s2">&quot;MaxWriteSize&quot;</span><span class="p">]</span>
</span><span id="SMBSession-449"><a href="#SMBSession-449"><span class="linenos"> 449</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ Max size of write chunk ─ : </span><span class="si">%d</span><span class="s2"> bytes (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MaxWriteSize</span><span class="p">,</span> <span class="n">b_filesize</span><span class="p">(</span><span class="n">MaxWriteSize</span><span class="p">)))</span>
</span><span id="SMBSession-450"><a href="#SMBSession-450"><span class="linenos"> 450</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  └─&quot;</span><span class="p">)</span>
</span><span id="SMBSession-451"><a href="#SMBSession-451"><span class="linenos"> 451</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-452"><a href="#SMBSession-452"><span class="linenos"> 452</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Server:&quot;</span><span class="p">)</span>
</span><span id="SMBSession-453"><a href="#SMBSession-453"><span class="linenos"> 453</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─NetBIOS:&quot;</span><span class="p">)</span>
</span><span id="SMBSession-454"><a href="#SMBSession-454"><span class="linenos"> 454</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mNetBIOS Hostname</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerName</span><span class="p">()))</span>
</span><span id="SMBSession-455"><a href="#SMBSession-455"><span class="linenos"> 455</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ </span><span class="se">\x1b</span><span class="s2">[94mNetBIOS Domain</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDomain</span><span class="p">()))</span>
</span><span id="SMBSession-456"><a href="#SMBSession-456"><span class="linenos"> 456</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─DNS:&quot;</span><span class="p">)</span>
</span><span id="SMBSession-457"><a href="#SMBSession-457"><span class="linenos"> 457</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mDNS Hostname</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDNSHostName</span><span class="p">()))</span>
</span><span id="SMBSession-458"><a href="#SMBSession-458"><span class="linenos"> 458</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ </span><span class="se">\x1b</span><span class="s2">[94mDNS Domain</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDNSDomainName</span><span class="p">()))</span>
</span><span id="SMBSession-459"><a href="#SMBSession-459"><span class="linenos"> 459</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─OS:&quot;</span><span class="p">)</span>
</span><span id="SMBSession-460"><a href="#SMBSession-460"><span class="linenos"> 460</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mOS Name</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m─────────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOS</span><span class="p">()))</span>
</span><span id="SMBSession-461"><a href="#SMBSession-461"><span class="linenos"> 461</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ </span><span class="se">\x1b</span><span class="s2">[94mOS Version</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSMajor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSMinor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSBuild</span><span class="p">()))</span>
</span><span id="SMBSession-462"><a href="#SMBSession-462"><span class="linenos"> 462</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─Server:&quot;</span><span class="p">)</span>
</span><span id="SMBSession-463"><a href="#SMBSession-463"><span class="linenos"> 463</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mSigning Required</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">isSigningRequired</span><span class="p">()))</span>
</span><span id="SMBSession-464"><a href="#SMBSession-464"><span class="linenos"> 464</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mLogin Required</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">isLoginRequired</span><span class="p">()))</span>
</span><span id="SMBSession-465"><a href="#SMBSession-465"><span class="linenos"> 465</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mSupports NTLMv2</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m─────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">doesSupportNTLMv2</span><span class="p">()))</span>
</span><span id="SMBSession-466"><a href="#SMBSession-466"><span class="linenos"> 466</span></a>                <span class="n">MaxReadSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getIOCapabilities</span><span class="p">()[</span><span class="s2">&quot;MaxReadSize&quot;</span><span class="p">]</span>
</span><span id="SMBSession-467"><a href="#SMBSession-467"><span class="linenos"> 467</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mMax size of read chunk</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%d</span><span class="s2"> bytes (</span><span class="si">%s</span><span class="s2">)</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MaxReadSize</span><span class="p">,</span> <span class="n">b_filesize</span><span class="p">(</span><span class="n">MaxReadSize</span><span class="p">)))</span>
</span><span id="SMBSession-468"><a href="#SMBSession-468"><span class="linenos"> 468</span></a>                <span class="n">MaxWriteSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getIOCapabilities</span><span class="p">()[</span><span class="s2">&quot;MaxWriteSize&quot;</span><span class="p">]</span>
</span><span id="SMBSession-469"><a href="#SMBSession-469"><span class="linenos"> 469</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ </span><span class="se">\x1b</span><span class="s2">[94mMax size of write chunk</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m─</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%d</span><span class="s2"> bytes (</span><span class="si">%s</span><span class="s2">)</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MaxWriteSize</span><span class="p">,</span> <span class="n">b_filesize</span><span class="p">(</span><span class="n">MaxWriteSize</span><span class="p">)))</span>
</span><span id="SMBSession-470"><a href="#SMBSession-470"><span class="linenos"> 470</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  └─&quot;</span><span class="p">)</span>
</span><span id="SMBSession-471"><a href="#SMBSession-471"><span class="linenos"> 471</span></a>
</span><span id="SMBSession-472"><a href="#SMBSession-472"><span class="linenos"> 472</span></a>        <span class="k">if</span> <span class="n">share</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-473"><a href="#SMBSession-473"><span class="linenos"> 473</span></a>            <span class="n">share_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="SMBSession-474"><a href="#SMBSession-474"><span class="linenos"> 474</span></a>            <span class="n">share_comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span>
</span><span id="SMBSession-475"><a href="#SMBSession-475"><span class="linenos"> 475</span></a>            <span class="n">share_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
</span><span id="SMBSession-476"><a href="#SMBSession-476"><span class="linenos"> 476</span></a>            <span class="n">share_type</span> <span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;STYPE_&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">share_type</span><span class="p">])</span>
</span><span id="SMBSession-477"><a href="#SMBSession-477"><span class="linenos"> 477</span></a>            <span class="n">share_rawtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="s2">&quot;rawtype&quot;</span><span class="p">]</span>
</span><span id="SMBSession-478"><a href="#SMBSession-478"><span class="linenos"> 478</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession-479"><a href="#SMBSession-479"><span class="linenos"> 479</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[+] Share:&quot;</span><span class="p">)</span>
</span><span id="SMBSession-480"><a href="#SMBSession-480"><span class="linenos"> 480</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ Name ──────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_name</span><span class="p">))</span>
</span><span id="SMBSession-481"><a href="#SMBSession-481"><span class="linenos"> 481</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ Description ───── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_comment</span><span class="p">))</span>
</span><span id="SMBSession-482"><a href="#SMBSession-482"><span class="linenos"> 482</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ Type ──────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_type</span><span class="p">))</span>
</span><span id="SMBSession-483"><a href="#SMBSession-483"><span class="linenos"> 483</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  └─ Raw type value ── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_rawtype</span><span class="p">))</span>
</span><span id="SMBSession-484"><a href="#SMBSession-484"><span class="linenos"> 484</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-485"><a href="#SMBSession-485"><span class="linenos"> 485</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[+] Share:&quot;</span><span class="p">)</span>
</span><span id="SMBSession-486"><a href="#SMBSession-486"><span class="linenos"> 486</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ </span><span class="se">\x1b</span><span class="s2">[94mName</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_name</span><span class="p">))</span>
</span><span id="SMBSession-487"><a href="#SMBSession-487"><span class="linenos"> 487</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ </span><span class="se">\x1b</span><span class="s2">[94mDescription</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m─────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_comment</span><span class="p">))</span>
</span><span id="SMBSession-488"><a href="#SMBSession-488"><span class="linenos"> 488</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ </span><span class="se">\x1b</span><span class="s2">[94mType</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_type</span><span class="p">))</span>
</span><span id="SMBSession-489"><a href="#SMBSession-489"><span class="linenos"> 489</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  └─ </span><span class="se">\x1b</span><span class="s2">[94mRaw type value</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_rawtype</span><span class="p">))</span>
</span><span id="SMBSession-490"><a href="#SMBSession-490"><span class="linenos"> 490</span></a>
</span><span id="SMBSession-491"><a href="#SMBSession-491"><span class="linenos"> 491</span></a>    <span class="k">def</span> <span class="nf">list_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-492"><a href="#SMBSession-492"><span class="linenos"> 492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-493"><a href="#SMBSession-493"><span class="linenos"> 493</span></a><span class="sd">        Lists the contents of a specified directory on the SMB share.</span>
</span><span id="SMBSession-494"><a href="#SMBSession-494"><span class="linenos"> 494</span></a>
</span><span id="SMBSession-495"><a href="#SMBSession-495"><span class="linenos"> 495</span></a><span class="sd">        This method retrieves the contents of a directory specified by `shareName` and `path`. If `shareName` or `path`</span>
</span><span id="SMBSession-496"><a href="#SMBSession-496"><span class="linenos"> 496</span></a><span class="sd">        is not provided, it defaults to the instance&#39;s current SMB share or path. The method returns a dictionary with</span>
</span><span id="SMBSession-497"><a href="#SMBSession-497"><span class="linenos"> 497</span></a><span class="sd">        the long names of the files and directories as keys and their respective SMB entry objects as values.</span>
</span><span id="SMBSession-498"><a href="#SMBSession-498"><span class="linenos"> 498</span></a>
</span><span id="SMBSession-499"><a href="#SMBSession-499"><span class="linenos"> 499</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession-500"><a href="#SMBSession-500"><span class="linenos"> 500</span></a><span class="sd">            shareName (str, optional): The name of the SMB share. Defaults to the current SMB share if None.</span>
</span><span id="SMBSession-501"><a href="#SMBSession-501"><span class="linenos"> 501</span></a><span class="sd">            path (str, optional): The directory path to list contents from. Defaults to the current path if None.</span>
</span><span id="SMBSession-502"><a href="#SMBSession-502"><span class="linenos"> 502</span></a>
</span><span id="SMBSession-503"><a href="#SMBSession-503"><span class="linenos"> 503</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession-504"><a href="#SMBSession-504"><span class="linenos"> 504</span></a><span class="sd">            dict: A dictionary with file and directory names as keys and their SMB entry objects as values.</span>
</span><span id="SMBSession-505"><a href="#SMBSession-505"><span class="linenos"> 505</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-506"><a href="#SMBSession-506"><span class="linenos"> 506</span></a>        
</span><span id="SMBSession-507"><a href="#SMBSession-507"><span class="linenos"> 507</span></a>        <span class="n">dest_path</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">),]</span>
</span><span id="SMBSession-508"><a href="#SMBSession-508"><span class="linenos"> 508</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession-509"><a href="#SMBSession-509"><span class="linenos"> 509</span></a>            <span class="n">dest_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>
</span><span id="SMBSession-510"><a href="#SMBSession-510"><span class="linenos"> 510</span></a>        <span class="n">dest_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="SMBSession-511"><a href="#SMBSession-511"><span class="linenos"> 511</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>
</span><span id="SMBSession-512"><a href="#SMBSession-512"><span class="linenos"> 512</span></a>
</span><span id="SMBSession-513"><a href="#SMBSession-513"><span class="linenos"> 513</span></a>        <span class="n">contents</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SMBSession-514"><a href="#SMBSession-514"><span class="linenos"> 514</span></a>        <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession-515"><a href="#SMBSession-515"><span class="linenos"> 515</span></a>            <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-516"><a href="#SMBSession-516"><span class="linenos"> 516</span></a>            <span class="n">path</span><span class="o">=</span><span class="n">path</span>
</span><span id="SMBSession-517"><a href="#SMBSession-517"><span class="linenos"> 517</span></a>        <span class="p">)</span>
</span><span id="SMBSession-518"><a href="#SMBSession-518"><span class="linenos"> 518</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="SMBSession-519"><a href="#SMBSession-519"><span class="linenos"> 519</span></a>            <span class="n">contents</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()]</span> <span class="o">=</span> <span class="n">entry</span>
</span><span id="SMBSession-520"><a href="#SMBSession-520"><span class="linenos"> 520</span></a>
</span><span id="SMBSession-521"><a href="#SMBSession-521"><span class="linenos"> 521</span></a>        <span class="k">return</span> <span class="n">contents</span>
</span><span id="SMBSession-522"><a href="#SMBSession-522"><span class="linenos"> 522</span></a>
</span><span id="SMBSession-523"><a href="#SMBSession-523"><span class="linenos"> 523</span></a>    <span class="k">def</span> <span class="nf">list_shares</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SMBSession-524"><a href="#SMBSession-524"><span class="linenos"> 524</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-525"><a href="#SMBSession-525"><span class="linenos"> 525</span></a><span class="sd">        Lists all the shares available on the connected SMB server.</span>
</span><span id="SMBSession-526"><a href="#SMBSession-526"><span class="linenos"> 526</span></a>
</span><span id="SMBSession-527"><a href="#SMBSession-527"><span class="linenos"> 527</span></a><span class="sd">        This method queries the SMB server to retrieve a list of all available shares. It populates the `shares` dictionary</span>
</span><span id="SMBSession-528"><a href="#SMBSession-528"><span class="linenos"> 528</span></a><span class="sd">        with key-value pairs where the key is the share name and the value is a dictionary containing details about the share</span>
</span><span id="SMBSession-529"><a href="#SMBSession-529"><span class="linenos"> 529</span></a><span class="sd">        such as its name, type, raw type, and any comments associated with the share.</span>
</span><span id="SMBSession-530"><a href="#SMBSession-530"><span class="linenos"> 530</span></a>
</span><span id="SMBSession-531"><a href="#SMBSession-531"><span class="linenos"> 531</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession-532"><a href="#SMBSession-532"><span class="linenos"> 532</span></a><span class="sd">            dict: A dictionary containing information about each share available on the server.</span>
</span><span id="SMBSession-533"><a href="#SMBSession-533"><span class="linenos"> 533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-534"><a href="#SMBSession-534"><span class="linenos"> 534</span></a>
</span><span id="SMBSession-535"><a href="#SMBSession-535"><span class="linenos"> 535</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SMBSession-536"><a href="#SMBSession-536"><span class="linenos"> 536</span></a>
</span><span id="SMBSession-537"><a href="#SMBSession-537"><span class="linenos"> 537</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="SMBSession-538"><a href="#SMBSession-538"><span class="linenos"> 538</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-539"><a href="#SMBSession-539"><span class="linenos"> 539</span></a>                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listShares</span><span class="p">()</span>
</span><span id="SMBSession-540"><a href="#SMBSession-540"><span class="linenos"> 540</span></a>
</span><span id="SMBSession-541"><a href="#SMBSession-541"><span class="linenos"> 541</span></a>                <span class="k">for</span> <span class="n">share</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="SMBSession-542"><a href="#SMBSession-542"><span class="linenos"> 542</span></a>                    <span class="c1"># SHARE_INFO_1 structure (lmshare.h)</span>
</span><span id="SMBSession-543"><a href="#SMBSession-543"><span class="linenos"> 543</span></a>                    <span class="c1"># https://learn.microsoft.com/en-us/windows/win32/api/lmshare/ns-lmshare-share_info_1</span>
</span><span id="SMBSession-544"><a href="#SMBSession-544"><span class="linenos"> 544</span></a>                    <span class="n">sharename</span> <span class="o">=</span> <span class="n">share</span><span class="p">[</span><span class="s2">&quot;shi1_netname&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SMBSession-545"><a href="#SMBSession-545"><span class="linenos"> 545</span></a>                    <span class="n">sharecomment</span> <span class="o">=</span> <span class="n">share</span><span class="p">[</span><span class="s2">&quot;shi1_remark&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SMBSession-546"><a href="#SMBSession-546"><span class="linenos"> 546</span></a>                    <span class="n">sharetype</span> <span class="o">=</span> <span class="n">share</span><span class="p">[</span><span class="s2">&quot;shi1_type&quot;</span><span class="p">]</span>
</span><span id="SMBSession-547"><a href="#SMBSession-547"><span class="linenos"> 547</span></a>
</span><span id="SMBSession-548"><a href="#SMBSession-548"><span class="linenos"> 548</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="p">[</span><span class="n">sharename</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SMBSession-549"><a href="#SMBSession-549"><span class="linenos"> 549</span></a>                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">sharename</span><span class="p">,</span> 
</span><span id="SMBSession-550"><a href="#SMBSession-550"><span class="linenos"> 550</span></a>                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">STYPE_MASK</span><span class="p">(</span><span class="n">sharetype</span><span class="p">),</span> 
</span><span id="SMBSession-551"><a href="#SMBSession-551"><span class="linenos"> 551</span></a>                        <span class="s2">&quot;rawtype&quot;</span><span class="p">:</span> <span class="n">sharetype</span><span class="p">,</span> 
</span><span id="SMBSession-552"><a href="#SMBSession-552"><span class="linenos"> 552</span></a>                        <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="n">sharecomment</span>
</span><span id="SMBSession-553"><a href="#SMBSession-553"><span class="linenos"> 553</span></a>                    <span class="p">}</span>
</span><span id="SMBSession-554"><a href="#SMBSession-554"><span class="linenos"> 554</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-555"><a href="#SMBSession-555"><span class="linenos"> 555</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Error: SMBSession.smbClient is None.&quot;</span><span class="p">)</span>
</span><span id="SMBSession-556"><a href="#SMBSession-556"><span class="linenos"> 556</span></a>
</span><span id="SMBSession-557"><a href="#SMBSession-557"><span class="linenos"> 557</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span>
</span><span id="SMBSession-558"><a href="#SMBSession-558"><span class="linenos"> 558</span></a>
</span><span id="SMBSession-559"><a href="#SMBSession-559"><span class="linenos"> 559</span></a>    <span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-560"><a href="#SMBSession-560"><span class="linenos"> 560</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-561"><a href="#SMBSession-561"><span class="linenos"> 561</span></a><span class="sd">        Creates a directory at the specified path on the SMB share.</span>
</span><span id="SMBSession-562"><a href="#SMBSession-562"><span class="linenos"> 562</span></a>
</span><span id="SMBSession-563"><a href="#SMBSession-563"><span class="linenos"> 563</span></a><span class="sd">        This method takes a path and attempts to create the directory structure on the SMB share. If the path includes</span>
</span><span id="SMBSession-564"><a href="#SMBSession-564"><span class="linenos"> 564</span></a><span class="sd">        nested directories, it will create each directory in the sequence. If a directory already exists, it will skip</span>
</span><span id="SMBSession-565"><a href="#SMBSession-565"><span class="linenos"> 565</span></a><span class="sd">        the creation for that directory without raising an error.</span>
</span><span id="SMBSession-566"><a href="#SMBSession-566"><span class="linenos"> 566</span></a>
</span><span id="SMBSession-567"><a href="#SMBSession-567"><span class="linenos"> 567</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession-568"><a href="#SMBSession-568"><span class="linenos"> 568</span></a><span class="sd">            path (str, optional): The full path of the directory to create on the SMB share. Defaults to None.</span>
</span><span id="SMBSession-569"><a href="#SMBSession-569"><span class="linenos"> 569</span></a>
</span><span id="SMBSession-570"><a href="#SMBSession-570"><span class="linenos"> 570</span></a><span class="sd">        Note:</span>
</span><span id="SMBSession-571"><a href="#SMBSession-571"><span class="linenos"> 571</span></a><span class="sd">            The path should use forward slashes (&#39;/&#39;) which will be converted to backslashes (ntpath.sep) for SMB compatibility.</span>
</span><span id="SMBSession-572"><a href="#SMBSession-572"><span class="linenos"> 572</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-573"><a href="#SMBSession-573"><span class="linenos"> 573</span></a>
</span><span id="SMBSession-574"><a href="#SMBSession-574"><span class="linenos"> 574</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-575"><a href="#SMBSession-575"><span class="linenos"> 575</span></a>            <span class="c1"># Prepare path</span>
</span><span id="SMBSession-576"><a href="#SMBSession-576"><span class="linenos"> 576</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-577"><a href="#SMBSession-577"><span class="linenos"> 577</span></a>            <span class="k">if</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="SMBSession-578"><a href="#SMBSession-578"><span class="linenos"> 578</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-579"><a href="#SMBSession-579"><span class="linenos"> 579</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-580"><a href="#SMBSession-580"><span class="linenos"> 580</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
</span><span id="SMBSession-581"><a href="#SMBSession-581"><span class="linenos"> 581</span></a>
</span><span id="SMBSession-582"><a href="#SMBSession-582"><span class="linenos"> 582</span></a>            <span class="c1"># Create each dir in the path</span>
</span><span id="SMBSession-583"><a href="#SMBSession-583"><span class="linenos"> 583</span></a>            <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
</span><span id="SMBSession-584"><a href="#SMBSession-584"><span class="linenos"> 584</span></a>                <span class="n">tmp_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="n">depth</span><span class="p">])</span>
</span><span id="SMBSession-585"><a href="#SMBSession-585"><span class="linenos"> 585</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-586"><a href="#SMBSession-586"><span class="linenos"> 586</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">createDirectory</span><span class="p">(</span>
</span><span id="SMBSession-587"><a href="#SMBSession-587"><span class="linenos"> 587</span></a>                        <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-588"><a href="#SMBSession-588"><span class="linenos"> 588</span></a>                        <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">tmp_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-589"><a href="#SMBSession-589"><span class="linenos"> 589</span></a>                    <span class="p">)</span>
</span><span id="SMBSession-590"><a href="#SMBSession-590"><span class="linenos"> 590</span></a>                <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-591"><a href="#SMBSession-591"><span class="linenos"> 591</span></a>                    <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0xc0000035</span><span class="p">:</span>
</span><span id="SMBSession-592"><a href="#SMBSession-592"><span class="linenos"> 592</span></a>                        <span class="c1"># STATUS_OBJECT_NAME_COLLISION</span>
</span><span id="SMBSession-593"><a href="#SMBSession-593"><span class="linenos"> 593</span></a>                        <span class="c1"># Remote directory already created, this is normal</span>
</span><span id="SMBSession-594"><a href="#SMBSession-594"><span class="linenos"> 594</span></a>                        <span class="c1"># Src: https://github.com/fortra/impacket/blob/269ce69872f0e8f2188a80addb0c39fedfa6dcb8/impacket/nt_errors.py#L268C9-L268C19</span>
</span><span id="SMBSession-595"><a href="#SMBSession-595"><span class="linenos"> 595</span></a>                        <span class="k">pass</span>
</span><span id="SMBSession-596"><a href="#SMBSession-596"><span class="linenos"> 596</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-597"><a href="#SMBSession-597"><span class="linenos"> 597</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to create directory &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession-598"><a href="#SMBSession-598"><span class="linenos"> 598</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-599"><a href="#SMBSession-599"><span class="linenos"> 599</span></a>                            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="SMBSession-600"><a href="#SMBSession-600"><span class="linenos"> 600</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-601"><a href="#SMBSession-601"><span class="linenos"> 601</span></a>            <span class="k">pass</span>
</span><span id="SMBSession-602"><a href="#SMBSession-602"><span class="linenos"> 602</span></a>
</span><span id="SMBSession-603"><a href="#SMBSession-603"><span class="linenos"> 603</span></a>    <span class="k">def</span> <span class="nf">mount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_mount_point</span><span class="p">,</span> <span class="n">remote_path</span><span class="p">):</span>
</span><span id="SMBSession-604"><a href="#SMBSession-604"><span class="linenos"> 604</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-605"><a href="#SMBSession-605"><span class="linenos"> 605</span></a><span class="sd">        Generates the command to mount an SMB share on different platforms.</span>
</span><span id="SMBSession-606"><a href="#SMBSession-606"><span class="linenos"> 606</span></a>
</span><span id="SMBSession-607"><a href="#SMBSession-607"><span class="linenos"> 607</span></a><span class="sd">        This method takes the local mount point and the remote path of the SMB share and generates the appropriate mount command based on the platform.</span>
</span><span id="SMBSession-608"><a href="#SMBSession-608"><span class="linenos"> 608</span></a><span class="sd">        It constructs the mount command using the provided parameters and executes it using the os.system() function.</span>
</span><span id="SMBSession-609"><a href="#SMBSession-609"><span class="linenos"> 609</span></a>
</span><span id="SMBSession-610"><a href="#SMBSession-610"><span class="linenos"> 610</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession-611"><a href="#SMBSession-611"><span class="linenos"> 611</span></a><span class="sd">            local_mount_point (str): The local directory where the SMB share will be mounted.</span>
</span><span id="SMBSession-612"><a href="#SMBSession-612"><span class="linenos"> 612</span></a><span class="sd">            remote_path (str): The remote path on the SMB share to be mounted.</span>
</span><span id="SMBSession-613"><a href="#SMBSession-613"><span class="linenos"> 613</span></a>
</span><span id="SMBSession-614"><a href="#SMBSession-614"><span class="linenos"> 614</span></a><span class="sd">        Note:</span>
</span><span id="SMBSession-615"><a href="#SMBSession-615"><span class="linenos"> 615</span></a><span class="sd">            - For Windows platform, the command uses &#39;net use&#39; to mount the share.</span>
</span><span id="SMBSession-616"><a href="#SMBSession-616"><span class="linenos"> 616</span></a><span class="sd">            - For Linux platform, the command uses &#39;mount&#39; to mount the share.</span>
</span><span id="SMBSession-617"><a href="#SMBSession-617"><span class="linenos"> 617</span></a><span class="sd">            - For macOS platform, the command uses &#39;mount_smbfs&#39; to mount the share.</span>
</span><span id="SMBSession-618"><a href="#SMBSession-618"><span class="linenos"> 618</span></a><span class="sd">            - If the platform is not supported, an error message is displayed.</span>
</span><span id="SMBSession-619"><a href="#SMBSession-619"><span class="linenos"> 619</span></a>
</span><span id="SMBSession-620"><a href="#SMBSession-620"><span class="linenos"> 620</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession-621"><a href="#SMBSession-621"><span class="linenos"> 621</span></a><span class="sd">            None</span>
</span><span id="SMBSession-622"><a href="#SMBSession-622"><span class="linenos"> 622</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-623"><a href="#SMBSession-623"><span class="linenos"> 623</span></a>
</span><span id="SMBSession-624"><a href="#SMBSession-624"><span class="linenos"> 624</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_mount_point</span><span class="p">):</span>
</span><span id="SMBSession-625"><a href="#SMBSession-625"><span class="linenos"> 625</span></a>            <span class="k">pass</span>
</span><span id="SMBSession-626"><a href="#SMBSession-626"><span class="linenos"> 626</span></a>
</span><span id="SMBSession-627"><a href="#SMBSession-627"><span class="linenos"> 627</span></a>        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>
</span><span id="SMBSession-628"><a href="#SMBSession-628"><span class="linenos"> 628</span></a>            <span class="n">remote_path</span> <span class="o">=</span> <span class="n">remote_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-629"><a href="#SMBSession-629"><span class="linenos"> 629</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;net use </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2"> </span><span class="se">\\\\</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="se">\\</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="si">}</span><span class="se">\\</span><span class="si">{</span><span class="n">remote_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SMBSession-630"><a href="#SMBSession-630"><span class="linenos"> 630</span></a>        
</span><span id="SMBSession-631"><a href="#SMBSession-631"><span class="linenos"> 631</span></a>        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">):</span>
</span><span id="SMBSession-632"><a href="#SMBSession-632"><span class="linenos"> 632</span></a>            <span class="n">remote_path</span> <span class="o">=</span> <span class="n">remote_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="SMBSession-633"><a href="#SMBSession-633"><span class="linenos"> 633</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mount -t cifs //</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">remote_path</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2"> -o username=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">,password=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SMBSession-634"><a href="#SMBSession-634"><span class="linenos"> 634</span></a>        
</span><span id="SMBSession-635"><a href="#SMBSession-635"><span class="linenos"> 635</span></a>        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;darwin&#39;</span><span class="p">):</span>
</span><span id="SMBSession-636"><a href="#SMBSession-636"><span class="linenos"> 636</span></a>            <span class="n">remote_path</span> <span class="o">=</span> <span class="n">remote_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="SMBSession-637"><a href="#SMBSession-637"><span class="linenos"> 637</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mount_smbfs //</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">remote_path</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SMBSession-638"><a href="#SMBSession-638"><span class="linenos"> 638</span></a>        
</span><span id="SMBSession-639"><a href="#SMBSession-639"><span class="linenos"> 639</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-640"><a href="#SMBSession-640"><span class="linenos"> 640</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SMBSession-641"><a href="#SMBSession-641"><span class="linenos"> 641</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Unsupported platform for mounting SMB share.&quot;</span><span class="p">)</span>
</span><span id="SMBSession-642"><a href="#SMBSession-642"><span class="linenos"> 642</span></a>        
</span><span id="SMBSession-643"><a href="#SMBSession-643"><span class="linenos"> 643</span></a>        <span class="k">if</span> <span class="n">command</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-644"><a href="#SMBSession-644"><span class="linenos"> 644</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-645"><a href="#SMBSession-645"><span class="linenos"> 645</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] Executing: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">command</span><span class="p">)</span>
</span><span id="SMBSession-646"><a href="#SMBSession-646"><span class="linenos"> 646</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="SMBSession-647"><a href="#SMBSession-647"><span class="linenos"> 647</span></a>
</span><span id="SMBSession-648"><a href="#SMBSession-648"><span class="linenos"> 648</span></a>    <span class="k">def</span> <span class="nf">path_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-649"><a href="#SMBSession-649"><span class="linenos"> 649</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-650"><a href="#SMBSession-650"><span class="linenos"> 650</span></a><span class="sd">        Checks if the specified path exists on the SMB share.</span>
</span><span id="SMBSession-651"><a href="#SMBSession-651"><span class="linenos"> 651</span></a>
</span><span id="SMBSession-652"><a href="#SMBSession-652"><span class="linenos"> 652</span></a><span class="sd">        This method determines if a given path exists on the SMB share by attempting to list the contents of the path.</span>
</span><span id="SMBSession-653"><a href="#SMBSession-653"><span class="linenos"> 653</span></a><span class="sd">        If the path listing is successful and returns one or more entries, the path is considered to exist.</span>
</span><span id="SMBSession-654"><a href="#SMBSession-654"><span class="linenos"> 654</span></a>
</span><span id="SMBSession-655"><a href="#SMBSession-655"><span class="linenos"> 655</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession-656"><a href="#SMBSession-656"><span class="linenos"> 656</span></a><span class="sd">            path (str, optional): The path to check on the SMB share. Defaults to None.</span>
</span><span id="SMBSession-657"><a href="#SMBSession-657"><span class="linenos"> 657</span></a>
</span><span id="SMBSession-658"><a href="#SMBSession-658"><span class="linenos"> 658</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession-659"><a href="#SMBSession-659"><span class="linenos"> 659</span></a><span class="sd">            bool: True if the path exists, False otherwise or if an error occurs.</span>
</span><span id="SMBSession-660"><a href="#SMBSession-660"><span class="linenos"> 660</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-661"><a href="#SMBSession-661"><span class="linenos"> 661</span></a>
</span><span id="SMBSession-662"><a href="#SMBSession-662"><span class="linenos"> 662</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-663"><a href="#SMBSession-663"><span class="linenos"> 663</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="SMBSession-664"><a href="#SMBSession-664"><span class="linenos"> 664</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-665"><a href="#SMBSession-665"><span class="linenos"> 665</span></a>                <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession-666"><a href="#SMBSession-666"><span class="linenos"> 666</span></a>                    <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span>
</span><span id="SMBSession-667"><a href="#SMBSession-667"><span class="linenos"> 667</span></a>                    <span class="n">path</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-668"><a href="#SMBSession-668"><span class="linenos"> 668</span></a>                <span class="p">)</span>
</span><span id="SMBSession-669"><a href="#SMBSession-669"><span class="linenos"> 669</span></a>                <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SMBSession-670"><a href="#SMBSession-670"><span class="linenos"> 670</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession-671"><a href="#SMBSession-671"><span class="linenos"> 671</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="SMBSession-672"><a href="#SMBSession-672"><span class="linenos"> 672</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-673"><a href="#SMBSession-673"><span class="linenos"> 673</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="SMBSession-674"><a href="#SMBSession-674"><span class="linenos"> 674</span></a>   
</span><span id="SMBSession-675"><a href="#SMBSession-675"><span class="linenos"> 675</span></a>    <span class="k">def</span> <span class="nf">path_isdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathFromRoot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-676"><a href="#SMBSession-676"><span class="linenos"> 676</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-677"><a href="#SMBSession-677"><span class="linenos"> 677</span></a><span class="sd">        Checks if the specified path is a directory on the SMB share.</span>
</span><span id="SMBSession-678"><a href="#SMBSession-678"><span class="linenos"> 678</span></a>
</span><span id="SMBSession-679"><a href="#SMBSession-679"><span class="linenos"> 679</span></a><span class="sd">        This method determines if a given path corresponds to a directory on the SMB share. It does this by listing the</span>
</span><span id="SMBSession-680"><a href="#SMBSession-680"><span class="linenos"> 680</span></a><span class="sd">        contents of the path and filtering for entries that match the basename of the path and are marked as directories.</span>
</span><span id="SMBSession-681"><a href="#SMBSession-681"><span class="linenos"> 681</span></a>
</span><span id="SMBSession-682"><a href="#SMBSession-682"><span class="linenos"> 682</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession-683"><a href="#SMBSession-683"><span class="linenos"> 683</span></a><span class="sd">            path (str, optional): The path to check on the SMB share. Defaults to None.</span>
</span><span id="SMBSession-684"><a href="#SMBSession-684"><span class="linenos"> 684</span></a>
</span><span id="SMBSession-685"><a href="#SMBSession-685"><span class="linenos"> 685</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession-686"><a href="#SMBSession-686"><span class="linenos"> 686</span></a><span class="sd">            bool: True if the path is a directory, False otherwise or if an error occurs.</span>
</span><span id="SMBSession-687"><a href="#SMBSession-687"><span class="linenos"> 687</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-688"><a href="#SMBSession-688"><span class="linenos"> 688</span></a>
</span><span id="SMBSession-689"><a href="#SMBSession-689"><span class="linenos"> 689</span></a>        <span class="k">if</span> <span class="n">pathFromRoot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-690"><a href="#SMBSession-690"><span class="linenos"> 690</span></a>            <span class="c1"># Replace slashes if any</span>
</span><span id="SMBSession-691"><a href="#SMBSession-691"><span class="linenos"> 691</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">pathFromRoot</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-692"><a href="#SMBSession-692"><span class="linenos"> 692</span></a>            
</span><span id="SMBSession-693"><a href="#SMBSession-693"><span class="linenos"> 693</span></a>            <span class="c1"># Strip wildcards to avoid injections</span>
</span><span id="SMBSession-694"><a href="#SMBSession-694"><span class="linenos"> 694</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="SMBSession-695"><a href="#SMBSession-695"><span class="linenos"> 695</span></a>
</span><span id="SMBSession-696"><a href="#SMBSession-696"><span class="linenos"> 696</span></a>            <span class="c1"># Normalize path and strip leading backslash</span>
</span><span id="SMBSession-697"><a href="#SMBSession-697"><span class="linenos"> 697</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-698"><a href="#SMBSession-698"><span class="linenos"> 698</span></a>
</span><span id="SMBSession-699"><a href="#SMBSession-699"><span class="linenos"> 699</span></a>            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">]:</span>
</span><span id="SMBSession-700"><a href="#SMBSession-700"><span class="linenos"> 700</span></a>                <span class="c1"># By defininition they exist on the filesystem</span>
</span><span id="SMBSession-701"><a href="#SMBSession-701"><span class="linenos"> 701</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="SMBSession-702"><a href="#SMBSession-702"><span class="linenos"> 702</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-703"><a href="#SMBSession-703"><span class="linenos"> 703</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-704"><a href="#SMBSession-704"><span class="linenos"> 704</span></a>                    <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession-705"><a href="#SMBSession-705"><span class="linenos"> 705</span></a>                        <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span>
</span><span id="SMBSession-706"><a href="#SMBSession-706"><span class="linenos"> 706</span></a>                        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;*&#39;</span>
</span><span id="SMBSession-707"><a href="#SMBSession-707"><span class="linenos"> 707</span></a>                    <span class="p">)</span>
</span><span id="SMBSession-708"><a href="#SMBSession-708"><span class="linenos"> 708</span></a>                    <span class="c1"># Filter on directories</span>
</span><span id="SMBSession-709"><a href="#SMBSession-709"><span class="linenos"> 709</span></a>                    <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SMBSession-710"><a href="#SMBSession-710"><span class="linenos"> 710</span></a>                        <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span>
</span><span id="SMBSession-711"><a href="#SMBSession-711"><span class="linenos"> 711</span></a>                        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">==</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">is_directory</span><span class="p">()</span>
</span><span id="SMBSession-712"><a href="#SMBSession-712"><span class="linenos"> 712</span></a>                    <span class="p">]</span>
</span><span id="SMBSession-713"><a href="#SMBSession-713"><span class="linenos"> 713</span></a>                    <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SMBSession-714"><a href="#SMBSession-714"><span class="linenos"> 714</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession-715"><a href="#SMBSession-715"><span class="linenos"> 715</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="SMBSession-716"><a href="#SMBSession-716"><span class="linenos"> 716</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-717"><a href="#SMBSession-717"><span class="linenos"> 717</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="SMBSession-718"><a href="#SMBSession-718"><span class="linenos"> 718</span></a>
</span><span id="SMBSession-719"><a href="#SMBSession-719"><span class="linenos"> 719</span></a>    <span class="k">def</span> <span class="nf">path_isfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-720"><a href="#SMBSession-720"><span class="linenos"> 720</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-721"><a href="#SMBSession-721"><span class="linenos"> 721</span></a><span class="sd">        Checks if the specified path is a file on the SMB share.</span>
</span><span id="SMBSession-722"><a href="#SMBSession-722"><span class="linenos"> 722</span></a>
</span><span id="SMBSession-723"><a href="#SMBSession-723"><span class="linenos"> 723</span></a><span class="sd">        This method determines if a given path corresponds to a file on the SMB share. It does this by listing the</span>
</span><span id="SMBSession-724"><a href="#SMBSession-724"><span class="linenos"> 724</span></a><span class="sd">        contents of the path and filtering for entries that match the basename of the path and are not marked as directories.</span>
</span><span id="SMBSession-725"><a href="#SMBSession-725"><span class="linenos"> 725</span></a>
</span><span id="SMBSession-726"><a href="#SMBSession-726"><span class="linenos"> 726</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession-727"><a href="#SMBSession-727"><span class="linenos"> 727</span></a><span class="sd">            path (str, optional): The path to check on the SMB share. Defaults to None.</span>
</span><span id="SMBSession-728"><a href="#SMBSession-728"><span class="linenos"> 728</span></a>
</span><span id="SMBSession-729"><a href="#SMBSession-729"><span class="linenos"> 729</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession-730"><a href="#SMBSession-730"><span class="linenos"> 730</span></a><span class="sd">            bool: True if the path is a file, False otherwise or if an error occurs.</span>
</span><span id="SMBSession-731"><a href="#SMBSession-731"><span class="linenos"> 731</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-732"><a href="#SMBSession-732"><span class="linenos"> 732</span></a>
</span><span id="SMBSession-733"><a href="#SMBSession-733"><span class="linenos"> 733</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-734"><a href="#SMBSession-734"><span class="linenos"> 734</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="SMBSession-735"><a href="#SMBSession-735"><span class="linenos"> 735</span></a>            <span class="n">search_dir</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession-736"><a href="#SMBSession-736"><span class="linenos"> 736</span></a>            <span class="n">search_dir</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">search_dir</span><span class="p">)</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span>
</span><span id="SMBSession-737"><a href="#SMBSession-737"><span class="linenos"> 737</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-738"><a href="#SMBSession-738"><span class="linenos"> 738</span></a>                <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession-739"><a href="#SMBSession-739"><span class="linenos"> 739</span></a>                    <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span>
</span><span id="SMBSession-740"><a href="#SMBSession-740"><span class="linenos"> 740</span></a>                    <span class="n">path</span><span class="o">=</span><span class="n">search_dir</span>
</span><span id="SMBSession-741"><a href="#SMBSession-741"><span class="linenos"> 741</span></a>                <span class="p">)</span>
</span><span id="SMBSession-742"><a href="#SMBSession-742"><span class="linenos"> 742</span></a>                <span class="c1"># Filter on files</span>
</span><span id="SMBSession-743"><a href="#SMBSession-743"><span class="linenos"> 743</span></a>                <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SMBSession-744"><a href="#SMBSession-744"><span class="linenos"> 744</span></a>                    <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span>
</span><span id="SMBSession-745"><a href="#SMBSession-745"><span class="linenos"> 745</span></a>                    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">==</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">is_directory</span><span class="p">()</span>
</span><span id="SMBSession-746"><a href="#SMBSession-746"><span class="linenos"> 746</span></a>                <span class="p">]</span>
</span><span id="SMBSession-747"><a href="#SMBSession-747"><span class="linenos"> 747</span></a>                <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SMBSession-748"><a href="#SMBSession-748"><span class="linenos"> 748</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession-749"><a href="#SMBSession-749"><span class="linenos"> 749</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="SMBSession-750"><a href="#SMBSession-750"><span class="linenos"> 750</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-751"><a href="#SMBSession-751"><span class="linenos"> 751</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="SMBSession-752"><a href="#SMBSession-752"><span class="linenos"> 752</span></a>
</span><span id="SMBSession-753"><a href="#SMBSession-753"><span class="linenos"> 753</span></a>    <span class="k">def</span> <span class="nf">ping_smb_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SMBSession-754"><a href="#SMBSession-754"><span class="linenos"> 754</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-755"><a href="#SMBSession-755"><span class="linenos"> 755</span></a><span class="sd">        Tests the connectivity to the SMB server by sending an echo command.</span>
</span><span id="SMBSession-756"><a href="#SMBSession-756"><span class="linenos"> 756</span></a>
</span><span id="SMBSession-757"><a href="#SMBSession-757"><span class="linenos"> 757</span></a><span class="sd">        This method attempts to send an echo command to the SMB server to check if the session is still active.</span>
</span><span id="SMBSession-758"><a href="#SMBSession-758"><span class="linenos"> 758</span></a><span class="sd">        It updates the `connected` attribute of the class based on the success or failure of the echo command.</span>
</span><span id="SMBSession-759"><a href="#SMBSession-759"><span class="linenos"> 759</span></a>
</span><span id="SMBSession-760"><a href="#SMBSession-760"><span class="linenos"> 760</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession-761"><a href="#SMBSession-761"><span class="linenos"> 761</span></a><span class="sd">            bool: True if the echo command succeeds (indicating the session is active), False otherwise.</span>
</span><span id="SMBSession-762"><a href="#SMBSession-762"><span class="linenos"> 762</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-763"><a href="#SMBSession-763"><span class="linenos"> 763</span></a>
</span><span id="SMBSession-764"><a href="#SMBSession-764"><span class="linenos"> 764</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-765"><a href="#SMBSession-765"><span class="linenos"> 765</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getSMBServer</span><span class="p">()</span><span class="o">.</span><span class="n">echo</span><span class="p">()</span>
</span><span id="SMBSession-766"><a href="#SMBSession-766"><span class="linenos"> 766</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession-767"><a href="#SMBSession-767"><span class="linenos"> 767</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession-768"><a href="#SMBSession-768"><span class="linenos"> 768</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span>
</span><span id="SMBSession-769"><a href="#SMBSession-769"><span class="linenos"> 769</span></a>
</span><span id="SMBSession-770"><a href="#SMBSession-770"><span class="linenos"> 770</span></a>    <span class="k">def</span> <span class="nf">put_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-771"><a href="#SMBSession-771"><span class="linenos"> 771</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-772"><a href="#SMBSession-772"><span class="linenos"> 772</span></a><span class="sd">        Uploads a single file to the SMB share.</span>
</span><span id="SMBSession-773"><a href="#SMBSession-773"><span class="linenos"> 773</span></a>
</span><span id="SMBSession-774"><a href="#SMBSession-774"><span class="linenos"> 774</span></a><span class="sd">        This method takes a local file path, opens the file, and uploads it to the SMB share at the specified path.</span>
</span><span id="SMBSession-775"><a href="#SMBSession-775"><span class="linenos"> 775</span></a><span class="sd">        It handles exceptions such as broken pipe errors or keyboard interrupts by closing and reinitializing the SMB session.</span>
</span><span id="SMBSession-776"><a href="#SMBSession-776"><span class="linenos"> 776</span></a><span class="sd">        General exceptions are caught and logged, with a traceback provided if debugging is enabled.</span>
</span><span id="SMBSession-777"><a href="#SMBSession-777"><span class="linenos"> 777</span></a>
</span><span id="SMBSession-778"><a href="#SMBSession-778"><span class="linenos"> 778</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession-779"><a href="#SMBSession-779"><span class="linenos"> 779</span></a><span class="sd">            localpath (str, optional): The local file path of the file to be uploaded. Defaults to None.</span>
</span><span id="SMBSession-780"><a href="#SMBSession-780"><span class="linenos"> 780</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-781"><a href="#SMBSession-781"><span class="linenos"> 781</span></a>
</span><span id="SMBSession-782"><a href="#SMBSession-782"><span class="linenos"> 782</span></a>        <span class="c1"># Parse path</span>
</span><span id="SMBSession-783"><a href="#SMBSession-783"><span class="linenos"> 783</span></a>        <span class="n">localpath</span> <span class="o">=</span> <span class="n">localpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-784"><a href="#SMBSession-784"><span class="linenos"> 784</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">localpath</span><span class="p">:</span>
</span><span id="SMBSession-785"><a href="#SMBSession-785"><span class="linenos"> 785</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">localpath</span><span class="p">))</span>
</span><span id="SMBSession-786"><a href="#SMBSession-786"><span class="linenos"> 786</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-787"><a href="#SMBSession-787"><span class="linenos"> 787</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-788"><a href="#SMBSession-788"><span class="linenos"> 788</span></a>        <span class="c1"># Parse filename</span>
</span><span id="SMBSession-789"><a href="#SMBSession-789"><span class="linenos"> 789</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">localpath</span><span class="p">)</span>
</span><span id="SMBSession-790"><a href="#SMBSession-790"><span class="linenos"> 790</span></a>
</span><span id="SMBSession-791"><a href="#SMBSession-791"><span class="linenos"> 791</span></a>        <span class="c1"># Search for the file</span>
</span><span id="SMBSession-792"><a href="#SMBSession-792"><span class="linenos"> 792</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">tmp_search_path</span><span class="p">)</span>
</span><span id="SMBSession-793"><a href="#SMBSession-793"><span class="linenos"> 793</span></a>        <span class="c1"># Filter the entries</span>
</span><span id="SMBSession-794"><a href="#SMBSession-794"><span class="linenos"> 794</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SMBSession-795"><a href="#SMBSession-795"><span class="linenos"> 795</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="SMBSession-796"><a href="#SMBSession-796"><span class="linenos"> 796</span></a>            <span class="k">if</span> <span class="n">entry</span> <span class="o">==</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SMBSession-797"><a href="#SMBSession-797"><span class="linenos"> 797</span></a>                <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="SMBSession-798"><a href="#SMBSession-798"><span class="linenos"> 798</span></a>            <span class="k">elif</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SMBSession-799"><a href="#SMBSession-799"><span class="linenos"> 799</span></a>                <span class="n">regexp</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;.*&#39;</span><span class="p">)</span>
</span><span id="SMBSession-800"><a href="#SMBSession-800"><span class="linenos"> 800</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
</span><span id="SMBSession-801"><a href="#SMBSession-801"><span class="linenos"> 801</span></a>                    <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="SMBSession-802"><a href="#SMBSession-802"><span class="linenos"> 802</span></a>
</span><span id="SMBSession-803"><a href="#SMBSession-803"><span class="linenos"> 803</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">matching_entries</span><span class="p">)))</span>
</span><span id="SMBSession-804"><a href="#SMBSession-804"><span class="linenos"> 804</span></a>
</span><span id="SMBSession-805"><a href="#SMBSession-805"><span class="linenos"> 805</span></a>        <span class="c1"># Loop and upload</span>
</span><span id="SMBSession-806"><a href="#SMBSession-806"><span class="linenos"> 806</span></a>        <span class="k">for</span> <span class="n">localpath</span> <span class="ow">in</span> <span class="n">matching_entries</span><span class="p">:</span>
</span><span id="SMBSession-807"><a href="#SMBSession-807"><span class="linenos"> 807</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="SMBSession-808"><a href="#SMBSession-808"><span class="linenos"> 808</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="SMBSession-809"><a href="#SMBSession-809"><span class="linenos"> 809</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-810"><a href="#SMBSession-810"><span class="linenos"> 810</span></a>                        <span class="n">localfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">localpath</span><span class="p">)</span>
</span><span id="SMBSession-811"><a href="#SMBSession-811"><span class="linenos"> 811</span></a>                        <span class="n">f</span> <span class="o">=</span> <span class="n">LocalFileIO</span><span class="p">(</span>
</span><span id="SMBSession-812"><a href="#SMBSession-812"><span class="linenos"> 812</span></a>                            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">,</span> 
</span><span id="SMBSession-813"><a href="#SMBSession-813"><span class="linenos"> 813</span></a>                            <span class="n">path</span><span class="o">=</span><span class="n">localpath</span><span class="p">,</span> 
</span><span id="SMBSession-814"><a href="#SMBSession-814"><span class="linenos"> 814</span></a>                            <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span>
</span><span id="SMBSession-815"><a href="#SMBSession-815"><span class="linenos"> 815</span></a>                        <span class="p">)</span>
</span><span id="SMBSession-816"><a href="#SMBSession-816"><span class="linenos"> 816</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">putFile</span><span class="p">(</span>
</span><span id="SMBSession-817"><a href="#SMBSession-817"><span class="linenos"> 817</span></a>                            <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-818"><a href="#SMBSession-818"><span class="linenos"> 818</span></a>                            <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">localfile</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">),</span> 
</span><span id="SMBSession-819"><a href="#SMBSession-819"><span class="linenos"> 819</span></a>                            <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span>
</span><span id="SMBSession-820"><a href="#SMBSession-820"><span class="linenos"> 820</span></a>                        <span class="p">)</span>
</span><span id="SMBSession-821"><a href="#SMBSession-821"><span class="linenos"> 821</span></a>                        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession-822"><a href="#SMBSession-822"><span class="linenos"> 822</span></a>                    <span class="k">except</span> <span class="p">(</span><span class="ne">BrokenPipeError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-823"><a href="#SMBSession-823"><span class="linenos"> 823</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Interrupted.&quot;</span><span class="p">)</span>
</span><span id="SMBSession-824"><a href="#SMBSession-824"><span class="linenos"> 824</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">close_smb_session</span><span class="p">()</span>
</span><span id="SMBSession-825"><a href="#SMBSession-825"><span class="linenos"> 825</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">init_smb_session</span><span class="p">()</span>
</span><span id="SMBSession-826"><a href="#SMBSession-826"><span class="linenos"> 826</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-827"><a href="#SMBSession-827"><span class="linenos"> 827</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to upload &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">localfile</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession-828"><a href="#SMBSession-828"><span class="linenos"> 828</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-829"><a href="#SMBSession-829"><span class="linenos"> 829</span></a>                            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="SMBSession-830"><a href="#SMBSession-830"><span class="linenos"> 830</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-831"><a href="#SMBSession-831"><span class="linenos"> 831</span></a>                    <span class="c1"># [!] The specified localpath is a directory. Use &#39;put -r &lt;directory&gt;&#39; instead.</span>
</span><span id="SMBSession-832"><a href="#SMBSession-832"><span class="linenos"> 832</span></a>                    <span class="k">pass</span>
</span><span id="SMBSession-833"><a href="#SMBSession-833"><span class="linenos"> 833</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-834"><a href="#SMBSession-834"><span class="linenos"> 834</span></a>                <span class="c1"># [!] The specified localpath does not exist.</span>
</span><span id="SMBSession-835"><a href="#SMBSession-835"><span class="linenos"> 835</span></a>                <span class="k">pass</span>
</span><span id="SMBSession-836"><a href="#SMBSession-836"><span class="linenos"> 836</span></a>
</span><span id="SMBSession-837"><a href="#SMBSession-837"><span class="linenos"> 837</span></a>    <span class="k">def</span> <span class="nf">put_file_recursively</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-838"><a href="#SMBSession-838"><span class="linenos"> 838</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-839"><a href="#SMBSession-839"><span class="linenos"> 839</span></a><span class="sd">        Recursively uploads files from a specified local directory to the SMB share.</span>
</span><span id="SMBSession-840"><a href="#SMBSession-840"><span class="linenos"> 840</span></a>
</span><span id="SMBSession-841"><a href="#SMBSession-841"><span class="linenos"> 841</span></a><span class="sd">        This method walks through the given local directory and all its subdirectories, uploading each file to the</span>
</span><span id="SMBSession-842"><a href="#SMBSession-842"><span class="linenos"> 842</span></a><span class="sd">        corresponding directory structure on the SMB share. It first checks if the local path is a directory. If it is,</span>
</span><span id="SMBSession-843"><a href="#SMBSession-843"><span class="linenos"> 843</span></a><span class="sd">        it iterates over all files and directories within the local path, creating necessary directories on the SMB share</span>
</span><span id="SMBSession-844"><a href="#SMBSession-844"><span class="linenos"> 844</span></a><span class="sd">        and uploading files. If the local path is not a directory, it prints an error message.</span>
</span><span id="SMBSession-845"><a href="#SMBSession-845"><span class="linenos"> 845</span></a>
</span><span id="SMBSession-846"><a href="#SMBSession-846"><span class="linenos"> 846</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession-847"><a href="#SMBSession-847"><span class="linenos"> 847</span></a><span class="sd">            localpath (str, optional): The local directory path from which files will be uploaded. Defaults to None.</span>
</span><span id="SMBSession-848"><a href="#SMBSession-848"><span class="linenos"> 848</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-849"><a href="#SMBSession-849"><span class="linenos"> 849</span></a>
</span><span id="SMBSession-850"><a href="#SMBSession-850"><span class="linenos"> 850</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="SMBSession-851"><a href="#SMBSession-851"><span class="linenos"> 851</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="SMBSession-852"><a href="#SMBSession-852"><span class="linenos"> 852</span></a>                <span class="c1"># Iterate over all files and directories within the local path</span>
</span><span id="SMBSession-853"><a href="#SMBSession-853"><span class="linenos"> 853</span></a>                <span class="n">local_files</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SMBSession-854"><a href="#SMBSession-854"><span class="linenos"> 854</span></a>                <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="SMBSession-855"><a href="#SMBSession-855"><span class="linenos"> 855</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession-856"><a href="#SMBSession-856"><span class="linenos"> 856</span></a>                        <span class="n">local_files</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="n">files</span>
</span><span id="SMBSession-857"><a href="#SMBSession-857"><span class="linenos"> 857</span></a>
</span><span id="SMBSession-858"><a href="#SMBSession-858"><span class="linenos"> 858</span></a>                <span class="c1"># Iterate over the found files</span>
</span><span id="SMBSession-859"><a href="#SMBSession-859"><span class="linenos"> 859</span></a>                <span class="k">for</span> <span class="n">local_dir_path</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">local_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="SMBSession-860"><a href="#SMBSession-860"><span class="linenos"> 860</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[&gt;] Putting files of &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">local_dir_path</span><span class="p">)</span>
</span><span id="SMBSession-861"><a href="#SMBSession-861"><span class="linenos"> 861</span></a>
</span><span id="SMBSession-862"><a href="#SMBSession-862"><span class="linenos"> 862</span></a>                    <span class="c1"># Create remote directory</span>
</span><span id="SMBSession-863"><a href="#SMBSession-863"><span class="linenos"> 863</span></a>                    <span class="n">remote_dir_path</span> <span class="o">=</span> <span class="n">local_dir_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-864"><a href="#SMBSession-864"><span class="linenos"> 864</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="SMBSession-865"><a href="#SMBSession-865"><span class="linenos"> 865</span></a>                        <span class="n">path</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">remote_dir_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-866"><a href="#SMBSession-866"><span class="linenos"> 866</span></a>                    <span class="p">)</span>
</span><span id="SMBSession-867"><a href="#SMBSession-867"><span class="linenos"> 867</span></a>
</span><span id="SMBSession-868"><a href="#SMBSession-868"><span class="linenos"> 868</span></a>                    <span class="k">for</span> <span class="n">local_file_path</span> <span class="ow">in</span> <span class="n">local_files</span><span class="p">[</span><span class="n">local_dir_path</span><span class="p">]:</span>
</span><span id="SMBSession-869"><a href="#SMBSession-869"><span class="linenos"> 869</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-870"><a href="#SMBSession-870"><span class="linenos"> 870</span></a>                            <span class="n">f</span> <span class="o">=</span> <span class="n">LocalFileIO</span><span class="p">(</span>
</span><span id="SMBSession-871"><a href="#SMBSession-871"><span class="linenos"> 871</span></a>                                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">,</span> 
</span><span id="SMBSession-872"><a href="#SMBSession-872"><span class="linenos"> 872</span></a>                                <span class="n">path</span><span class="o">=</span><span class="n">local_dir_path</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">local_file_path</span><span class="p">,</span> 
</span><span id="SMBSession-873"><a href="#SMBSession-873"><span class="linenos"> 873</span></a>                                <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span>
</span><span id="SMBSession-874"><a href="#SMBSession-874"><span class="linenos"> 874</span></a>                            <span class="p">)</span>
</span><span id="SMBSession-875"><a href="#SMBSession-875"><span class="linenos"> 875</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">putFile</span><span class="p">(</span>
</span><span id="SMBSession-876"><a href="#SMBSession-876"><span class="linenos"> 876</span></a>                                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-877"><a href="#SMBSession-877"><span class="linenos"> 877</span></a>                                <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">remote_dir_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">local_file_path</span><span class="p">),</span> 
</span><span id="SMBSession-878"><a href="#SMBSession-878"><span class="linenos"> 878</span></a>                                <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span>
</span><span id="SMBSession-879"><a href="#SMBSession-879"><span class="linenos"> 879</span></a>                            <span class="p">)</span>
</span><span id="SMBSession-880"><a href="#SMBSession-880"><span class="linenos"> 880</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession-881"><a href="#SMBSession-881"><span class="linenos"> 881</span></a>
</span><span id="SMBSession-882"><a href="#SMBSession-882"><span class="linenos"> 882</span></a>                        <span class="k">except</span> <span class="ne">BrokenPipeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-883"><a href="#SMBSession-883"><span class="linenos"> 883</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">set_error</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;[bold red]Failed uploading &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession-884"><a href="#SMBSession-884"><span class="linenos"> 884</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SMBSession-885"><a href="#SMBSession-885"><span class="linenos"> 885</span></a>                            <span class="k">break</span>
</span><span id="SMBSession-886"><a href="#SMBSession-886"><span class="linenos"> 886</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-887"><a href="#SMBSession-887"><span class="linenos"> 887</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">set_error</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;[bold red]Failed uploading &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession-888"><a href="#SMBSession-888"><span class="linenos"> 888</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SMBSession-889"><a href="#SMBSession-889"><span class="linenos"> 889</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-890"><a href="#SMBSession-890"><span class="linenos"> 890</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] The specified localpath is a file. Use &#39;put &lt;file&gt;&#39; instead.&quot;</span><span class="p">)</span>
</span><span id="SMBSession-891"><a href="#SMBSession-891"><span class="linenos"> 891</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-892"><a href="#SMBSession-892"><span class="linenos"> 892</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] The specified localpath does not exist.&quot;</span><span class="p">)</span>
</span><span id="SMBSession-893"><a href="#SMBSession-893"><span class="linenos"> 893</span></a>
</span><span id="SMBSession-894"><a href="#SMBSession-894"><span class="linenos"> 894</span></a>    <span class="k">def</span> <span class="nf">rmdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-895"><a href="#SMBSession-895"><span class="linenos"> 895</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-896"><a href="#SMBSession-896"><span class="linenos"> 896</span></a><span class="sd">        Removes a directory from the SMB share at the specified path.</span>
</span><span id="SMBSession-897"><a href="#SMBSession-897"><span class="linenos"> 897</span></a>
</span><span id="SMBSession-898"><a href="#SMBSession-898"><span class="linenos"> 898</span></a><span class="sd">        This method attempts to delete a directory located at the given path on the SMB share. If the operation fails,</span>
</span><span id="SMBSession-899"><a href="#SMBSession-899"><span class="linenos"> 899</span></a><span class="sd">        it prints an error message indicating the failure and the reason. If debugging is enabled, it also prints</span>
</span><span id="SMBSession-900"><a href="#SMBSession-900"><span class="linenos"> 900</span></a><span class="sd">        the stack trace of the exception.</span>
</span><span id="SMBSession-901"><a href="#SMBSession-901"><span class="linenos"> 901</span></a>
</span><span id="SMBSession-902"><a href="#SMBSession-902"><span class="linenos"> 902</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession-903"><a href="#SMBSession-903"><span class="linenos"> 903</span></a><span class="sd">            path (str, optional): The path of the directory to be removed on the SMB share. Defaults to None.</span>
</span><span id="SMBSession-904"><a href="#SMBSession-904"><span class="linenos"> 904</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-905"><a href="#SMBSession-905"><span class="linenos"> 905</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-906"><a href="#SMBSession-906"><span class="linenos"> 906</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">deleteDirectory</span><span class="p">(</span>
</span><span id="SMBSession-907"><a href="#SMBSession-907"><span class="linenos"> 907</span></a>                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-908"><a href="#SMBSession-908"><span class="linenos"> 908</span></a>                <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span><span class="p">),</span> 
</span><span id="SMBSession-909"><a href="#SMBSession-909"><span class="linenos"> 909</span></a>            <span class="p">)</span>
</span><span id="SMBSession-910"><a href="#SMBSession-910"><span class="linenos"> 910</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-911"><a href="#SMBSession-911"><span class="linenos"> 911</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to remove directory &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession-912"><a href="#SMBSession-912"><span class="linenos"> 912</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-913"><a href="#SMBSession-913"><span class="linenos"> 913</span></a>                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="SMBSession-914"><a href="#SMBSession-914"><span class="linenos"> 914</span></a>
</span><span id="SMBSession-915"><a href="#SMBSession-915"><span class="linenos"> 915</span></a>    <span class="k">def</span> <span class="nf">rm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-916"><a href="#SMBSession-916"><span class="linenos"> 916</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-917"><a href="#SMBSession-917"><span class="linenos"> 917</span></a><span class="sd">        Removes a file from the SMB share at the specified path.</span>
</span><span id="SMBSession-918"><a href="#SMBSession-918"><span class="linenos"> 918</span></a>
</span><span id="SMBSession-919"><a href="#SMBSession-919"><span class="linenos"> 919</span></a><span class="sd">        This method attempts to delete a file located at the given path on the SMB share. If the operation fails,</span>
</span><span id="SMBSession-920"><a href="#SMBSession-920"><span class="linenos"> 920</span></a><span class="sd">        it prints an error message indicating the failure and the reason. If debugging is enabled, it also prints</span>
</span><span id="SMBSession-921"><a href="#SMBSession-921"><span class="linenos"> 921</span></a><span class="sd">        the stack trace of the exception.</span>
</span><span id="SMBSession-922"><a href="#SMBSession-922"><span class="linenos"> 922</span></a>
</span><span id="SMBSession-923"><a href="#SMBSession-923"><span class="linenos"> 923</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession-924"><a href="#SMBSession-924"><span class="linenos"> 924</span></a><span class="sd">            path (str, optional): The path of the file to be removed on the SMB share. Defaults to None.</span>
</span><span id="SMBSession-925"><a href="#SMBSession-925"><span class="linenos"> 925</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-926"><a href="#SMBSession-926"><span class="linenos"> 926</span></a>
</span><span id="SMBSession-927"><a href="#SMBSession-927"><span class="linenos"> 927</span></a>        <span class="c1"># Parse path</span>
</span><span id="SMBSession-928"><a href="#SMBSession-928"><span class="linenos"> 928</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-929"><a href="#SMBSession-929"><span class="linenos"> 929</span></a>        <span class="k">if</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="SMBSession-930"><a href="#SMBSession-930"><span class="linenos"> 930</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="SMBSession-931"><a href="#SMBSession-931"><span class="linenos"> 931</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-932"><a href="#SMBSession-932"><span class="linenos"> 932</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-933"><a href="#SMBSession-933"><span class="linenos"> 933</span></a>        <span class="c1"># Parse filename</span>
</span><span id="SMBSession-934"><a href="#SMBSession-934"><span class="linenos"> 934</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession-935"><a href="#SMBSession-935"><span class="linenos"> 935</span></a>
</span><span id="SMBSession-936"><a href="#SMBSession-936"><span class="linenos"> 936</span></a>        <span class="c1"># Search for the file</span>
</span><span id="SMBSession-937"><a href="#SMBSession-937"><span class="linenos"> 937</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession-938"><a href="#SMBSession-938"><span class="linenos"> 938</span></a>            <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-939"><a href="#SMBSession-939"><span class="linenos"> 939</span></a>            <span class="n">path</span><span class="o">=</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span>
</span><span id="SMBSession-940"><a href="#SMBSession-940"><span class="linenos"> 940</span></a>        <span class="p">)</span>   
</span><span id="SMBSession-941"><a href="#SMBSession-941"><span class="linenos"> 941</span></a>
</span><span id="SMBSession-942"><a href="#SMBSession-942"><span class="linenos"> 942</span></a>        <span class="c1"># Filter the entries</span>
</span><span id="SMBSession-943"><a href="#SMBSession-943"><span class="linenos"> 943</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SMBSession-944"><a href="#SMBSession-944"><span class="linenos"> 944</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="SMBSession-945"><a href="#SMBSession-945"><span class="linenos"> 945</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession-946"><a href="#SMBSession-946"><span class="linenos"> 946</span></a>                <span class="c1"># Skip directories</span>
</span><span id="SMBSession-947"><a href="#SMBSession-947"><span class="linenos"> 947</span></a>                <span class="k">continue</span>
</span><span id="SMBSession-948"><a href="#SMBSession-948"><span class="linenos"> 948</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">==</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SMBSession-949"><a href="#SMBSession-949"><span class="linenos"> 949</span></a>                <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="SMBSession-950"><a href="#SMBSession-950"><span class="linenos"> 950</span></a>            <span class="k">elif</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SMBSession-951"><a href="#SMBSession-951"><span class="linenos"> 951</span></a>                <span class="n">regexp</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;.*&#39;</span><span class="p">)</span>
</span><span id="SMBSession-952"><a href="#SMBSession-952"><span class="linenos"> 952</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()):</span>
</span><span id="SMBSession-953"><a href="#SMBSession-953"><span class="linenos"> 953</span></a>                    <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="SMBSession-954"><a href="#SMBSession-954"><span class="linenos"> 954</span></a>        
</span><span id="SMBSession-955"><a href="#SMBSession-955"><span class="linenos"> 955</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">matching_entries</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_longname</span><span class="p">())</span>
</span><span id="SMBSession-956"><a href="#SMBSession-956"><span class="linenos"> 956</span></a>
</span><span id="SMBSession-957"><a href="#SMBSession-957"><span class="linenos"> 957</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matching_entries</span><span class="p">:</span>
</span><span id="SMBSession-958"><a href="#SMBSession-958"><span class="linenos"> 958</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-959"><a href="#SMBSession-959"><span class="linenos"> 959</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">deleteFile</span><span class="p">(</span>
</span><span id="SMBSession-960"><a href="#SMBSession-960"><span class="linenos"> 960</span></a>                    <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-961"><a href="#SMBSession-961"><span class="linenos"> 961</span></a>                    <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()),</span> 
</span><span id="SMBSession-962"><a href="#SMBSession-962"><span class="linenos"> 962</span></a>                <span class="p">)</span>
</span><span id="SMBSession-963"><a href="#SMBSession-963"><span class="linenos"> 963</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-964"><a href="#SMBSession-964"><span class="linenos"> 964</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to remove file &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession-965"><a href="#SMBSession-965"><span class="linenos"> 965</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-966"><a href="#SMBSession-966"><span class="linenos"> 966</span></a>                    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="SMBSession-967"><a href="#SMBSession-967"><span class="linenos"> 967</span></a>
</span><span id="SMBSession-968"><a href="#SMBSession-968"><span class="linenos"> 968</span></a>    <span class="k">def</span> <span class="nf">tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-969"><a href="#SMBSession-969"><span class="linenos"> 969</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-970"><a href="#SMBSession-970"><span class="linenos"> 970</span></a><span class="sd">        Recursively lists the directory structure of the SMB share starting from the specified path.</span>
</span><span id="SMBSession-971"><a href="#SMBSession-971"><span class="linenos"> 971</span></a>
</span><span id="SMBSession-972"><a href="#SMBSession-972"><span class="linenos"> 972</span></a><span class="sd">        This function prints a visual representation of the directory tree of the remote SMB share. It uses</span>
</span><span id="SMBSession-973"><a href="#SMBSession-973"><span class="linenos"> 973</span></a><span class="sd">        recursion to navigate through directories and lists all files and subdirectories in each directory.</span>
</span><span id="SMBSession-974"><a href="#SMBSession-974"><span class="linenos"> 974</span></a><span class="sd">        The output is color-coded and formatted to enhance readability, with directories highlighted in cyan.</span>
</span><span id="SMBSession-975"><a href="#SMBSession-975"><span class="linenos"> 975</span></a>
</span><span id="SMBSession-976"><a href="#SMBSession-976"><span class="linenos"> 976</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession-977"><a href="#SMBSession-977"><span class="linenos"> 977</span></a><span class="sd">            path (str, optional): The starting path on the SMB share from which to begin listing the tree.</span>
</span><span id="SMBSession-978"><a href="#SMBSession-978"><span class="linenos"> 978</span></a><span class="sd">                                  Defaults to the root of the current share.</span>
</span><span id="SMBSession-979"><a href="#SMBSession-979"><span class="linenos"> 979</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-980"><a href="#SMBSession-980"><span class="linenos"> 980</span></a>        
</span><span id="SMBSession-981"><a href="#SMBSession-981"><span class="linenos"> 981</span></a>        <span class="k">def</span> <span class="nf">recurse_action</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="p">[],</span> <span class="n">prompt</span><span class="o">=</span><span class="p">[]):</span>
</span><span id="SMBSession-982"><a href="#SMBSession-982"><span class="linenos"> 982</span></a>            <span class="n">bars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;│   &quot;</span><span class="p">,</span> <span class="s2">&quot;├── &quot;</span><span class="p">,</span> <span class="s2">&quot;└── &quot;</span><span class="p">]</span>
</span><span id="SMBSession-983"><a href="#SMBSession-983"><span class="linenos"> 983</span></a>
</span><span id="SMBSession-984"><a href="#SMBSession-984"><span class="linenos"> 984</span></a>            <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">base_dir</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="SMBSession-985"><a href="#SMBSession-985"><span class="linenos"> 985</span></a>
</span><span id="SMBSession-986"><a href="#SMBSession-986"><span class="linenos"> 986</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SMBSession-987"><a href="#SMBSession-987"><span class="linenos"> 987</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-988"><a href="#SMBSession-988"><span class="linenos"> 988</span></a>                <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession-989"><a href="#SMBSession-989"><span class="linenos"> 989</span></a>                    <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession-990"><a href="#SMBSession-990"><span class="linenos"> 990</span></a>                    <span class="n">path</span><span class="o">=</span><span class="n">remote_smb_path</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">*&#39;</span>
</span><span id="SMBSession-991"><a href="#SMBSession-991"><span class="linenos"> 991</span></a>                <span class="p">)</span>
</span><span id="SMBSession-992"><a href="#SMBSession-992"><span class="linenos"> 992</span></a>            <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession-993"><a href="#SMBSession-993"><span class="linenos"> 993</span></a>                <span class="n">code</span><span class="p">,</span> <span class="n">const</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">getErrorCode</span><span class="p">(),</span> <span class="n">err</span><span class="o">.</span><span class="n">getErrorString</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">err</span><span class="o">.</span><span class="n">getErrorString</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SMBSession-994"><a href="#SMBSession-994"><span class="linenos"> 994</span></a>                <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;Error 0x</span><span class="si">%08x</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">const</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span id="SMBSession-995"><a href="#SMBSession-995"><span class="linenos"> 995</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession-996"><a href="#SMBSession-996"><span class="linenos"> 996</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">errmsg</span><span class="p">))</span>
</span><span id="SMBSession-997"><a href="#SMBSession-997"><span class="linenos"> 997</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-998"><a href="#SMBSession-998"><span class="linenos"> 998</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;91m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">errmsg</span><span class="p">))</span>
</span><span id="SMBSession-999"><a href="#SMBSession-999"><span class="linenos"> 999</span></a>                <span class="k">return</span> 
</span><span id="SMBSession-1000"><a href="#SMBSession-1000"><span class="linenos">1000</span></a>
</span><span id="SMBSession-1001"><a href="#SMBSession-1001"><span class="linenos">1001</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">]]</span>
</span><span id="SMBSession-1002"><a href="#SMBSession-1002"><span class="linenos">1002</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">get_longname</span><span class="p">())</span>
</span><span id="SMBSession-1003"><a href="#SMBSession-1003"><span class="linenos">1003</span></a>
</span><span id="SMBSession-1004"><a href="#SMBSession-1004"><span class="linenos">1004</span></a>            <span class="c1"># </span>
</span><span id="SMBSession-1005"><a href="#SMBSession-1005"><span class="linenos">1005</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SMBSession-1006"><a href="#SMBSession-1006"><span class="linenos">1006</span></a>                <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SMBSession-1007"><a href="#SMBSession-1007"><span class="linenos">1007</span></a>                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="SMBSession-1008"><a href="#SMBSession-1008"><span class="linenos">1008</span></a>                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SMBSession-1009"><a href="#SMBSession-1009"><span class="linenos">1009</span></a>                    <span class="c1"># This is the first entry </span>
</span><span id="SMBSession-1010"><a href="#SMBSession-1010"><span class="linenos">1010</span></a>                    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession-1011"><a href="#SMBSession-1011"><span class="linenos">1011</span></a>                        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession-1012"><a href="#SMBSession-1012"><span class="linenos">1012</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession-1013"><a href="#SMBSession-1013"><span class="linenos">1013</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1014"><a href="#SMBSession-1014"><span class="linenos">1014</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1015"><a href="#SMBSession-1015"><span class="linenos">1015</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1016"><a href="#SMBSession-1016"><span class="linenos">1016</span></a>                            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession-1017"><a href="#SMBSession-1017"><span class="linenos">1017</span></a>                                <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> 
</span><span id="SMBSession-1018"><a href="#SMBSession-1018"><span class="linenos">1018</span></a>                                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()],</span>
</span><span id="SMBSession-1019"><a href="#SMBSession-1019"><span class="linenos">1019</span></a>                                <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;│   &quot;</span><span class="p">]</span>
</span><span id="SMBSession-1020"><a href="#SMBSession-1020"><span class="linenos">1020</span></a>                            <span class="p">)</span>
</span><span id="SMBSession-1021"><a href="#SMBSession-1021"><span class="linenos">1021</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1022"><a href="#SMBSession-1022"><span class="linenos">1022</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession-1023"><a href="#SMBSession-1023"><span class="linenos">1023</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1024"><a href="#SMBSession-1024"><span class="linenos">1024</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1025"><a href="#SMBSession-1025"><span class="linenos">1025</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1026"><a href="#SMBSession-1026"><span class="linenos">1026</span></a>
</span><span id="SMBSession-1027"><a href="#SMBSession-1027"><span class="linenos">1027</span></a>                    <span class="c1"># This is the last entry</span>
</span><span id="SMBSession-1028"><a href="#SMBSession-1028"><span class="linenos">1028</span></a>                    <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
</span><span id="SMBSession-1029"><a href="#SMBSession-1029"><span class="linenos">1029</span></a>                        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession-1030"><a href="#SMBSession-1030"><span class="linenos">1030</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession-1031"><a href="#SMBSession-1031"><span class="linenos">1031</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1032"><a href="#SMBSession-1032"><span class="linenos">1032</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1033"><a href="#SMBSession-1033"><span class="linenos">1033</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1034"><a href="#SMBSession-1034"><span class="linenos">1034</span></a>                            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession-1035"><a href="#SMBSession-1035"><span class="linenos">1035</span></a>                                <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> 
</span><span id="SMBSession-1036"><a href="#SMBSession-1036"><span class="linenos">1036</span></a>                                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()],</span>
</span><span id="SMBSession-1037"><a href="#SMBSession-1037"><span class="linenos">1037</span></a>                                <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;    &quot;</span><span class="p">]</span>
</span><span id="SMBSession-1038"><a href="#SMBSession-1038"><span class="linenos">1038</span></a>                            <span class="p">)</span>
</span><span id="SMBSession-1039"><a href="#SMBSession-1039"><span class="linenos">1039</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1040"><a href="#SMBSession-1040"><span class="linenos">1040</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession-1041"><a href="#SMBSession-1041"><span class="linenos">1041</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1042"><a href="#SMBSession-1042"><span class="linenos">1042</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1043"><a href="#SMBSession-1043"><span class="linenos">1043</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1044"><a href="#SMBSession-1044"><span class="linenos">1044</span></a>                        
</span><span id="SMBSession-1045"><a href="#SMBSession-1045"><span class="linenos">1045</span></a>                    <span class="c1"># These are entries in the middle</span>
</span><span id="SMBSession-1046"><a href="#SMBSession-1046"><span class="linenos">1046</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1047"><a href="#SMBSession-1047"><span class="linenos">1047</span></a>                        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession-1048"><a href="#SMBSession-1048"><span class="linenos">1048</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession-1049"><a href="#SMBSession-1049"><span class="linenos">1049</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1050"><a href="#SMBSession-1050"><span class="linenos">1050</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1051"><a href="#SMBSession-1051"><span class="linenos">1051</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1052"><a href="#SMBSession-1052"><span class="linenos">1052</span></a>                            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession-1053"><a href="#SMBSession-1053"><span class="linenos">1053</span></a>                                <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> 
</span><span id="SMBSession-1054"><a href="#SMBSession-1054"><span class="linenos">1054</span></a>                                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()],</span>
</span><span id="SMBSession-1055"><a href="#SMBSession-1055"><span class="linenos">1055</span></a>                                <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;│   &quot;</span><span class="p">]</span>
</span><span id="SMBSession-1056"><a href="#SMBSession-1056"><span class="linenos">1056</span></a>                            <span class="p">)</span>
</span><span id="SMBSession-1057"><a href="#SMBSession-1057"><span class="linenos">1057</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1058"><a href="#SMBSession-1058"><span class="linenos">1058</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession-1059"><a href="#SMBSession-1059"><span class="linenos">1059</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1060"><a href="#SMBSession-1060"><span class="linenos">1060</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1061"><a href="#SMBSession-1061"><span class="linenos">1061</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1062"><a href="#SMBSession-1062"><span class="linenos">1062</span></a>
</span><span id="SMBSession-1063"><a href="#SMBSession-1063"><span class="linenos">1063</span></a>            <span class="c1"># </span>
</span><span id="SMBSession-1064"><a href="#SMBSession-1064"><span class="linenos">1064</span></a>            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SMBSession-1065"><a href="#SMBSession-1065"><span class="linenos">1065</span></a>                <span class="n">entry</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SMBSession-1066"><a href="#SMBSession-1066"><span class="linenos">1066</span></a>                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession-1067"><a href="#SMBSession-1067"><span class="linenos">1067</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession-1068"><a href="#SMBSession-1068"><span class="linenos">1068</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1069"><a href="#SMBSession-1069"><span class="linenos">1069</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1070"><a href="#SMBSession-1070"><span class="linenos">1070</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1071"><a href="#SMBSession-1071"><span class="linenos">1071</span></a>                    <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession-1072"><a href="#SMBSession-1072"><span class="linenos">1072</span></a>                        <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> 
</span><span id="SMBSession-1073"><a href="#SMBSession-1073"><span class="linenos">1073</span></a>                        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()],</span>
</span><span id="SMBSession-1074"><a href="#SMBSession-1074"><span class="linenos">1074</span></a>                        <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;    &quot;</span><span class="p">]</span>
</span><span id="SMBSession-1075"><a href="#SMBSession-1075"><span class="linenos">1075</span></a>                    <span class="p">)</span>
</span><span id="SMBSession-1076"><a href="#SMBSession-1076"><span class="linenos">1076</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1077"><a href="#SMBSession-1077"><span class="linenos">1077</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession-1078"><a href="#SMBSession-1078"><span class="linenos">1078</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1079"><a href="#SMBSession-1079"><span class="linenos">1079</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1080"><a href="#SMBSession-1080"><span class="linenos">1080</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession-1081"><a href="#SMBSession-1081"><span class="linenos">1081</span></a>
</span><span id="SMBSession-1082"><a href="#SMBSession-1082"><span class="linenos">1082</span></a>        <span class="c1"># Entrypoint</span>
</span><span id="SMBSession-1083"><a href="#SMBSession-1083"><span class="linenos">1083</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-1084"><a href="#SMBSession-1084"><span class="linenos">1084</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession-1085"><a href="#SMBSession-1085"><span class="linenos">1085</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession-1086"><a href="#SMBSession-1086"><span class="linenos">1086</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1087"><a href="#SMBSession-1087"><span class="linenos">1087</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession-1088"><a href="#SMBSession-1088"><span class="linenos">1088</span></a>            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession-1089"><a href="#SMBSession-1089"><span class="linenos">1089</span></a>                <span class="n">base_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="p">,</span> 
</span><span id="SMBSession-1090"><a href="#SMBSession-1090"><span class="linenos">1090</span></a>                <span class="n">path</span><span class="o">=</span><span class="p">[</span><span class="n">path</span><span class="p">],</span>
</span><span id="SMBSession-1091"><a href="#SMBSession-1091"><span class="linenos">1091</span></a>                <span class="n">prompt</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
</span><span id="SMBSession-1092"><a href="#SMBSession-1092"><span class="linenos">1092</span></a>            <span class="p">)</span>
</span><span id="SMBSession-1093"><a href="#SMBSession-1093"><span class="linenos">1093</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">BrokenPipeError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession-1094"><a href="#SMBSession-1094"><span class="linenos">1094</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Interrupted.&quot;</span><span class="p">)</span>
</span><span id="SMBSession-1095"><a href="#SMBSession-1095"><span class="linenos">1095</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">close_smb_session</span><span class="p">()</span>
</span><span id="SMBSession-1096"><a href="#SMBSession-1096"><span class="linenos">1096</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_smb_session</span><span class="p">()</span>
</span><span id="SMBSession-1097"><a href="#SMBSession-1097"><span class="linenos">1097</span></a>
</span><span id="SMBSession-1098"><a href="#SMBSession-1098"><span class="linenos">1098</span></a>    <span class="k">def</span> <span class="nf">umount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_mount_point</span><span class="p">):</span>
</span><span id="SMBSession-1099"><a href="#SMBSession-1099"><span class="linenos">1099</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-1100"><a href="#SMBSession-1100"><span class="linenos">1100</span></a><span class="sd">        Unmounts the specified local mount point of the remote share.</span>
</span><span id="SMBSession-1101"><a href="#SMBSession-1101"><span class="linenos">1101</span></a>
</span><span id="SMBSession-1102"><a href="#SMBSession-1102"><span class="linenos">1102</span></a><span class="sd">        This method unmounts the specified local mount point of the remote share based on the platform.</span>
</span><span id="SMBSession-1103"><a href="#SMBSession-1103"><span class="linenos">1103</span></a><span class="sd">        It supports Windows, Linux, and macOS platforms for unmounting.</span>
</span><span id="SMBSession-1104"><a href="#SMBSession-1104"><span class="linenos">1104</span></a>
</span><span id="SMBSession-1105"><a href="#SMBSession-1105"><span class="linenos">1105</span></a><span class="sd">        Parameters:</span>
</span><span id="SMBSession-1106"><a href="#SMBSession-1106"><span class="linenos">1106</span></a><span class="sd">            local_mount_point (str): The local mount point to unmount.</span>
</span><span id="SMBSession-1107"><a href="#SMBSession-1107"><span class="linenos">1107</span></a>
</span><span id="SMBSession-1108"><a href="#SMBSession-1108"><span class="linenos">1108</span></a><span class="sd">        Raises:</span>
</span><span id="SMBSession-1109"><a href="#SMBSession-1109"><span class="linenos">1109</span></a><span class="sd">            None</span>
</span><span id="SMBSession-1110"><a href="#SMBSession-1110"><span class="linenos">1110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-1111"><a href="#SMBSession-1111"><span class="linenos">1111</span></a>
</span><span id="SMBSession-1112"><a href="#SMBSession-1112"><span class="linenos">1112</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_mount_point</span><span class="p">):</span>
</span><span id="SMBSession-1113"><a href="#SMBSession-1113"><span class="linenos">1113</span></a>            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>
</span><span id="SMBSession-1114"><a href="#SMBSession-1114"><span class="linenos">1114</span></a>                <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;net use </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2"> /delete&quot;</span>
</span><span id="SMBSession-1115"><a href="#SMBSession-1115"><span class="linenos">1115</span></a>
</span><span id="SMBSession-1116"><a href="#SMBSession-1116"><span class="linenos">1116</span></a>            <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;darwin&#39;</span><span class="p">):</span>
</span><span id="SMBSession-1117"><a href="#SMBSession-1117"><span class="linenos">1117</span></a>                <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;umount </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SMBSession-1118"><a href="#SMBSession-1118"><span class="linenos">1118</span></a>
</span><span id="SMBSession-1119"><a href="#SMBSession-1119"><span class="linenos">1119</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1120"><a href="#SMBSession-1120"><span class="linenos">1120</span></a>                <span class="n">command</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SMBSession-1121"><a href="#SMBSession-1121"><span class="linenos">1121</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Unsupported platform for unmounting SMB share.&quot;</span><span class="p">)</span>
</span><span id="SMBSession-1122"><a href="#SMBSession-1122"><span class="linenos">1122</span></a>        
</span><span id="SMBSession-1123"><a href="#SMBSession-1123"><span class="linenos">1123</span></a>            <span class="k">if</span> <span class="n">command</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-1124"><a href="#SMBSession-1124"><span class="linenos">1124</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession-1125"><a href="#SMBSession-1125"><span class="linenos">1125</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] Executing: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">command</span><span class="p">)</span>
</span><span id="SMBSession-1126"><a href="#SMBSession-1126"><span class="linenos">1126</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="SMBSession-1127"><a href="#SMBSession-1127"><span class="linenos">1127</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1128"><a href="#SMBSession-1128"><span class="linenos">1128</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Cannot unmount a non existing path.&quot;</span><span class="p">)</span>        
</span><span id="SMBSession-1129"><a href="#SMBSession-1129"><span class="linenos">1129</span></a>
</span><span id="SMBSession-1130"><a href="#SMBSession-1130"><span class="linenos">1130</span></a>    <span class="c1"># Other functions</span>
</span><span id="SMBSession-1131"><a href="#SMBSession-1131"><span class="linenos">1131</span></a>
</span><span id="SMBSession-1132"><a href="#SMBSession-1132"><span class="linenos">1132</span></a>    <span class="k">def</span> <span class="nf">test_rights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sharename</span><span class="p">):</span> 
</span><span id="SMBSession-1133"><a href="#SMBSession-1133"><span class="linenos">1133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-1134"><a href="#SMBSession-1134"><span class="linenos">1134</span></a><span class="sd">        Tests the read and write access rights of the current SMB session.</span>
</span><span id="SMBSession-1135"><a href="#SMBSession-1135"><span class="linenos">1135</span></a>
</span><span id="SMBSession-1136"><a href="#SMBSession-1136"><span class="linenos">1136</span></a><span class="sd">        This method checks the read and write access rights of the current SMB session by attempting to list paths and create/delete temporary directories.</span>
</span><span id="SMBSession-1137"><a href="#SMBSession-1137"><span class="linenos">1137</span></a><span class="sd">        </span>
</span><span id="SMBSession-1138"><a href="#SMBSession-1138"><span class="linenos">1138</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession-1139"><a href="#SMBSession-1139"><span class="linenos">1139</span></a><span class="sd">            dict: A dictionary containing the read and write access rights status.</span>
</span><span id="SMBSession-1140"><a href="#SMBSession-1140"><span class="linenos">1140</span></a><span class="sd">                - &quot;readable&quot; (bool): Indicates if the session has read access rights.</span>
</span><span id="SMBSession-1141"><a href="#SMBSession-1141"><span class="linenos">1141</span></a><span class="sd">                - &quot;writable&quot; (bool): Indicates if the session has write access rights.</span>
</span><span id="SMBSession-1142"><a href="#SMBSession-1142"><span class="linenos">1142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-1143"><a href="#SMBSession-1143"><span class="linenos">1143</span></a>
</span><span id="SMBSession-1144"><a href="#SMBSession-1144"><span class="linenos">1144</span></a>        <span class="c1"># Restore the current share</span>
</span><span id="SMBSession-1145"><a href="#SMBSession-1145"><span class="linenos">1145</span></a>        <span class="n">current_share</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span>
</span><span id="SMBSession-1146"><a href="#SMBSession-1146"><span class="linenos">1146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_share</span><span class="p">(</span><span class="n">shareName</span><span class="o">=</span><span class="n">sharename</span><span class="p">)</span>
</span><span id="SMBSession-1147"><a href="#SMBSession-1147"><span class="linenos">1147</span></a>
</span><span id="SMBSession-1148"><a href="#SMBSession-1148"><span class="linenos">1148</span></a>        <span class="n">access_rights</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;readable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;writable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><span id="SMBSession-1149"><a href="#SMBSession-1149"><span class="linenos">1149</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-1150"><a href="#SMBSession-1150"><span class="linenos">1150</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="SMBSession-1151"><a href="#SMBSession-1151"><span class="linenos">1151</span></a>            <span class="n">access_rights</span><span class="p">[</span><span class="s2">&quot;readable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SMBSession-1152"><a href="#SMBSession-1152"><span class="linenos">1152</span></a>        <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession-1153"><a href="#SMBSession-1153"><span class="linenos">1153</span></a>            <span class="n">access_rights</span><span class="p">[</span><span class="s2">&quot;readable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession-1154"><a href="#SMBSession-1154"><span class="linenos">1154</span></a>
</span><span id="SMBSession-1155"><a href="#SMBSession-1155"><span class="linenos">1155</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession-1156"><a href="#SMBSession-1156"><span class="linenos">1156</span></a>            <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s2">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPRSTUVWXYZ0123456759&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)]))</span>
</span><span id="SMBSession-1157"><a href="#SMBSession-1157"><span class="linenos">1157</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">createDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="n">temp_dir</span><span class="p">)</span>
</span><span id="SMBSession-1158"><a href="#SMBSession-1158"><span class="linenos">1158</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">deleteDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="n">temp_dir</span><span class="p">)</span>
</span><span id="SMBSession-1159"><a href="#SMBSession-1159"><span class="linenos">1159</span></a>            <span class="n">access_rights</span><span class="p">[</span><span class="s2">&quot;writable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SMBSession-1160"><a href="#SMBSession-1160"><span class="linenos">1160</span></a>        <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession-1161"><a href="#SMBSession-1161"><span class="linenos">1161</span></a>            <span class="n">access_rights</span><span class="p">[</span><span class="s2">&quot;writable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession-1162"><a href="#SMBSession-1162"><span class="linenos">1162</span></a>
</span><span id="SMBSession-1163"><a href="#SMBSession-1163"><span class="linenos">1163</span></a>        <span class="c1"># Restore the current share</span>
</span><span id="SMBSession-1164"><a href="#SMBSession-1164"><span class="linenos">1164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_share</span><span class="p">(</span><span class="n">shareName</span><span class="o">=</span><span class="n">current_share</span><span class="p">)</span>
</span><span id="SMBSession-1165"><a href="#SMBSession-1165"><span class="linenos">1165</span></a>
</span><span id="SMBSession-1166"><a href="#SMBSession-1166"><span class="linenos">1166</span></a>        <span class="k">return</span> <span class="n">access_rights</span>
</span><span id="SMBSession-1167"><a href="#SMBSession-1167"><span class="linenos">1167</span></a>
</span><span id="SMBSession-1168"><a href="#SMBSession-1168"><span class="linenos">1168</span></a>    <span class="c1"># Setter / Getter</span>
</span><span id="SMBSession-1169"><a href="#SMBSession-1169"><span class="linenos">1169</span></a>
</span><span id="SMBSession-1170"><a href="#SMBSession-1170"><span class="linenos">1170</span></a>    <span class="k">def</span> <span class="nf">set_share</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shareName</span><span class="p">):</span>
</span><span id="SMBSession-1171"><a href="#SMBSession-1171"><span class="linenos">1171</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-1172"><a href="#SMBSession-1172"><span class="linenos">1172</span></a><span class="sd">        Sets the current SMB share to the specified share name.</span>
</span><span id="SMBSession-1173"><a href="#SMBSession-1173"><span class="linenos">1173</span></a>
</span><span id="SMBSession-1174"><a href="#SMBSession-1174"><span class="linenos">1174</span></a><span class="sd">        This method updates the SMB session to use the specified share name. It checks if the share name is valid</span>
</span><span id="SMBSession-1175"><a href="#SMBSession-1175"><span class="linenos">1175</span></a><span class="sd">        and updates the smb_share attribute of the SMBSession instance.</span>
</span><span id="SMBSession-1176"><a href="#SMBSession-1176"><span class="linenos">1176</span></a>
</span><span id="SMBSession-1177"><a href="#SMBSession-1177"><span class="linenos">1177</span></a><span class="sd">        Parameters:</span>
</span><span id="SMBSession-1178"><a href="#SMBSession-1178"><span class="linenos">1178</span></a><span class="sd">            shareName (str): The name of the share to set as the current SMB share.</span>
</span><span id="SMBSession-1179"><a href="#SMBSession-1179"><span class="linenos">1179</span></a>
</span><span id="SMBSession-1180"><a href="#SMBSession-1180"><span class="linenos">1180</span></a><span class="sd">        Raises:</span>
</span><span id="SMBSession-1181"><a href="#SMBSession-1181"><span class="linenos">1181</span></a><span class="sd">            ValueError: If the shareName is None or an empty string.</span>
</span><span id="SMBSession-1182"><a href="#SMBSession-1182"><span class="linenos">1182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-1183"><a href="#SMBSession-1183"><span class="linenos">1183</span></a>
</span><span id="SMBSession-1184"><a href="#SMBSession-1184"><span class="linenos">1184</span></a>        <span class="k">if</span> <span class="n">shareName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-1185"><a href="#SMBSession-1185"><span class="linenos">1185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">list_shares</span><span class="p">()</span>
</span><span id="SMBSession-1186"><a href="#SMBSession-1186"><span class="linenos">1186</span></a>            <span class="k">if</span> <span class="n">shareName</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="SMBSession-1187"><a href="#SMBSession-1187"><span class="linenos">1187</span></a>                <span class="c1"># Doing this in order to keep the case of the share adevertised by the remote machine</span>
</span><span id="SMBSession-1188"><a href="#SMBSession-1188"><span class="linenos">1188</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="p">[</span><span class="n">shareName</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="SMBSession-1189"><a href="#SMBSession-1189"><span class="linenos">1189</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="SMBSession-1190"><a href="#SMBSession-1190"><span class="linenos">1190</span></a>                <span class="c1"># Connects the tree</span>
</span><span id="SMBSession-1191"><a href="#SMBSession-1191"><span class="linenos">1191</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smb_tree_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">connectTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">)</span>
</span><span id="SMBSession-1192"><a href="#SMBSession-1192"><span class="linenos">1192</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1193"><a href="#SMBSession-1193"><span class="linenos">1193</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Could not set share &#39;</span><span class="si">%s</span><span class="s2">&#39;, it does not exist remotely.&quot;</span> <span class="o">%</span> <span class="n">shareName</span><span class="p">)</span>
</span><span id="SMBSession-1194"><a href="#SMBSession-1194"><span class="linenos">1194</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1195"><a href="#SMBSession-1195"><span class="linenos">1195</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SMBSession-1196"><a href="#SMBSession-1196"><span class="linenos">1196</span></a>            
</span><span id="SMBSession-1197"><a href="#SMBSession-1197"><span class="linenos">1197</span></a>    <span class="k">def</span> <span class="nf">set_cwd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession-1198"><a href="#SMBSession-1198"><span class="linenos">1198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession-1199"><a href="#SMBSession-1199"><span class="linenos">1199</span></a><span class="sd">        Sets the current working directory on the SMB share to the specified path.</span>
</span><span id="SMBSession-1200"><a href="#SMBSession-1200"><span class="linenos">1200</span></a>
</span><span id="SMBSession-1201"><a href="#SMBSession-1201"><span class="linenos">1201</span></a><span class="sd">        This method updates the current working directory (cwd) of the SMB session to the given path if it is a valid directory.</span>
</span><span id="SMBSession-1202"><a href="#SMBSession-1202"><span class="linenos">1202</span></a><span class="sd">        If the specified path is not a directory, the cwd remains unchanged.</span>
</span><span id="SMBSession-1203"><a href="#SMBSession-1203"><span class="linenos">1203</span></a>
</span><span id="SMBSession-1204"><a href="#SMBSession-1204"><span class="linenos">1204</span></a><span class="sd">        Parameters:</span>
</span><span id="SMBSession-1205"><a href="#SMBSession-1205"><span class="linenos">1205</span></a><span class="sd">            path (str): The path to set as the current working directory.</span>
</span><span id="SMBSession-1206"><a href="#SMBSession-1206"><span class="linenos">1206</span></a>
</span><span id="SMBSession-1207"><a href="#SMBSession-1207"><span class="linenos">1207</span></a><span class="sd">        Raises:</span>
</span><span id="SMBSession-1208"><a href="#SMBSession-1208"><span class="linenos">1208</span></a><span class="sd">            ValueError: If the specified path is not a directory.</span>
</span><span id="SMBSession-1209"><a href="#SMBSession-1209"><span class="linenos">1209</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession-1210"><a href="#SMBSession-1210"><span class="linenos">1210</span></a>
</span><span id="SMBSession-1211"><a href="#SMBSession-1211"><span class="linenos">1211</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession-1212"><a href="#SMBSession-1212"><span class="linenos">1212</span></a>            <span class="c1"># Set path separators to ntpath sep </span>
</span><span id="SMBSession-1213"><a href="#SMBSession-1213"><span class="linenos">1213</span></a>            <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="SMBSession-1214"><a href="#SMBSession-1214"><span class="linenos">1214</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession-1215"><a href="#SMBSession-1215"><span class="linenos">1215</span></a>
</span><span id="SMBSession-1216"><a href="#SMBSession-1216"><span class="linenos">1216</span></a>            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">):</span>
</span><span id="SMBSession-1217"><a href="#SMBSession-1217"><span class="linenos">1217</span></a>                <span class="c1"># Absolute path</span>
</span><span id="SMBSession-1218"><a href="#SMBSession-1218"><span class="linenos">1218</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span>
</span><span id="SMBSession-1219"><a href="#SMBSession-1219"><span class="linenos">1219</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1220"><a href="#SMBSession-1220"><span class="linenos">1220</span></a>                <span class="c1"># Relative path to the CWD</span>
</span><span id="SMBSession-1221"><a href="#SMBSession-1221"><span class="linenos">1221</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession-1222"><a href="#SMBSession-1222"><span class="linenos">1222</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span>
</span><span id="SMBSession-1223"><a href="#SMBSession-1223"><span class="linenos">1223</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1224"><a href="#SMBSession-1224"><span class="linenos">1224</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span>
</span><span id="SMBSession-1225"><a href="#SMBSession-1225"><span class="linenos">1225</span></a>            
</span><span id="SMBSession-1226"><a href="#SMBSession-1226"><span class="linenos">1226</span></a>            <span class="c1"># Path normalization</span>
</span><span id="SMBSession-1227"><a href="#SMBSession-1227"><span class="linenos">1227</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession-1228"><a href="#SMBSession-1228"><span class="linenos">1228</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession-1229"><a href="#SMBSession-1229"><span class="linenos">1229</span></a>
</span><span id="SMBSession-1230"><a href="#SMBSession-1230"><span class="linenos">1230</span></a>            <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">]:</span>
</span><span id="SMBSession-1231"><a href="#SMBSession-1231"><span class="linenos">1231</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="SMBSession-1232"><a href="#SMBSession-1232"><span class="linenos">1232</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1233"><a href="#SMBSession-1233"><span class="linenos">1233</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_isdir</span><span class="p">(</span><span class="n">pathFromRoot</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)):</span>
</span><span id="SMBSession-1234"><a href="#SMBSession-1234"><span class="linenos">1234</span></a>                    <span class="c1"># Path exists on the remote </span>
</span><span id="SMBSession-1235"><a href="#SMBSession-1235"><span class="linenos">1235</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession-1236"><a href="#SMBSession-1236"><span class="linenos">1236</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession-1237"><a href="#SMBSession-1237"><span class="linenos">1237</span></a>                    <span class="c1"># Path does not exists or is not a directory on the remote </span>
</span><span id="SMBSession-1238"><a href="#SMBSession-1238"><span class="linenos">1238</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Remote directory &#39;</span><span class="si">%s</span><span class="s2">&#39; does not exist.&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Class SMBSession is designed to handle the session management for SMB (Server Message Block) protocol connections.
It provides functionalities to connect to an SMB server, authenticate using either NTLM or Kerberos, and manage SMB shares.</p>

<p>Attributes:
    address (str): The IP address or hostname of the SMB server.
    domain (str): The domain name for SMB server authentication.
    username (str): The username for SMB server authentication.
    password (str): The password for SMB server authentication.
    lmhash (str): The LM hash of the user's password, if available.
    nthash (str): The NT hash of the user's password, if available.
    use_kerberos (bool): A flag to determine whether to use Kerberos for authentication.
    kdcHost (str): The Key Distribution Center (KDC) host for Kerberos authentication.
    debug (bool): A flag to enable debug output.
    smbClient (object): The SMB client object used for the connection.
    connected (bool): A flag to check the status of the connection.
    smb_share (str): The current SMB share in use.
    smb_path (str): The current path within the SMB share.</p>

<p>Methods:
    __init__(address, domain, username, password, lmhash, nthash, use_kerberos=False, kdcHost=None, debug=False):
        Initializes the SMBSession with the specified parameters.
    init_smb_session():
        Initializes the SMB session by connecting to the server and authenticating using the specified method.</p>
</div>


                            <div id="SMBSession.__init__" class="classattr">
                                        <input id="SMBSession.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SMBSession</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">address</span>,</span><span class="param">	<span class="n">domain</span>,</span><span class="param">	<span class="n">username</span>,</span><span class="param">	<span class="n">password</span>,</span><span class="param">	<span class="n">lmhash</span>,</span><span class="param">	<span class="n">nthash</span>,</span><span class="param">	<span class="n">use_kerberos</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">kdcHost</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">config</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="SMBSession.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.__init__-48"><a href="#SMBSession.__init__-48"><span class="linenos">48</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">lmhash</span><span class="p">,</span> <span class="n">nthash</span><span class="p">,</span> <span class="n">use_kerberos</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kdcHost</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.__init__-49"><a href="#SMBSession.__init__-49"><span class="linenos">49</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">SMBSession</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="SMBSession.__init__-50"><a href="#SMBSession.__init__-50"><span class="linenos">50</span></a>        <span class="c1"># Objects</span>
</span><span id="SMBSession.__init__-51"><a href="#SMBSession.__init__-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span><span id="SMBSession.__init__-52"><a href="#SMBSession.__init__-52"><span class="linenos">52</span></a>
</span><span id="SMBSession.__init__-53"><a href="#SMBSession.__init__-53"><span class="linenos">53</span></a>        <span class="c1"># Target server</span>
</span><span id="SMBSession.__init__-54"><a href="#SMBSession.__init__-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
</span><span id="SMBSession.__init__-55"><a href="#SMBSession.__init__-55"><span class="linenos">55</span></a>
</span><span id="SMBSession.__init__-56"><a href="#SMBSession.__init__-56"><span class="linenos">56</span></a>        <span class="c1"># Credentials</span>
</span><span id="SMBSession.__init__-57"><a href="#SMBSession.__init__-57"><span class="linenos">57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
</span><span id="SMBSession.__init__-58"><a href="#SMBSession.__init__-58"><span class="linenos">58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
</span><span id="SMBSession.__init__-59"><a href="#SMBSession.__init__-59"><span class="linenos">59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span> 
</span><span id="SMBSession.__init__-60"><a href="#SMBSession.__init__-60"><span class="linenos">60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lmhash</span> <span class="o">=</span> <span class="n">lmhash</span>
</span><span id="SMBSession.__init__-61"><a href="#SMBSession.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nthash</span> <span class="o">=</span> <span class="n">nthash</span>
</span><span id="SMBSession.__init__-62"><a href="#SMBSession.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_kerberos</span> <span class="o">=</span> <span class="n">use_kerberos</span>
</span><span id="SMBSession.__init__-63"><a href="#SMBSession.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kdcHost</span> <span class="o">=</span> <span class="n">kdcHost</span>
</span><span id="SMBSession.__init__-64"><a href="#SMBSession.__init__-64"><span class="linenos">64</span></a>
</span><span id="SMBSession.__init__-65"><a href="#SMBSession.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SMBSession.__init__-66"><a href="#SMBSession.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession.__init__-67"><a href="#SMBSession.__init__-67"><span class="linenos">67</span></a>
</span><span id="SMBSession.__init__-68"><a href="#SMBSession.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SMBSession.__init__-69"><a href="#SMBSession.__init__-69"><span class="linenos">69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SMBSession.__init__-70"><a href="#SMBSession.__init__-70"><span class="linenos">70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="SMBSession.__init__-71"><a href="#SMBSession.__init__-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">smb_tree_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SMBSession.__init__-72"><a href="#SMBSession.__init__-72"><span class="linenos">72</span></a>
</span><span id="SMBSession.__init__-73"><a href="#SMBSession.__init__-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">list_shares</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="SMBSession.config" class="classattr">
                                <div class="attr variable">
            <span class="name">config</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.config"></a>
    
    

                            </div>
                            <div id="SMBSession.address" class="classattr">
                                <div class="attr variable">
            <span class="name">address</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.address"></a>
    
    

                            </div>
                            <div id="SMBSession.domain" class="classattr">
                                <div class="attr variable">
            <span class="name">domain</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.domain"></a>
    
    

                            </div>
                            <div id="SMBSession.username" class="classattr">
                                <div class="attr variable">
            <span class="name">username</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.username"></a>
    
    

                            </div>
                            <div id="SMBSession.password" class="classattr">
                                <div class="attr variable">
            <span class="name">password</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.password"></a>
    
    

                            </div>
                            <div id="SMBSession.lmhash" class="classattr">
                                <div class="attr variable">
            <span class="name">lmhash</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.lmhash"></a>
    
    

                            </div>
                            <div id="SMBSession.nthash" class="classattr">
                                <div class="attr variable">
            <span class="name">nthash</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.nthash"></a>
    
    

                            </div>
                            <div id="SMBSession.use_kerberos" class="classattr">
                                <div class="attr variable">
            <span class="name">use_kerberos</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.use_kerberos"></a>
    
    

                            </div>
                            <div id="SMBSession.kdcHost" class="classattr">
                                <div class="attr variable">
            <span class="name">kdcHost</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.kdcHost"></a>
    
    

                            </div>
                            <div id="SMBSession.smbClient" class="classattr">
                                <div class="attr variable">
            <span class="name">smbClient</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.smbClient"></a>
    
    

                            </div>
                            <div id="SMBSession.connected" class="classattr">
                                <div class="attr variable">
            <span class="name">connected</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.connected"></a>
    
    

                            </div>
                            <div id="SMBSession.available_shares" class="classattr">
                                <div class="attr variable">
            <span class="name">available_shares</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.available_shares"></a>
    
    

                            </div>
                            <div id="SMBSession.smb_share" class="classattr">
                                <div class="attr variable">
            <span class="name">smb_share</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.smb_share"></a>
    
    

                            </div>
                            <div id="SMBSession.smb_cwd" class="classattr">
                                <div class="attr variable">
            <span class="name">smb_cwd</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.smb_cwd"></a>
    
    

                            </div>
                            <div id="SMBSession.smb_tree_id" class="classattr">
                                <div class="attr variable">
            <span class="name">smb_tree_id</span>

        
    </div>
    <a class="headerlink" href="#SMBSession.smb_tree_id"></a>
    
    

                            </div>
                            <div id="SMBSession.init_smb_session" class="classattr">
                                        <input id="SMBSession.init_smb_session-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">init_smb_session</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.init_smb_session-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.init_smb_session"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.init_smb_session-77"><a href="#SMBSession.init_smb_session-77"><span class="linenos"> 77</span></a>    <span class="k">def</span> <span class="nf">init_smb_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SMBSession.init_smb_session-78"><a href="#SMBSession.init_smb_session-78"><span class="linenos"> 78</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.init_smb_session-79"><a href="#SMBSession.init_smb_session-79"><span class="linenos"> 79</span></a><span class="sd">        Initializes and establishes a session with the SMB server.</span>
</span><span id="SMBSession.init_smb_session-80"><a href="#SMBSession.init_smb_session-80"><span class="linenos"> 80</span></a>
</span><span id="SMBSession.init_smb_session-81"><a href="#SMBSession.init_smb_session-81"><span class="linenos"> 81</span></a><span class="sd">        This method sets up the SMB connection using either Kerberos or NTLM authentication based on the configuration.</span>
</span><span id="SMBSession.init_smb_session-82"><a href="#SMBSession.init_smb_session-82"><span class="linenos"> 82</span></a><span class="sd">        It attempts to connect to the SMB server specified by the `address` attribute and authenticate using the credentials provided during the object&#39;s initialization.</span>
</span><span id="SMBSession.init_smb_session-83"><a href="#SMBSession.init_smb_session-83"><span class="linenos"> 83</span></a>
</span><span id="SMBSession.init_smb_session-84"><a href="#SMBSession.init_smb_session-84"><span class="linenos"> 84</span></a><span class="sd">        The method will print debug information if the `debug` attribute is set to True. Upon successful connection and authentication, it sets the `connected` attribute to True.</span>
</span><span id="SMBSession.init_smb_session-85"><a href="#SMBSession.init_smb_session-85"><span class="linenos"> 85</span></a>
</span><span id="SMBSession.init_smb_session-86"><a href="#SMBSession.init_smb_session-86"><span class="linenos"> 86</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession.init_smb_session-87"><a href="#SMBSession.init_smb_session-87"><span class="linenos"> 87</span></a><span class="sd">            bool: True if the connection and authentication are successful, False otherwise.</span>
</span><span id="SMBSession.init_smb_session-88"><a href="#SMBSession.init_smb_session-88"><span class="linenos"> 88</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.init_smb_session-89"><a href="#SMBSession.init_smb_session-89"><span class="linenos"> 89</span></a>
</span><span id="SMBSession.init_smb_session-90"><a href="#SMBSession.init_smb_session-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession.init_smb_session-91"><a href="#SMBSession.init_smb_session-91"><span class="linenos"> 91</span></a>
</span><span id="SMBSession.init_smb_session-92"><a href="#SMBSession.init_smb_session-92"><span class="linenos"> 92</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-93"><a href="#SMBSession.init_smb_session-93"><span class="linenos"> 93</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] [&gt;] Connecting to remote SMB server &#39;</span><span class="si">%s</span><span class="s2">&#39; ... &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
</span><span id="SMBSession.init_smb_session-94"><a href="#SMBSession.init_smb_session-94"><span class="linenos"> 94</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-95"><a href="#SMBSession.init_smb_session-95"><span class="linenos"> 95</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="o">=</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SMBConnection</span><span class="p">(</span>
</span><span id="SMBSession.init_smb_session-96"><a href="#SMBSession.init_smb_session-96"><span class="linenos"> 96</span></a>                <span class="n">remoteName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
</span><span id="SMBSession.init_smb_session-97"><a href="#SMBSession.init_smb_session-97"><span class="linenos"> 97</span></a>                <span class="n">remoteHost</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
</span><span id="SMBSession.init_smb_session-98"><a href="#SMBSession.init_smb_session-98"><span class="linenos"> 98</span></a>                <span class="n">sess_port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">445</span><span class="p">)</span>
</span><span id="SMBSession.init_smb_session-99"><a href="#SMBSession.init_smb_session-99"><span class="linenos"> 99</span></a>            <span class="p">)</span>
</span><span id="SMBSession.init_smb_session-100"><a href="#SMBSession.init_smb_session-100"><span class="linenos">100</span></a>        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-101"><a href="#SMBSession.init_smb_session-101"><span class="linenos">101</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
</span><span id="SMBSession.init_smb_session-102"><a href="#SMBSession.init_smb_session-102"><span class="linenos">102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SMBSession.init_smb_session-103"><a href="#SMBSession.init_smb_session-103"><span class="linenos">103</span></a>
</span><span id="SMBSession.init_smb_session-104"><a href="#SMBSession.init_smb_session-104"><span class="linenos">104</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-105"><a href="#SMBSession.init_smb_session-105"><span class="linenos">105</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_kerberos</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-106"><a href="#SMBSession.init_smb_session-106"><span class="linenos">106</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-107"><a href="#SMBSession.init_smb_session-107"><span class="linenos">107</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] [&gt;] Authenticating as &#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s2">&#39; with kerberos ... &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</span><span id="SMBSession.init_smb_session-108"><a href="#SMBSession.init_smb_session-108"><span class="linenos">108</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-109"><a href="#SMBSession.init_smb_session-109"><span class="linenos">109</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">kerberosLogin</span><span class="p">(</span>
</span><span id="SMBSession.init_smb_session-110"><a href="#SMBSession.init_smb_session-110"><span class="linenos">110</span></a>                        <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
</span><span id="SMBSession.init_smb_session-111"><a href="#SMBSession.init_smb_session-111"><span class="linenos">111</span></a>                        <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="SMBSession.init_smb_session-112"><a href="#SMBSession.init_smb_session-112"><span class="linenos">112</span></a>                        <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span>
</span><span id="SMBSession.init_smb_session-113"><a href="#SMBSession.init_smb_session-113"><span class="linenos">113</span></a>                        <span class="n">lmhash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmhash</span><span class="p">,</span>
</span><span id="SMBSession.init_smb_session-114"><a href="#SMBSession.init_smb_session-114"><span class="linenos">114</span></a>                        <span class="n">nthash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nthash</span><span class="p">,</span>
</span><span id="SMBSession.init_smb_session-115"><a href="#SMBSession.init_smb_session-115"><span class="linenos">115</span></a>                        <span class="n">aesKey</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aesKey</span><span class="p">,</span>
</span><span id="SMBSession.init_smb_session-116"><a href="#SMBSession.init_smb_session-116"><span class="linenos">116</span></a>                        <span class="n">kdcHost</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kdcHost</span>
</span><span id="SMBSession.init_smb_session-117"><a href="#SMBSession.init_smb_session-117"><span class="linenos">117</span></a>                    <span class="p">)</span>
</span><span id="SMBSession.init_smb_session-118"><a href="#SMBSession.init_smb_session-118"><span class="linenos">118</span></a>                <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-119"><a href="#SMBSession.init_smb_session-119"><span class="linenos">119</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-120"><a href="#SMBSession.init_smb_session-120"><span class="linenos">120</span></a>                        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="SMBSession.init_smb_session-121"><a href="#SMBSession.init_smb_session-121"><span class="linenos">121</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Could not login: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
</span><span id="SMBSession.init_smb_session-122"><a href="#SMBSession.init_smb_session-122"><span class="linenos">122</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession.init_smb_session-123"><a href="#SMBSession.init_smb_session-123"><span class="linenos">123</span></a>
</span><span id="SMBSession.init_smb_session-124"><a href="#SMBSession.init_smb_session-124"><span class="linenos">124</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-125"><a href="#SMBSession.init_smb_session-125"><span class="linenos">125</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-126"><a href="#SMBSession.init_smb_session-126"><span class="linenos">126</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] [&gt;] Authenticating as &#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s2">&#39; with NTLM ... &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</span><span id="SMBSession.init_smb_session-127"><a href="#SMBSession.init_smb_session-127"><span class="linenos">127</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-128"><a href="#SMBSession.init_smb_session-128"><span class="linenos">128</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">login</span><span class="p">(</span>
</span><span id="SMBSession.init_smb_session-129"><a href="#SMBSession.init_smb_session-129"><span class="linenos">129</span></a>                        <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
</span><span id="SMBSession.init_smb_session-130"><a href="#SMBSession.init_smb_session-130"><span class="linenos">130</span></a>                        <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="SMBSession.init_smb_session-131"><a href="#SMBSession.init_smb_session-131"><span class="linenos">131</span></a>                        <span class="n">domain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span>
</span><span id="SMBSession.init_smb_session-132"><a href="#SMBSession.init_smb_session-132"><span class="linenos">132</span></a>                        <span class="n">lmhash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmhash</span><span class="p">,</span>
</span><span id="SMBSession.init_smb_session-133"><a href="#SMBSession.init_smb_session-133"><span class="linenos">133</span></a>                        <span class="n">nthash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nthash</span>
</span><span id="SMBSession.init_smb_session-134"><a href="#SMBSession.init_smb_session-134"><span class="linenos">134</span></a>                    <span class="p">)</span>
</span><span id="SMBSession.init_smb_session-135"><a href="#SMBSession.init_smb_session-135"><span class="linenos">135</span></a>                <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-136"><a href="#SMBSession.init_smb_session-136"><span class="linenos">136</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-137"><a href="#SMBSession.init_smb_session-137"><span class="linenos">137</span></a>                        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="SMBSession.init_smb_session-138"><a href="#SMBSession.init_smb_session-138"><span class="linenos">138</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Could not login: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
</span><span id="SMBSession.init_smb_session-139"><a href="#SMBSession.init_smb_session-139"><span class="linenos">139</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession.init_smb_session-140"><a href="#SMBSession.init_smb_session-140"><span class="linenos">140</span></a>
</span><span id="SMBSession.init_smb_session-141"><a href="#SMBSession.init_smb_session-141"><span class="linenos">141</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-142"><a href="#SMBSession.init_smb_session-142"><span class="linenos">142</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Successfully authenticated to &#39;</span><span class="si">%s</span><span class="s2">&#39; as &#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s2">&#39;!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</span><span id="SMBSession.init_smb_session-143"><a href="#SMBSession.init_smb_session-143"><span class="linenos">143</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.init_smb_session-144"><a href="#SMBSession.init_smb_session-144"><span class="linenos">144</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to authenticate to &#39;</span><span class="si">%s</span><span class="s2">&#39; as &#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s2">&#39;!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</span><span id="SMBSession.init_smb_session-145"><a href="#SMBSession.init_smb_session-145"><span class="linenos">145</span></a>
</span><span id="SMBSession.init_smb_session-146"><a href="#SMBSession.init_smb_session-146"><span class="linenos">146</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span>
</span></pre></div>


            <div class="docstring"><p>Initializes and establishes a session with the SMB server.</p>

<p>This method sets up the SMB connection using either Kerberos or NTLM authentication based on the configuration.
It attempts to connect to the SMB server specified by the <code><a href="#SMBSession.address">address</a></code> attribute and authenticate using the credentials provided during the object's initialization.</p>

<p>The method will print debug information if the <code>debug</code> attribute is set to True. Upon successful connection and authentication, it sets the <code><a href="#SMBSession.connected">connected</a></code> attribute to True.</p>

<p>Returns:
    bool: True if the connection and authentication are successful, False otherwise.</p>
</div>


                            </div>
                            <div id="SMBSession.close_smb_session" class="classattr">
                                        <input id="SMBSession.close_smb_session-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">close_smb_session</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.close_smb_session-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.close_smb_session"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.close_smb_session-148"><a href="#SMBSession.close_smb_session-148"><span class="linenos">148</span></a>    <span class="k">def</span> <span class="nf">close_smb_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SMBSession.close_smb_session-149"><a href="#SMBSession.close_smb_session-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.close_smb_session-150"><a href="#SMBSession.close_smb_session-150"><span class="linenos">150</span></a><span class="sd">        Closes the current SMB session by disconnecting the SMB client.</span>
</span><span id="SMBSession.close_smb_session-151"><a href="#SMBSession.close_smb_session-151"><span class="linenos">151</span></a>
</span><span id="SMBSession.close_smb_session-152"><a href="#SMBSession.close_smb_session-152"><span class="linenos">152</span></a><span class="sd">        This method ensures that the SMB client connection is properly closed. It checks if the client is connected</span>
</span><span id="SMBSession.close_smb_session-153"><a href="#SMBSession.close_smb_session-153"><span class="linenos">153</span></a><span class="sd">        and if so, it closes the connection and resets the connection status.</span>
</span><span id="SMBSession.close_smb_session-154"><a href="#SMBSession.close_smb_session-154"><span class="linenos">154</span></a>
</span><span id="SMBSession.close_smb_session-155"><a href="#SMBSession.close_smb_session-155"><span class="linenos">155</span></a><span class="sd">        Raises:</span>
</span><span id="SMBSession.close_smb_session-156"><a href="#SMBSession.close_smb_session-156"><span class="linenos">156</span></a><span class="sd">            Exception: If the SMB client is not initialized or if there&#39;s an error during the disconnection process.</span>
</span><span id="SMBSession.close_smb_session-157"><a href="#SMBSession.close_smb_session-157"><span class="linenos">157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.close_smb_session-158"><a href="#SMBSession.close_smb_session-158"><span class="linenos">158</span></a>
</span><span id="SMBSession.close_smb_session-159"><a href="#SMBSession.close_smb_session-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.close_smb_session-160"><a href="#SMBSession.close_smb_session-160"><span class="linenos">160</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="SMBSession.close_smb_session-161"><a href="#SMBSession.close_smb_session-161"><span class="linenos">161</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession.close_smb_session-162"><a href="#SMBSession.close_smb_session-162"><span class="linenos">162</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession.close_smb_session-163"><a href="#SMBSession.close_smb_session-163"><span class="linenos">163</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.close_smb_session-164"><a href="#SMBSession.close_smb_session-164"><span class="linenos">164</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] SMB connection closed successfully.&quot;</span><span class="p">)</span>
</span><span id="SMBSession.close_smb_session-165"><a href="#SMBSession.close_smb_session-165"><span class="linenos">165</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.close_smb_session-166"><a href="#SMBSession.close_smb_session-166"><span class="linenos">166</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.close_smb_session-167"><a href="#SMBSession.close_smb_session-167"><span class="linenos">167</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] No active SMB connection to close.&quot;</span><span class="p">)</span>
</span><span id="SMBSession.close_smb_session-168"><a href="#SMBSession.close_smb_session-168"><span class="linenos">168</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.close_smb_session-169"><a href="#SMBSession.close_smb_session-169"><span class="linenos">169</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;SMB client is not initialized.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Closes the current SMB session by disconnecting the SMB client.</p>

<p>This method ensures that the SMB client connection is properly closed. It checks if the client is connected
and if so, it closes the connection and resets the connection status.</p>

<p>Raises:
    Exception: If the SMB client is not initialized or if there's an error during the disconnection process.</p>
</div>


                            </div>
                            <div id="SMBSession.read_file" class="classattr">
                                        <input id="SMBSession.read_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.read_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.read_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.read_file-173"><a href="#SMBSession.read_file-173"><span class="linenos">173</span></a>    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.read_file-174"><a href="#SMBSession.read_file-174"><span class="linenos">174</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_isfile</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">):</span>
</span><span id="SMBSession.read_file-175"><a href="#SMBSession.read_file-175"><span class="linenos">175</span></a>            <span class="n">tmp_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span>
</span><span id="SMBSession.read_file-176"><a href="#SMBSession.read_file-176"><span class="linenos">176</span></a>            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession.read_file-177"><a href="#SMBSession.read_file-177"><span class="linenos">177</span></a>                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.read_file-178"><a href="#SMBSession.read_file-178"><span class="linenos">178</span></a>                <span class="n">path</span><span class="o">=</span><span class="n">tmp_file_path</span>
</span><span id="SMBSession.read_file-179"><a href="#SMBSession.read_file-179"><span class="linenos">179</span></a>            <span class="p">)</span>
</span><span id="SMBSession.read_file-180"><a href="#SMBSession.read_file-180"><span class="linenos">180</span></a>
</span><span id="SMBSession.read_file-181"><a href="#SMBSession.read_file-181"><span class="linenos">181</span></a>            <span class="n">fh</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
</span><span id="SMBSession.read_file-182"><a href="#SMBSession.read_file-182"><span class="linenos">182</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.read_file-183"><a href="#SMBSession.read_file-183"><span class="linenos">183</span></a>                <span class="c1"># opening the files in streams instead of mounting shares allows </span>
</span><span id="SMBSession.read_file-184"><a href="#SMBSession.read_file-184"><span class="linenos">184</span></a>                <span class="c1"># for running the script from unprivileged containers</span>
</span><span id="SMBSession.read_file-185"><a href="#SMBSession.read_file-185"><span class="linenos">185</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="n">tmp_file_path</span><span class="p">,</span> <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
</span><span id="SMBSession.read_file-186"><a href="#SMBSession.read_file-186"><span class="linenos">186</span></a>            <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession.read_file-187"><a href="#SMBSession.read_file-187"><span class="linenos">187</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="SMBSession.read_file-188"><a href="#SMBSession.read_file-188"><span class="linenos">188</span></a>            <span class="n">rawdata</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span><span id="SMBSession.read_file-189"><a href="#SMBSession.read_file-189"><span class="linenos">189</span></a>            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession.read_file-190"><a href="#SMBSession.read_file-190"><span class="linenos">190</span></a>            <span class="k">return</span> <span class="n">rawdata</span>
</span><span id="SMBSession.read_file-191"><a href="#SMBSession.read_file-191"><span class="linenos">191</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.read_file-192"><a href="#SMBSession.read_file-192"><span class="linenos">192</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Remote path &#39;</span><span class="si">%s</span><span class="s2">&#39; is not a file.&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SMBSession.find" class="classattr">
                                        <input id="SMBSession.find-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">paths</span><span class="o">=</span><span class="p">[]</span>, </span><span class="param"><span class="n">callback</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.find-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.find"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.find-194"><a href="#SMBSession.find-194"><span class="linenos">194</span></a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="p">[],</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.find-195"><a href="#SMBSession.find-195"><span class="linenos">195</span></a>        <span class="k">def</span> <span class="nf">recurse_action</span><span class="p">(</span><span class="n">paths</span><span class="o">=</span><span class="p">[],</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.find-196"><a href="#SMBSession.find-196"><span class="linenos">196</span></a>            <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.find-197"><a href="#SMBSession.find-197"><span class="linenos">197</span></a>                <span class="k">return</span> <span class="p">[]</span>
</span><span id="SMBSession.find-198"><a href="#SMBSession.find-198"><span class="linenos">198</span></a>            
</span><span id="SMBSession.find-199"><a href="#SMBSession.find-199"><span class="linenos">199</span></a>            <span class="n">next_directories_to_explore</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SMBSession.find-200"><a href="#SMBSession.find-200"><span class="linenos">200</span></a>
</span><span id="SMBSession.find-201"><a href="#SMBSession.find-201"><span class="linenos">201</span></a>            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
</span><span id="SMBSession.find-202"><a href="#SMBSession.find-202"><span class="linenos">202</span></a>                <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession.find-203"><a href="#SMBSession.find-203"><span class="linenos">203</span></a>                <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SMBSession.find-204"><a href="#SMBSession.find-204"><span class="linenos">204</span></a>                
</span><span id="SMBSession.find-205"><a href="#SMBSession.find-205"><span class="linenos">205</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.find-206"><a href="#SMBSession.find-206"><span class="linenos">206</span></a>                    <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession.find-207"><a href="#SMBSession.find-207"><span class="linenos">207</span></a>                        <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.find-208"><a href="#SMBSession.find-208"><span class="linenos">208</span></a>                        <span class="n">path</span><span class="o">=</span><span class="p">(</span><span class="n">remote_smb_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="SMBSession.find-209"><a href="#SMBSession.find-209"><span class="linenos">209</span></a>                    <span class="p">)</span>
</span><span id="SMBSession.find-210"><a href="#SMBSession.find-210"><span class="linenos">210</span></a>                <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.find-211"><a href="#SMBSession.find-211"><span class="linenos">211</span></a>                    <span class="k">continue</span> 
</span><span id="SMBSession.find-212"><a href="#SMBSession.find-212"><span class="linenos">212</span></a>                <span class="c1"># Remove dot names</span>
</span><span id="SMBSession.find-213"><a href="#SMBSession.find-213"><span class="linenos">213</span></a>                <span class="n">entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">]]</span>
</span><span id="SMBSession.find-214"><a href="#SMBSession.find-214"><span class="linenos">214</span></a>                <span class="c1"># Sort the entries ignoring case</span>
</span><span id="SMBSession.find-215"><a href="#SMBSession.find-215"><span class="linenos">215</span></a>                <span class="n">entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="SMBSession.find-216"><a href="#SMBSession.find-216"><span class="linenos">216</span></a>                
</span><span id="SMBSession.find-217"><a href="#SMBSession.find-217"><span class="linenos">217</span></a>                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="SMBSession.find-218"><a href="#SMBSession.find-218"><span class="linenos">218</span></a>                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession.find-219"><a href="#SMBSession.find-219"><span class="linenos">219</span></a>                        <span class="n">callback</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>
</span><span id="SMBSession.find-220"><a href="#SMBSession.find-220"><span class="linenos">220</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.find-221"><a href="#SMBSession.find-221"><span class="linenos">221</span></a>                        <span class="n">callback</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">(),</span> <span class="n">depth</span><span class="p">)</span>
</span><span id="SMBSession.find-222"><a href="#SMBSession.find-222"><span class="linenos">222</span></a>
</span><span id="SMBSession.find-223"><a href="#SMBSession.find-223"><span class="linenos">223</span></a>                <span class="c1"># Next directories to explore</span>
</span><span id="SMBSession.find-224"><a href="#SMBSession.find-224"><span class="linenos">224</span></a>                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="SMBSession.find-225"><a href="#SMBSession.find-225"><span class="linenos">225</span></a>                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession.find-226"><a href="#SMBSession.find-226"><span class="linenos">226</span></a>                        <span class="n">next_directories_to_explore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.find-227"><a href="#SMBSession.find-227"><span class="linenos">227</span></a>            
</span><span id="SMBSession.find-228"><a href="#SMBSession.find-228"><span class="linenos">228</span></a>            <span class="k">return</span> <span class="n">next_directories_to_explore</span>
</span><span id="SMBSession.find-229"><a href="#SMBSession.find-229"><span class="linenos">229</span></a>        <span class="c1"># </span>
</span><span id="SMBSession.find-230"><a href="#SMBSession.find-230"><span class="linenos">230</span></a>        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.find-231"><a href="#SMBSession.find-231"><span class="linenos">231</span></a>            <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SMBSession.find-232"><a href="#SMBSession.find-232"><span class="linenos">232</span></a>            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession.find-233"><a href="#SMBSession.find-233"><span class="linenos">233</span></a>                <span class="n">paths</span> <span class="o">=</span> <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession.find-234"><a href="#SMBSession.find-234"><span class="linenos">234</span></a>                    <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span>
</span><span id="SMBSession.find-235"><a href="#SMBSession.find-235"><span class="linenos">235</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="SMBSession.find-236"><a href="#SMBSession.find-236"><span class="linenos">236</span></a>                    <span class="n">callback</span><span class="o">=</span><span class="n">callback</span>
</span><span id="SMBSession.find-237"><a href="#SMBSession.find-237"><span class="linenos">237</span></a>                <span class="p">)</span>
</span><span id="SMBSession.find-238"><a href="#SMBSession.find-238"><span class="linenos">238</span></a>                <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="SMBSession.find-239"><a href="#SMBSession.find-239"><span class="linenos">239</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.find-240"><a href="#SMBSession.find-240"><span class="linenos">240</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] SMBSession.find(), callback function cannot be None.&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SMBSession.get_file" class="classattr">
                                        <input id="SMBSession.get_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">keepRemotePath</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.get_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.get_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.get_file-242"><a href="#SMBSession.get_file-242"><span class="linenos">242</span></a>    <span class="k">def</span> <span class="nf">get_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keepRemotePath</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SMBSession.get_file-243"><a href="#SMBSession.get_file-243"><span class="linenos">243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.get_file-244"><a href="#SMBSession.get_file-244"><span class="linenos">244</span></a><span class="sd">        Retrieves a file from the specified path on the SMB share.</span>
</span><span id="SMBSession.get_file-245"><a href="#SMBSession.get_file-245"><span class="linenos">245</span></a>
</span><span id="SMBSession.get_file-246"><a href="#SMBSession.get_file-246"><span class="linenos">246</span></a><span class="sd">        This method attempts to retrieve a file from the given path within the currently connected SMB share.</span>
</span><span id="SMBSession.get_file-247"><a href="#SMBSession.get_file-247"><span class="linenos">247</span></a><span class="sd">        If the path points to a directory, it skips the retrieval. It handles file retrieval by creating a local</span>
</span><span id="SMBSession.get_file-248"><a href="#SMBSession.get_file-248"><span class="linenos">248</span></a><span class="sd">        file object and writing the contents of the remote file to it using the SMB client&#39;s getFile method.</span>
</span><span id="SMBSession.get_file-249"><a href="#SMBSession.get_file-249"><span class="linenos">249</span></a>
</span><span id="SMBSession.get_file-250"><a href="#SMBSession.get_file-250"><span class="linenos">250</span></a><span class="sd">        Parameters:</span>
</span><span id="SMBSession.get_file-251"><a href="#SMBSession.get_file-251"><span class="linenos">251</span></a><span class="sd">            path (str): The path of the file to retrieve. If None, uses the current smb_path.</span>
</span><span id="SMBSession.get_file-252"><a href="#SMBSession.get_file-252"><span class="linenos">252</span></a>
</span><span id="SMBSession.get_file-253"><a href="#SMBSession.get_file-253"><span class="linenos">253</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession.get_file-254"><a href="#SMBSession.get_file-254"><span class="linenos">254</span></a><span class="sd">            None</span>
</span><span id="SMBSession.get_file-255"><a href="#SMBSession.get_file-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.get_file-256"><a href="#SMBSession.get_file-256"><span class="linenos">256</span></a>
</span><span id="SMBSession.get_file-257"><a href="#SMBSession.get_file-257"><span class="linenos">257</span></a>        <span class="c1"># Parse path</span>
</span><span id="SMBSession.get_file-258"><a href="#SMBSession.get_file-258"><span class="linenos">258</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.get_file-259"><a href="#SMBSession.get_file-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="SMBSession.get_file-260"><a href="#SMBSession.get_file-260"><span class="linenos">260</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="SMBSession.get_file-261"><a href="#SMBSession.get_file-261"><span class="linenos">261</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.get_file-262"><a href="#SMBSession.get_file-262"><span class="linenos">262</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.get_file-263"><a href="#SMBSession.get_file-263"><span class="linenos">263</span></a>        <span class="c1"># Parse filename</span>
</span><span id="SMBSession.get_file-264"><a href="#SMBSession.get_file-264"><span class="linenos">264</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession.get_file-265"><a href="#SMBSession.get_file-265"><span class="linenos">265</span></a>
</span><span id="SMBSession.get_file-266"><a href="#SMBSession.get_file-266"><span class="linenos">266</span></a>        <span class="c1"># Search for the file</span>
</span><span id="SMBSession.get_file-267"><a href="#SMBSession.get_file-267"><span class="linenos">267</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession.get_file-268"><a href="#SMBSession.get_file-268"><span class="linenos">268</span></a>            <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.get_file-269"><a href="#SMBSession.get_file-269"><span class="linenos">269</span></a>            <span class="n">path</span><span class="o">=</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span>
</span><span id="SMBSession.get_file-270"><a href="#SMBSession.get_file-270"><span class="linenos">270</span></a>        <span class="p">)</span>   
</span><span id="SMBSession.get_file-271"><a href="#SMBSession.get_file-271"><span class="linenos">271</span></a>
</span><span id="SMBSession.get_file-272"><a href="#SMBSession.get_file-272"><span class="linenos">272</span></a>        <span class="c1"># Filter the entries</span>
</span><span id="SMBSession.get_file-273"><a href="#SMBSession.get_file-273"><span class="linenos">273</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SMBSession.get_file-274"><a href="#SMBSession.get_file-274"><span class="linenos">274</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="SMBSession.get_file-275"><a href="#SMBSession.get_file-275"><span class="linenos">275</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession.get_file-276"><a href="#SMBSession.get_file-276"><span class="linenos">276</span></a>                <span class="c1"># Skip directories</span>
</span><span id="SMBSession.get_file-277"><a href="#SMBSession.get_file-277"><span class="linenos">277</span></a>                <span class="k">continue</span>
</span><span id="SMBSession.get_file-278"><a href="#SMBSession.get_file-278"><span class="linenos">278</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">==</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SMBSession.get_file-279"><a href="#SMBSession.get_file-279"><span class="linenos">279</span></a>                <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="SMBSession.get_file-280"><a href="#SMBSession.get_file-280"><span class="linenos">280</span></a>            <span class="k">elif</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SMBSession.get_file-281"><a href="#SMBSession.get_file-281"><span class="linenos">281</span></a>                <span class="n">regexp</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;.*&#39;</span><span class="p">)</span>
</span><span id="SMBSession.get_file-282"><a href="#SMBSession.get_file-282"><span class="linenos">282</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()):</span>
</span><span id="SMBSession.get_file-283"><a href="#SMBSession.get_file-283"><span class="linenos">283</span></a>                    <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="SMBSession.get_file-284"><a href="#SMBSession.get_file-284"><span class="linenos">284</span></a>        
</span><span id="SMBSession.get_file-285"><a href="#SMBSession.get_file-285"><span class="linenos">285</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">matching_entries</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_longname</span><span class="p">())</span>
</span><span id="SMBSession.get_file-286"><a href="#SMBSession.get_file-286"><span class="linenos">286</span></a>
</span><span id="SMBSession.get_file-287"><a href="#SMBSession.get_file-287"><span class="linenos">287</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matching_entries</span><span class="p">:</span>
</span><span id="SMBSession.get_file-288"><a href="#SMBSession.get_file-288"><span class="linenos">288</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession.get_file-289"><a href="#SMBSession.get_file-289"><span class="linenos">289</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.get_file-290"><a href="#SMBSession.get_file-290"><span class="linenos">290</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] [&gt;] Skipping &#39;</span><span class="si">%s</span><span class="s2">&#39; because it is a directory.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.get_file-291"><a href="#SMBSession.get_file-291"><span class="linenos">291</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.get_file-292"><a href="#SMBSession.get_file-292"><span class="linenos">292</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.get_file-293"><a href="#SMBSession.get_file-293"><span class="linenos">293</span></a>                    <span class="k">if</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="SMBSession.get_file-294"><a href="#SMBSession.get_file-294"><span class="linenos">294</span></a>                        <span class="n">outputfile</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span>
</span><span id="SMBSession.get_file-295"><a href="#SMBSession.get_file-295"><span class="linenos">295</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.get_file-296"><a href="#SMBSession.get_file-296"><span class="linenos">296</span></a>                        <span class="n">outputfile</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span>
</span><span id="SMBSession.get_file-297"><a href="#SMBSession.get_file-297"><span class="linenos">297</span></a>                    <span class="n">f</span> <span class="o">=</span> <span class="n">LocalFileIO</span><span class="p">(</span>
</span><span id="SMBSession.get_file-298"><a href="#SMBSession.get_file-298"><span class="linenos">298</span></a>                        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wb&quot;</span><span class="p">,</span> 
</span><span id="SMBSession.get_file-299"><a href="#SMBSession.get_file-299"><span class="linenos">299</span></a>                        <span class="n">path</span><span class="o">=</span><span class="n">outputfile</span><span class="p">,</span>
</span><span id="SMBSession.get_file-300"><a href="#SMBSession.get_file-300"><span class="linenos">300</span></a>                        <span class="n">expected_size</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="n">get_filesize</span><span class="p">(),</span> 
</span><span id="SMBSession.get_file-301"><a href="#SMBSession.get_file-301"><span class="linenos">301</span></a>                        <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
</span><span id="SMBSession.get_file-302"><a href="#SMBSession.get_file-302"><span class="linenos">302</span></a>                        <span class="n">keepRemotePath</span><span class="o">=</span><span class="n">keepRemotePath</span>
</span><span id="SMBSession.get_file-303"><a href="#SMBSession.get_file-303"><span class="linenos">303</span></a>                    <span class="p">)</span>
</span><span id="SMBSession.get_file-304"><a href="#SMBSession.get_file-304"><span class="linenos">304</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span>
</span><span id="SMBSession.get_file-305"><a href="#SMBSession.get_file-305"><span class="linenos">305</span></a>                        <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.get_file-306"><a href="#SMBSession.get_file-306"><span class="linenos">306</span></a>                        <span class="n">pathName</span><span class="o">=</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">(),</span> 
</span><span id="SMBSession.get_file-307"><a href="#SMBSession.get_file-307"><span class="linenos">307</span></a>                        <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">write</span>
</span><span id="SMBSession.get_file-308"><a href="#SMBSession.get_file-308"><span class="linenos">308</span></a>                    <span class="p">)</span>
</span><span id="SMBSession.get_file-309"><a href="#SMBSession.get_file-309"><span class="linenos">309</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession.get_file-310"><a href="#SMBSession.get_file-310"><span class="linenos">310</span></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">BrokenPipeError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession.get_file-311"><a href="#SMBSession.get_file-311"><span class="linenos">311</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession.get_file-312"><a href="#SMBSession.get_file-312"><span class="linenos">312</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[v</span><span class="se">\x1b</span><span class="s2">[o</span><span class="se">\r</span><span class="s2">[!] Interrupted.&quot;</span><span class="p">)</span>
</span><span id="SMBSession.get_file-313"><a href="#SMBSession.get_file-313"><span class="linenos">313</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">close_smb_session</span><span class="p">()</span>
</span><span id="SMBSession.get_file-314"><a href="#SMBSession.get_file-314"><span class="linenos">314</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">init_smb_session</span><span class="p">()</span>
</span><span id="SMBSession.get_file-315"><a href="#SMBSession.get_file-315"><span class="linenos">315</span></a>                        
</span><span id="SMBSession.get_file-316"><a href="#SMBSession.get_file-316"><span class="linenos">316</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves a file from the specified path on the SMB share.</p>

<p>This method attempts to retrieve a file from the given path within the currently connected SMB share.
If the path points to a directory, it skips the retrieval. It handles file retrieval by creating a local
file object and writing the contents of the remote file to it using the SMB client's getFile method.</p>

<p>Parameters:
    path (str): The path of the file to retrieve. If None, uses the current smb_path.</p>

<p>Returns:
    None</p>
</div>


                            </div>
                            <div id="SMBSession.get_file_recursively" class="classattr">
                                        <input id="SMBSession.get_file_recursively-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_file_recursively</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.get_file_recursively-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.get_file_recursively"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.get_file_recursively-318"><a href="#SMBSession.get_file_recursively-318"><span class="linenos">318</span></a>    <span class="k">def</span> <span class="nf">get_file_recursively</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.get_file_recursively-319"><a href="#SMBSession.get_file_recursively-319"><span class="linenos">319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.get_file_recursively-320"><a href="#SMBSession.get_file_recursively-320"><span class="linenos">320</span></a><span class="sd">        Recursively retrieves files from a specified path on the SMB share.</span>
</span><span id="SMBSession.get_file_recursively-321"><a href="#SMBSession.get_file_recursively-321"><span class="linenos">321</span></a>
</span><span id="SMBSession.get_file_recursively-322"><a href="#SMBSession.get_file_recursively-322"><span class="linenos">322</span></a><span class="sd">        This method navigates through all directories starting from the given path,</span>
</span><span id="SMBSession.get_file_recursively-323"><a href="#SMBSession.get_file_recursively-323"><span class="linenos">323</span></a><span class="sd">        and downloads all files found. It handles directories recursively, ensuring</span>
</span><span id="SMBSession.get_file_recursively-324"><a href="#SMBSession.get_file_recursively-324"><span class="linenos">324</span></a><span class="sd">        that all nested files are retrieved. The method skips over directory entries</span>
</span><span id="SMBSession.get_file_recursively-325"><a href="#SMBSession.get_file_recursively-325"><span class="linenos">325</span></a><span class="sd">        and handles errors gracefully, attempting to continue the operation where possible.</span>
</span><span id="SMBSession.get_file_recursively-326"><a href="#SMBSession.get_file_recursively-326"><span class="linenos">326</span></a>
</span><span id="SMBSession.get_file_recursively-327"><a href="#SMBSession.get_file_recursively-327"><span class="linenos">327</span></a><span class="sd">        Parameters:</span>
</span><span id="SMBSession.get_file_recursively-328"><a href="#SMBSession.get_file_recursively-328"><span class="linenos">328</span></a><span class="sd">            path (str): The initial directory path from which to start the recursive file retrieval.</span>
</span><span id="SMBSession.get_file_recursively-329"><a href="#SMBSession.get_file_recursively-329"><span class="linenos">329</span></a><span class="sd">                        If None, it starts from the root of the configured SMB share.</span>
</span><span id="SMBSession.get_file_recursively-330"><a href="#SMBSession.get_file_recursively-330"><span class="linenos">330</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.get_file_recursively-331"><a href="#SMBSession.get_file_recursively-331"><span class="linenos">331</span></a>        
</span><span id="SMBSession.get_file_recursively-332"><a href="#SMBSession.get_file_recursively-332"><span class="linenos">332</span></a>        <span class="k">def</span> <span class="nf">recurse_action</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="p">[]):</span>
</span><span id="SMBSession.get_file_recursively-333"><a href="#SMBSession.get_file_recursively-333"><span class="linenos">333</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession.get_file_recursively-334"><a href="#SMBSession.get_file_recursively-334"><span class="linenos">334</span></a>                <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession.get_file_recursively-335"><a href="#SMBSession.get_file_recursively-335"><span class="linenos">335</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.get_file_recursively-336"><a href="#SMBSession.get_file_recursively-336"><span class="linenos">336</span></a>                <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession.get_file_recursively-337"><a href="#SMBSession.get_file_recursively-337"><span class="linenos">337</span></a>            <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">remote_smb_path</span><span class="p">)</span>
</span><span id="SMBSession.get_file_recursively-338"><a href="#SMBSession.get_file_recursively-338"><span class="linenos">338</span></a>
</span><span id="SMBSession.get_file_recursively-339"><a href="#SMBSession.get_file_recursively-339"><span class="linenos">339</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession.get_file_recursively-340"><a href="#SMBSession.get_file_recursively-340"><span class="linenos">340</span></a>                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.get_file_recursively-341"><a href="#SMBSession.get_file_recursively-341"><span class="linenos">341</span></a>                <span class="n">path</span><span class="o">=</span><span class="n">remote_smb_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">*&#39;</span>
</span><span id="SMBSession.get_file_recursively-342"><a href="#SMBSession.get_file_recursively-342"><span class="linenos">342</span></a>            <span class="p">)</span>
</span><span id="SMBSession.get_file_recursively-343"><a href="#SMBSession.get_file_recursively-343"><span class="linenos">343</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession.get_file_recursively-344"><a href="#SMBSession.get_file_recursively-344"><span class="linenos">344</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">()]</span>
</span><span id="SMBSession.get_file_recursively-345"><a href="#SMBSession.get_file_recursively-345"><span class="linenos">345</span></a>                <span class="n">directories</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">()</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">]]</span>
</span><span id="SMBSession.get_file_recursively-346"><a href="#SMBSession.get_file_recursively-346"><span class="linenos">346</span></a>
</span><span id="SMBSession.get_file_recursively-347"><a href="#SMBSession.get_file_recursively-347"><span class="linenos">347</span></a>                <span class="c1"># Files</span>
</span><span id="SMBSession.get_file_recursively-348"><a href="#SMBSession.get_file_recursively-348"><span class="linenos">348</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession.get_file_recursively-349"><a href="#SMBSession.get_file_recursively-349"><span class="linenos">349</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[&gt;] Retrieving files of &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">remote_smb_path</span><span class="p">)</span>
</span><span id="SMBSession.get_file_recursively-350"><a href="#SMBSession.get_file_recursively-350"><span class="linenos">350</span></a>                <span class="k">for</span> <span class="n">entry_file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="SMBSession.get_file_recursively-351"><a href="#SMBSession.get_file_recursively-351"><span class="linenos">351</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">entry_file</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession.get_file_recursively-352"><a href="#SMBSession.get_file_recursively-352"><span class="linenos">352</span></a>                        <span class="n">f</span> <span class="o">=</span> <span class="n">LocalFileIO</span><span class="p">(</span>
</span><span id="SMBSession.get_file_recursively-353"><a href="#SMBSession.get_file_recursively-353"><span class="linenos">353</span></a>                            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wb&quot;</span><span class="p">,</span>
</span><span id="SMBSession.get_file_recursively-354"><a href="#SMBSession.get_file_recursively-354"><span class="linenos">354</span></a>                            <span class="n">path</span><span class="o">=</span><span class="n">remote_smb_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry_file</span><span class="o">.</span><span class="n">get_longname</span><span class="p">(),</span> 
</span><span id="SMBSession.get_file_recursively-355"><a href="#SMBSession.get_file_recursively-355"><span class="linenos">355</span></a>                            <span class="n">expected_size</span><span class="o">=</span><span class="n">entry_file</span><span class="o">.</span><span class="n">get_filesize</span><span class="p">(),</span>
</span><span id="SMBSession.get_file_recursively-356"><a href="#SMBSession.get_file_recursively-356"><span class="linenos">356</span></a>                            <span class="n">keepRemotePath</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SMBSession.get_file_recursively-357"><a href="#SMBSession.get_file_recursively-357"><span class="linenos">357</span></a>                            <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span>
</span><span id="SMBSession.get_file_recursively-358"><a href="#SMBSession.get_file_recursively-358"><span class="linenos">358</span></a>                        <span class="p">)</span>
</span><span id="SMBSession.get_file_recursively-359"><a href="#SMBSession.get_file_recursively-359"><span class="linenos">359</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.get_file_recursively-360"><a href="#SMBSession.get_file_recursively-360"><span class="linenos">360</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span>
</span><span id="SMBSession.get_file_recursively-361"><a href="#SMBSession.get_file_recursively-361"><span class="linenos">361</span></a>                                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.get_file_recursively-362"><a href="#SMBSession.get_file_recursively-362"><span class="linenos">362</span></a>                                <span class="n">pathName</span><span class="o">=</span><span class="n">remote_smb_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry_file</span><span class="o">.</span><span class="n">get_longname</span><span class="p">(),</span> 
</span><span id="SMBSession.get_file_recursively-363"><a href="#SMBSession.get_file_recursively-363"><span class="linenos">363</span></a>                                <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">write</span>
</span><span id="SMBSession.get_file_recursively-364"><a href="#SMBSession.get_file_recursively-364"><span class="linenos">364</span></a>                            <span class="p">)</span>
</span><span id="SMBSession.get_file_recursively-365"><a href="#SMBSession.get_file_recursively-365"><span class="linenos">365</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession.get_file_recursively-366"><a href="#SMBSession.get_file_recursively-366"><span class="linenos">366</span></a>                        <span class="k">except</span> <span class="ne">BrokenPipeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.get_file_recursively-367"><a href="#SMBSession.get_file_recursively-367"><span class="linenos">367</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">set_error</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;[bold red]Failed downloading &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession.get_file_recursively-368"><a href="#SMBSession.get_file_recursively-368"><span class="linenos">368</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SMBSession.get_file_recursively-369"><a href="#SMBSession.get_file_recursively-369"><span class="linenos">369</span></a>                            <span class="k">break</span>
</span><span id="SMBSession.get_file_recursively-370"><a href="#SMBSession.get_file_recursively-370"><span class="linenos">370</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.get_file_recursively-371"><a href="#SMBSession.get_file_recursively-371"><span class="linenos">371</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">set_error</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;[bold red]Failed downloading &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession.get_file_recursively-372"><a href="#SMBSession.get_file_recursively-372"><span class="linenos">372</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SMBSession.get_file_recursively-373"><a href="#SMBSession.get_file_recursively-373"><span class="linenos">373</span></a>                
</span><span id="SMBSession.get_file_recursively-374"><a href="#SMBSession.get_file_recursively-374"><span class="linenos">374</span></a>                <span class="c1"># Directories</span>
</span><span id="SMBSession.get_file_recursively-375"><a href="#SMBSession.get_file_recursively-375"><span class="linenos">375</span></a>                <span class="k">for</span> <span class="n">entry_directory</span> <span class="ow">in</span> <span class="n">directories</span><span class="p">:</span>
</span><span id="SMBSession.get_file_recursively-376"><a href="#SMBSession.get_file_recursively-376"><span class="linenos">376</span></a>                    <span class="k">if</span> <span class="n">entry_directory</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession.get_file_recursively-377"><a href="#SMBSession.get_file_recursively-377"><span class="linenos">377</span></a>                        <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession.get_file_recursively-378"><a href="#SMBSession.get_file_recursively-378"><span class="linenos">378</span></a>                            <span class="n">base_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="p">,</span> 
</span><span id="SMBSession.get_file_recursively-379"><a href="#SMBSession.get_file_recursively-379"><span class="linenos">379</span></a>                            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry_directory</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()]</span>
</span><span id="SMBSession.get_file_recursively-380"><a href="#SMBSession.get_file_recursively-380"><span class="linenos">380</span></a>                        <span class="p">)</span>                   
</span><span id="SMBSession.get_file_recursively-381"><a href="#SMBSession.get_file_recursively-381"><span class="linenos">381</span></a>        <span class="c1"># Entrypoint</span>
</span><span id="SMBSession.get_file_recursively-382"><a href="#SMBSession.get_file_recursively-382"><span class="linenos">382</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.get_file_recursively-383"><a href="#SMBSession.get_file_recursively-383"><span class="linenos">383</span></a>            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession.get_file_recursively-384"><a href="#SMBSession.get_file_recursively-384"><span class="linenos">384</span></a>                <span class="n">base_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="p">,</span> 
</span><span id="SMBSession.get_file_recursively-385"><a href="#SMBSession.get_file_recursively-385"><span class="linenos">385</span></a>                <span class="n">path</span><span class="o">=</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
</span><span id="SMBSession.get_file_recursively-386"><a href="#SMBSession.get_file_recursively-386"><span class="linenos">386</span></a>            <span class="p">)</span>
</span><span id="SMBSession.get_file_recursively-387"><a href="#SMBSession.get_file_recursively-387"><span class="linenos">387</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">BrokenPipeError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession.get_file_recursively-388"><a href="#SMBSession.get_file_recursively-388"><span class="linenos">388</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[v</span><span class="se">\x1b</span><span class="s2">[o</span><span class="se">\r</span><span class="s2">[!] Interrupted.&quot;</span><span class="p">)</span>
</span><span id="SMBSession.get_file_recursively-389"><a href="#SMBSession.get_file_recursively-389"><span class="linenos">389</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">close_smb_session</span><span class="p">()</span>
</span><span id="SMBSession.get_file_recursively-390"><a href="#SMBSession.get_file_recursively-390"><span class="linenos">390</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_smb_session</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Recursively retrieves files from a specified path on the SMB share.</p>

<p>This method navigates through all directories starting from the given path,
and downloads all files found. It handles directories recursively, ensuring
that all nested files are retrieved. The method skips over directory entries
and handles errors gracefully, attempting to continue the operation where possible.</p>

<p>Parameters:
    path (str): The initial directory path from which to start the recursive file retrieval.
                If None, it starts from the root of the configured SMB share.</p>
</div>


                            </div>
                            <div id="SMBSession.get_entry" class="classattr">
                                        <input id="SMBSession.get_entry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_entry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.get_entry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.get_entry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.get_entry-392"><a href="#SMBSession.get_entry-392"><span class="linenos">392</span></a>    <span class="k">def</span> <span class="nf">get_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.get_entry-393"><a href="#SMBSession.get_entry-393"><span class="linenos">393</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.get_entry-394"><a href="#SMBSession.get_entry-394"><span class="linenos">394</span></a><span class="sd">        Retrieves information about a specific entry located at the provided path on the SMB share.</span>
</span><span id="SMBSession.get_entry-395"><a href="#SMBSession.get_entry-395"><span class="linenos">395</span></a>
</span><span id="SMBSession.get_entry-396"><a href="#SMBSession.get_entry-396"><span class="linenos">396</span></a><span class="sd">        This method checks if the specified path exists on the SMB share. If the path exists, it retrieves the details of the entry at that path, including the directory name and file name. If the entry is found, it returns the entry object; otherwise, it returns None.</span>
</span><span id="SMBSession.get_entry-397"><a href="#SMBSession.get_entry-397"><span class="linenos">397</span></a>
</span><span id="SMBSession.get_entry-398"><a href="#SMBSession.get_entry-398"><span class="linenos">398</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession.get_entry-399"><a href="#SMBSession.get_entry-399"><span class="linenos">399</span></a><span class="sd">            path (str): The path of the entry to retrieve information about.</span>
</span><span id="SMBSession.get_entry-400"><a href="#SMBSession.get_entry-400"><span class="linenos">400</span></a>
</span><span id="SMBSession.get_entry-401"><a href="#SMBSession.get_entry-401"><span class="linenos">401</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession.get_entry-402"><a href="#SMBSession.get_entry-402"><span class="linenos">402</span></a><span class="sd">            Entry: An object representing the entry at the specified path, or None if the entry is not found.</span>
</span><span id="SMBSession.get_entry-403"><a href="#SMBSession.get_entry-403"><span class="linenos">403</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.get_entry-404"><a href="#SMBSession.get_entry-404"><span class="linenos">404</span></a>
</span><span id="SMBSession.get_entry-405"><a href="#SMBSession.get_entry-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_exists</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">):</span>
</span><span id="SMBSession.get_entry-406"><a href="#SMBSession.get_entry-406"><span class="linenos">406</span></a>            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span><span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession.get_entry-407"><a href="#SMBSession.get_entry-407"><span class="linenos">407</span></a>
</span><span id="SMBSession.get_entry-408"><a href="#SMBSession.get_entry-408"><span class="linenos">408</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SMBSession.get_entry-409"><a href="#SMBSession.get_entry-409"><span class="linenos">409</span></a>                <span class="k">return</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SMBSession.get_entry-410"><a href="#SMBSession.get_entry-410"><span class="linenos">410</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.get_entry-411"><a href="#SMBSession.get_entry-411"><span class="linenos">411</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="SMBSession.get_entry-412"><a href="#SMBSession.get_entry-412"><span class="linenos">412</span></a>            
</span><span id="SMBSession.get_entry-413"><a href="#SMBSession.get_entry-413"><span class="linenos">413</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.get_entry-414"><a href="#SMBSession.get_entry-414"><span class="linenos">414</span></a>            <span class="k">return</span> <span class="kc">None</span> 
</span></pre></div>


            <div class="docstring"><p>Retrieves information about a specific entry located at the provided path on the SMB share.</p>

<p>This method checks if the specified path exists on the SMB share. If the path exists, it retrieves the details of the entry at that path, including the directory name and file name. If the entry is found, it returns the entry object; otherwise, it returns None.</p>

<p>Args:
    path (str): The path of the entry to retrieve information about.</p>

<p>Returns:
    Entry: An object representing the entry at the specified path, or None if the entry is not found.</p>
</div>


                            </div>
                            <div id="SMBSession.info" class="classattr">
                                        <input id="SMBSession.info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">share</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">server</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.info-416"><a href="#SMBSession.info-416"><span class="linenos">416</span></a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">share</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="SMBSession.info-417"><a href="#SMBSession.info-417"><span class="linenos">417</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.info-418"><a href="#SMBSession.info-418"><span class="linenos">418</span></a><span class="sd">        Displays information about the server and optionally the shares.</span>
</span><span id="SMBSession.info-419"><a href="#SMBSession.info-419"><span class="linenos">419</span></a>
</span><span id="SMBSession.info-420"><a href="#SMBSession.info-420"><span class="linenos">420</span></a><span class="sd">        This method prints detailed information about the server&#39;s characteristics such as NetBIOS names, DNS details, OS information, and SMB capabilities. If the `share` parameter is set to True and a share is currently set, it will also attempt to display information about the share.</span>
</span><span id="SMBSession.info-421"><a href="#SMBSession.info-421"><span class="linenos">421</span></a>
</span><span id="SMBSession.info-422"><a href="#SMBSession.info-422"><span class="linenos">422</span></a><span class="sd">        Parameters:</span>
</span><span id="SMBSession.info-423"><a href="#SMBSession.info-423"><span class="linenos">423</span></a><span class="sd">            share (bool): If True, display information about the current share.</span>
</span><span id="SMBSession.info-424"><a href="#SMBSession.info-424"><span class="linenos">424</span></a><span class="sd">            server (bool): If True, display information about the server.</span>
</span><span id="SMBSession.info-425"><a href="#SMBSession.info-425"><span class="linenos">425</span></a>
</span><span id="SMBSession.info-426"><a href="#SMBSession.info-426"><span class="linenos">426</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession.info-427"><a href="#SMBSession.info-427"><span class="linenos">427</span></a><span class="sd">            None</span>
</span><span id="SMBSession.info-428"><a href="#SMBSession.info-428"><span class="linenos">428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.info-429"><a href="#SMBSession.info-429"><span class="linenos">429</span></a>
</span><span id="SMBSession.info-430"><a href="#SMBSession.info-430"><span class="linenos">430</span></a>        <span class="k">if</span> <span class="n">server</span><span class="p">:</span>
</span><span id="SMBSession.info-431"><a href="#SMBSession.info-431"><span class="linenos">431</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession.info-432"><a href="#SMBSession.info-432"><span class="linenos">432</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Server:&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-433"><a href="#SMBSession.info-433"><span class="linenos">433</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─NetBIOS:&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-434"><a href="#SMBSession.info-434"><span class="linenos">434</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ NetBIOS Hostname ──────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerName</span><span class="p">()))</span>
</span><span id="SMBSession.info-435"><a href="#SMBSession.info-435"><span class="linenos">435</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ NetBIOS Domain ────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDomain</span><span class="p">()))</span>
</span><span id="SMBSession.info-436"><a href="#SMBSession.info-436"><span class="linenos">436</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─DNS:&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-437"><a href="#SMBSession.info-437"><span class="linenos">437</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ DNS Hostname ──────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDNSHostName</span><span class="p">()))</span>
</span><span id="SMBSession.info-438"><a href="#SMBSession.info-438"><span class="linenos">438</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ DNS Domain ────────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDNSDomainName</span><span class="p">()))</span>
</span><span id="SMBSession.info-439"><a href="#SMBSession.info-439"><span class="linenos">439</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─OS:&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-440"><a href="#SMBSession.info-440"><span class="linenos">440</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ OS Name ───────────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOS</span><span class="p">()))</span>
</span><span id="SMBSession.info-441"><a href="#SMBSession.info-441"><span class="linenos">441</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ OS Version ────────────── : </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSMajor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSMinor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSBuild</span><span class="p">()))</span>
</span><span id="SMBSession.info-442"><a href="#SMBSession.info-442"><span class="linenos">442</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─Server:&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-443"><a href="#SMBSession.info-443"><span class="linenos">443</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ Signing Required ──────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">isSigningRequired</span><span class="p">()))</span>
</span><span id="SMBSession.info-444"><a href="#SMBSession.info-444"><span class="linenos">444</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ Login Required ────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">isLoginRequired</span><span class="p">()))</span>
</span><span id="SMBSession.info-445"><a href="#SMBSession.info-445"><span class="linenos">445</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ Supports NTLMv2 ───────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">doesSupportNTLMv2</span><span class="p">()))</span>
</span><span id="SMBSession.info-446"><a href="#SMBSession.info-446"><span class="linenos">446</span></a>                <span class="n">MaxReadSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getIOCapabilities</span><span class="p">()[</span><span class="s2">&quot;MaxReadSize&quot;</span><span class="p">]</span>
</span><span id="SMBSession.info-447"><a href="#SMBSession.info-447"><span class="linenos">447</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ Max size of read chunk ── : </span><span class="si">%d</span><span class="s2"> bytes (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MaxReadSize</span><span class="p">,</span> <span class="n">b_filesize</span><span class="p">(</span><span class="n">MaxReadSize</span><span class="p">)))</span>
</span><span id="SMBSession.info-448"><a href="#SMBSession.info-448"><span class="linenos">448</span></a>                <span class="n">MaxWriteSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getIOCapabilities</span><span class="p">()[</span><span class="s2">&quot;MaxWriteSize&quot;</span><span class="p">]</span>
</span><span id="SMBSession.info-449"><a href="#SMBSession.info-449"><span class="linenos">449</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ Max size of write chunk ─ : </span><span class="si">%d</span><span class="s2"> bytes (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MaxWriteSize</span><span class="p">,</span> <span class="n">b_filesize</span><span class="p">(</span><span class="n">MaxWriteSize</span><span class="p">)))</span>
</span><span id="SMBSession.info-450"><a href="#SMBSession.info-450"><span class="linenos">450</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  └─&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-451"><a href="#SMBSession.info-451"><span class="linenos">451</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.info-452"><a href="#SMBSession.info-452"><span class="linenos">452</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Server:&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-453"><a href="#SMBSession.info-453"><span class="linenos">453</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─NetBIOS:&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-454"><a href="#SMBSession.info-454"><span class="linenos">454</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mNetBIOS Hostname</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerName</span><span class="p">()))</span>
</span><span id="SMBSession.info-455"><a href="#SMBSession.info-455"><span class="linenos">455</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ </span><span class="se">\x1b</span><span class="s2">[94mNetBIOS Domain</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDomain</span><span class="p">()))</span>
</span><span id="SMBSession.info-456"><a href="#SMBSession.info-456"><span class="linenos">456</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─DNS:&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-457"><a href="#SMBSession.info-457"><span class="linenos">457</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mDNS Hostname</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDNSHostName</span><span class="p">()))</span>
</span><span id="SMBSession.info-458"><a href="#SMBSession.info-458"><span class="linenos">458</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ </span><span class="se">\x1b</span><span class="s2">[94mDNS Domain</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerDNSDomainName</span><span class="p">()))</span>
</span><span id="SMBSession.info-459"><a href="#SMBSession.info-459"><span class="linenos">459</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─OS:&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-460"><a href="#SMBSession.info-460"><span class="linenos">460</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mOS Name</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m─────────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOS</span><span class="p">()))</span>
</span><span id="SMBSession.info-461"><a href="#SMBSession.info-461"><span class="linenos">461</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ </span><span class="se">\x1b</span><span class="s2">[94mOS Version</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSMajor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSMinor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getServerOSBuild</span><span class="p">()))</span>
</span><span id="SMBSession.info-462"><a href="#SMBSession.info-462"><span class="linenos">462</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─Server:&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-463"><a href="#SMBSession.info-463"><span class="linenos">463</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mSigning Required</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">isSigningRequired</span><span class="p">()))</span>
</span><span id="SMBSession.info-464"><a href="#SMBSession.info-464"><span class="linenos">464</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mLogin Required</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">isLoginRequired</span><span class="p">()))</span>
</span><span id="SMBSession.info-465"><a href="#SMBSession.info-465"><span class="linenos">465</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mSupports NTLMv2</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m─────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">doesSupportNTLMv2</span><span class="p">()))</span>
</span><span id="SMBSession.info-466"><a href="#SMBSession.info-466"><span class="linenos">466</span></a>                <span class="n">MaxReadSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getIOCapabilities</span><span class="p">()[</span><span class="s2">&quot;MaxReadSize&quot;</span><span class="p">]</span>
</span><span id="SMBSession.info-467"><a href="#SMBSession.info-467"><span class="linenos">467</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ ├─ </span><span class="se">\x1b</span><span class="s2">[94mMax size of read chunk</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%d</span><span class="s2"> bytes (</span><span class="si">%s</span><span class="s2">)</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MaxReadSize</span><span class="p">,</span> <span class="n">b_filesize</span><span class="p">(</span><span class="n">MaxReadSize</span><span class="p">)))</span>
</span><span id="SMBSession.info-468"><a href="#SMBSession.info-468"><span class="linenos">468</span></a>                <span class="n">MaxWriteSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getIOCapabilities</span><span class="p">()[</span><span class="s2">&quot;MaxWriteSize&quot;</span><span class="p">]</span>
</span><span id="SMBSession.info-469"><a href="#SMBSession.info-469"><span class="linenos">469</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  │ └─ </span><span class="se">\x1b</span><span class="s2">[94mMax size of write chunk</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m─</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%d</span><span class="s2"> bytes (</span><span class="si">%s</span><span class="s2">)</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MaxWriteSize</span><span class="p">,</span> <span class="n">b_filesize</span><span class="p">(</span><span class="n">MaxWriteSize</span><span class="p">)))</span>
</span><span id="SMBSession.info-470"><a href="#SMBSession.info-470"><span class="linenos">470</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  └─&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-471"><a href="#SMBSession.info-471"><span class="linenos">471</span></a>
</span><span id="SMBSession.info-472"><a href="#SMBSession.info-472"><span class="linenos">472</span></a>        <span class="k">if</span> <span class="n">share</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.info-473"><a href="#SMBSession.info-473"><span class="linenos">473</span></a>            <span class="n">share_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="SMBSession.info-474"><a href="#SMBSession.info-474"><span class="linenos">474</span></a>            <span class="n">share_comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span>
</span><span id="SMBSession.info-475"><a href="#SMBSession.info-475"><span class="linenos">475</span></a>            <span class="n">share_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
</span><span id="SMBSession.info-476"><a href="#SMBSession.info-476"><span class="linenos">476</span></a>            <span class="n">share_type</span> <span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;STYPE_&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">share_type</span><span class="p">])</span>
</span><span id="SMBSession.info-477"><a href="#SMBSession.info-477"><span class="linenos">477</span></a>            <span class="n">share_rawtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)[</span><span class="s2">&quot;rawtype&quot;</span><span class="p">]</span>
</span><span id="SMBSession.info-478"><a href="#SMBSession.info-478"><span class="linenos">478</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession.info-479"><a href="#SMBSession.info-479"><span class="linenos">479</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[+] Share:&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-480"><a href="#SMBSession.info-480"><span class="linenos">480</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ Name ──────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_name</span><span class="p">))</span>
</span><span id="SMBSession.info-481"><a href="#SMBSession.info-481"><span class="linenos">481</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ Description ───── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_comment</span><span class="p">))</span>
</span><span id="SMBSession.info-482"><a href="#SMBSession.info-482"><span class="linenos">482</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ Type ──────────── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_type</span><span class="p">))</span>
</span><span id="SMBSession.info-483"><a href="#SMBSession.info-483"><span class="linenos">483</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  └─ Raw type value ── : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_rawtype</span><span class="p">))</span>
</span><span id="SMBSession.info-484"><a href="#SMBSession.info-484"><span class="linenos">484</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.info-485"><a href="#SMBSession.info-485"><span class="linenos">485</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[+] Share:&quot;</span><span class="p">)</span>
</span><span id="SMBSession.info-486"><a href="#SMBSession.info-486"><span class="linenos">486</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ </span><span class="se">\x1b</span><span class="s2">[94mName</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_name</span><span class="p">))</span>
</span><span id="SMBSession.info-487"><a href="#SMBSession.info-487"><span class="linenos">487</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ </span><span class="se">\x1b</span><span class="s2">[94mDescription</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m─────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_comment</span><span class="p">))</span>
</span><span id="SMBSession.info-488"><a href="#SMBSession.info-488"><span class="linenos">488</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ├─ </span><span class="se">\x1b</span><span class="s2">[94mType</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m────────────</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_type</span><span class="p">))</span>
</span><span id="SMBSession.info-489"><a href="#SMBSession.info-489"><span class="linenos">489</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  └─ </span><span class="se">\x1b</span><span class="s2">[94mRaw type value</span><span class="se">\x1b</span><span class="s2">[0m </span><span class="se">\x1b</span><span class="s2">[90m──</span><span class="se">\x1b</span><span class="s2">[0m : </span><span class="se">\x1b</span><span class="s2">[93m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">share_rawtype</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Displays information about the server and optionally the shares.</p>

<p>This method prints detailed information about the server's characteristics such as NetBIOS names, DNS details, OS information, and SMB capabilities. If the <code>share</code> parameter is set to True and a share is currently set, it will also attempt to display information about the share.</p>

<p>Parameters:
    share (bool): If True, display information about the current share.
    server (bool): If True, display information about the server.</p>

<p>Returns:
    None</p>
</div>


                            </div>
                            <div id="SMBSession.list_contents" class="classattr">
                                        <input id="SMBSession.list_contents-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_contents</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.list_contents-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.list_contents"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.list_contents-491"><a href="#SMBSession.list_contents-491"><span class="linenos">491</span></a>    <span class="k">def</span> <span class="nf">list_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.list_contents-492"><a href="#SMBSession.list_contents-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.list_contents-493"><a href="#SMBSession.list_contents-493"><span class="linenos">493</span></a><span class="sd">        Lists the contents of a specified directory on the SMB share.</span>
</span><span id="SMBSession.list_contents-494"><a href="#SMBSession.list_contents-494"><span class="linenos">494</span></a>
</span><span id="SMBSession.list_contents-495"><a href="#SMBSession.list_contents-495"><span class="linenos">495</span></a><span class="sd">        This method retrieves the contents of a directory specified by `shareName` and `path`. If `shareName` or `path`</span>
</span><span id="SMBSession.list_contents-496"><a href="#SMBSession.list_contents-496"><span class="linenos">496</span></a><span class="sd">        is not provided, it defaults to the instance&#39;s current SMB share or path. The method returns a dictionary with</span>
</span><span id="SMBSession.list_contents-497"><a href="#SMBSession.list_contents-497"><span class="linenos">497</span></a><span class="sd">        the long names of the files and directories as keys and their respective SMB entry objects as values.</span>
</span><span id="SMBSession.list_contents-498"><a href="#SMBSession.list_contents-498"><span class="linenos">498</span></a>
</span><span id="SMBSession.list_contents-499"><a href="#SMBSession.list_contents-499"><span class="linenos">499</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession.list_contents-500"><a href="#SMBSession.list_contents-500"><span class="linenos">500</span></a><span class="sd">            shareName (str, optional): The name of the SMB share. Defaults to the current SMB share if None.</span>
</span><span id="SMBSession.list_contents-501"><a href="#SMBSession.list_contents-501"><span class="linenos">501</span></a><span class="sd">            path (str, optional): The directory path to list contents from. Defaults to the current path if None.</span>
</span><span id="SMBSession.list_contents-502"><a href="#SMBSession.list_contents-502"><span class="linenos">502</span></a>
</span><span id="SMBSession.list_contents-503"><a href="#SMBSession.list_contents-503"><span class="linenos">503</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession.list_contents-504"><a href="#SMBSession.list_contents-504"><span class="linenos">504</span></a><span class="sd">            dict: A dictionary with file and directory names as keys and their SMB entry objects as values.</span>
</span><span id="SMBSession.list_contents-505"><a href="#SMBSession.list_contents-505"><span class="linenos">505</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.list_contents-506"><a href="#SMBSession.list_contents-506"><span class="linenos">506</span></a>        
</span><span id="SMBSession.list_contents-507"><a href="#SMBSession.list_contents-507"><span class="linenos">507</span></a>        <span class="n">dest_path</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">),]</span>
</span><span id="SMBSession.list_contents-508"><a href="#SMBSession.list_contents-508"><span class="linenos">508</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession.list_contents-509"><a href="#SMBSession.list_contents-509"><span class="linenos">509</span></a>            <span class="n">dest_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>
</span><span id="SMBSession.list_contents-510"><a href="#SMBSession.list_contents-510"><span class="linenos">510</span></a>        <span class="n">dest_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="SMBSession.list_contents-511"><a href="#SMBSession.list_contents-511"><span class="linenos">511</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>
</span><span id="SMBSession.list_contents-512"><a href="#SMBSession.list_contents-512"><span class="linenos">512</span></a>
</span><span id="SMBSession.list_contents-513"><a href="#SMBSession.list_contents-513"><span class="linenos">513</span></a>        <span class="n">contents</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SMBSession.list_contents-514"><a href="#SMBSession.list_contents-514"><span class="linenos">514</span></a>        <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession.list_contents-515"><a href="#SMBSession.list_contents-515"><span class="linenos">515</span></a>            <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.list_contents-516"><a href="#SMBSession.list_contents-516"><span class="linenos">516</span></a>            <span class="n">path</span><span class="o">=</span><span class="n">path</span>
</span><span id="SMBSession.list_contents-517"><a href="#SMBSession.list_contents-517"><span class="linenos">517</span></a>        <span class="p">)</span>
</span><span id="SMBSession.list_contents-518"><a href="#SMBSession.list_contents-518"><span class="linenos">518</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="SMBSession.list_contents-519"><a href="#SMBSession.list_contents-519"><span class="linenos">519</span></a>            <span class="n">contents</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()]</span> <span class="o">=</span> <span class="n">entry</span>
</span><span id="SMBSession.list_contents-520"><a href="#SMBSession.list_contents-520"><span class="linenos">520</span></a>
</span><span id="SMBSession.list_contents-521"><a href="#SMBSession.list_contents-521"><span class="linenos">521</span></a>        <span class="k">return</span> <span class="n">contents</span>
</span></pre></div>


            <div class="docstring"><p>Lists the contents of a specified directory on the SMB share.</p>

<p>This method retrieves the contents of a directory specified by <code>shareName</code> and <code>path</code>. If <code>shareName</code> or <code>path</code>
is not provided, it defaults to the instance's current SMB share or path. The method returns a dictionary with
the long names of the files and directories as keys and their respective SMB entry objects as values.</p>

<p>Args:
    shareName (str, optional): The name of the SMB share. Defaults to the current SMB share if None.
    path (str, optional): The directory path to list contents from. Defaults to the current path if None.</p>

<p>Returns:
    dict: A dictionary with file and directory names as keys and their SMB entry objects as values.</p>
</div>


                            </div>
                            <div id="SMBSession.list_shares" class="classattr">
                                        <input id="SMBSession.list_shares-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_shares</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.list_shares-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.list_shares"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.list_shares-523"><a href="#SMBSession.list_shares-523"><span class="linenos">523</span></a>    <span class="k">def</span> <span class="nf">list_shares</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SMBSession.list_shares-524"><a href="#SMBSession.list_shares-524"><span class="linenos">524</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.list_shares-525"><a href="#SMBSession.list_shares-525"><span class="linenos">525</span></a><span class="sd">        Lists all the shares available on the connected SMB server.</span>
</span><span id="SMBSession.list_shares-526"><a href="#SMBSession.list_shares-526"><span class="linenos">526</span></a>
</span><span id="SMBSession.list_shares-527"><a href="#SMBSession.list_shares-527"><span class="linenos">527</span></a><span class="sd">        This method queries the SMB server to retrieve a list of all available shares. It populates the `shares` dictionary</span>
</span><span id="SMBSession.list_shares-528"><a href="#SMBSession.list_shares-528"><span class="linenos">528</span></a><span class="sd">        with key-value pairs where the key is the share name and the value is a dictionary containing details about the share</span>
</span><span id="SMBSession.list_shares-529"><a href="#SMBSession.list_shares-529"><span class="linenos">529</span></a><span class="sd">        such as its name, type, raw type, and any comments associated with the share.</span>
</span><span id="SMBSession.list_shares-530"><a href="#SMBSession.list_shares-530"><span class="linenos">530</span></a>
</span><span id="SMBSession.list_shares-531"><a href="#SMBSession.list_shares-531"><span class="linenos">531</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession.list_shares-532"><a href="#SMBSession.list_shares-532"><span class="linenos">532</span></a><span class="sd">            dict: A dictionary containing information about each share available on the server.</span>
</span><span id="SMBSession.list_shares-533"><a href="#SMBSession.list_shares-533"><span class="linenos">533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.list_shares-534"><a href="#SMBSession.list_shares-534"><span class="linenos">534</span></a>
</span><span id="SMBSession.list_shares-535"><a href="#SMBSession.list_shares-535"><span class="linenos">535</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SMBSession.list_shares-536"><a href="#SMBSession.list_shares-536"><span class="linenos">536</span></a>
</span><span id="SMBSession.list_shares-537"><a href="#SMBSession.list_shares-537"><span class="linenos">537</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
</span><span id="SMBSession.list_shares-538"><a href="#SMBSession.list_shares-538"><span class="linenos">538</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.list_shares-539"><a href="#SMBSession.list_shares-539"><span class="linenos">539</span></a>                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listShares</span><span class="p">()</span>
</span><span id="SMBSession.list_shares-540"><a href="#SMBSession.list_shares-540"><span class="linenos">540</span></a>
</span><span id="SMBSession.list_shares-541"><a href="#SMBSession.list_shares-541"><span class="linenos">541</span></a>                <span class="k">for</span> <span class="n">share</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="SMBSession.list_shares-542"><a href="#SMBSession.list_shares-542"><span class="linenos">542</span></a>                    <span class="c1"># SHARE_INFO_1 structure (lmshare.h)</span>
</span><span id="SMBSession.list_shares-543"><a href="#SMBSession.list_shares-543"><span class="linenos">543</span></a>                    <span class="c1"># https://learn.microsoft.com/en-us/windows/win32/api/lmshare/ns-lmshare-share_info_1</span>
</span><span id="SMBSession.list_shares-544"><a href="#SMBSession.list_shares-544"><span class="linenos">544</span></a>                    <span class="n">sharename</span> <span class="o">=</span> <span class="n">share</span><span class="p">[</span><span class="s2">&quot;shi1_netname&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SMBSession.list_shares-545"><a href="#SMBSession.list_shares-545"><span class="linenos">545</span></a>                    <span class="n">sharecomment</span> <span class="o">=</span> <span class="n">share</span><span class="p">[</span><span class="s2">&quot;shi1_remark&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SMBSession.list_shares-546"><a href="#SMBSession.list_shares-546"><span class="linenos">546</span></a>                    <span class="n">sharetype</span> <span class="o">=</span> <span class="n">share</span><span class="p">[</span><span class="s2">&quot;shi1_type&quot;</span><span class="p">]</span>
</span><span id="SMBSession.list_shares-547"><a href="#SMBSession.list_shares-547"><span class="linenos">547</span></a>
</span><span id="SMBSession.list_shares-548"><a href="#SMBSession.list_shares-548"><span class="linenos">548</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="p">[</span><span class="n">sharename</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SMBSession.list_shares-549"><a href="#SMBSession.list_shares-549"><span class="linenos">549</span></a>                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">sharename</span><span class="p">,</span> 
</span><span id="SMBSession.list_shares-550"><a href="#SMBSession.list_shares-550"><span class="linenos">550</span></a>                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">STYPE_MASK</span><span class="p">(</span><span class="n">sharetype</span><span class="p">),</span> 
</span><span id="SMBSession.list_shares-551"><a href="#SMBSession.list_shares-551"><span class="linenos">551</span></a>                        <span class="s2">&quot;rawtype&quot;</span><span class="p">:</span> <span class="n">sharetype</span><span class="p">,</span> 
</span><span id="SMBSession.list_shares-552"><a href="#SMBSession.list_shares-552"><span class="linenos">552</span></a>                        <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="n">sharecomment</span>
</span><span id="SMBSession.list_shares-553"><a href="#SMBSession.list_shares-553"><span class="linenos">553</span></a>                    <span class="p">}</span>
</span><span id="SMBSession.list_shares-554"><a href="#SMBSession.list_shares-554"><span class="linenos">554</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.list_shares-555"><a href="#SMBSession.list_shares-555"><span class="linenos">555</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Error: SMBSession.smbClient is None.&quot;</span><span class="p">)</span>
</span><span id="SMBSession.list_shares-556"><a href="#SMBSession.list_shares-556"><span class="linenos">556</span></a>
</span><span id="SMBSession.list_shares-557"><a href="#SMBSession.list_shares-557"><span class="linenos">557</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span>
</span></pre></div>


            <div class="docstring"><p>Lists all the shares available on the connected SMB server.</p>

<p>This method queries the SMB server to retrieve a list of all available shares. It populates the <code>shares</code> dictionary
with key-value pairs where the key is the share name and the value is a dictionary containing details about the share
such as its name, type, raw type, and any comments associated with the share.</p>

<p>Returns:
    dict: A dictionary containing information about each share available on the server.</p>
</div>


                            </div>
                            <div id="SMBSession.mkdir" class="classattr">
                                        <input id="SMBSession.mkdir-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mkdir</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.mkdir-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.mkdir"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.mkdir-559"><a href="#SMBSession.mkdir-559"><span class="linenos">559</span></a>    <span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.mkdir-560"><a href="#SMBSession.mkdir-560"><span class="linenos">560</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.mkdir-561"><a href="#SMBSession.mkdir-561"><span class="linenos">561</span></a><span class="sd">        Creates a directory at the specified path on the SMB share.</span>
</span><span id="SMBSession.mkdir-562"><a href="#SMBSession.mkdir-562"><span class="linenos">562</span></a>
</span><span id="SMBSession.mkdir-563"><a href="#SMBSession.mkdir-563"><span class="linenos">563</span></a><span class="sd">        This method takes a path and attempts to create the directory structure on the SMB share. If the path includes</span>
</span><span id="SMBSession.mkdir-564"><a href="#SMBSession.mkdir-564"><span class="linenos">564</span></a><span class="sd">        nested directories, it will create each directory in the sequence. If a directory already exists, it will skip</span>
</span><span id="SMBSession.mkdir-565"><a href="#SMBSession.mkdir-565"><span class="linenos">565</span></a><span class="sd">        the creation for that directory without raising an error.</span>
</span><span id="SMBSession.mkdir-566"><a href="#SMBSession.mkdir-566"><span class="linenos">566</span></a>
</span><span id="SMBSession.mkdir-567"><a href="#SMBSession.mkdir-567"><span class="linenos">567</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession.mkdir-568"><a href="#SMBSession.mkdir-568"><span class="linenos">568</span></a><span class="sd">            path (str, optional): The full path of the directory to create on the SMB share. Defaults to None.</span>
</span><span id="SMBSession.mkdir-569"><a href="#SMBSession.mkdir-569"><span class="linenos">569</span></a>
</span><span id="SMBSession.mkdir-570"><a href="#SMBSession.mkdir-570"><span class="linenos">570</span></a><span class="sd">        Note:</span>
</span><span id="SMBSession.mkdir-571"><a href="#SMBSession.mkdir-571"><span class="linenos">571</span></a><span class="sd">            The path should use forward slashes (&#39;/&#39;) which will be converted to backslashes (ntpath.sep) for SMB compatibility.</span>
</span><span id="SMBSession.mkdir-572"><a href="#SMBSession.mkdir-572"><span class="linenos">572</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.mkdir-573"><a href="#SMBSession.mkdir-573"><span class="linenos">573</span></a>
</span><span id="SMBSession.mkdir-574"><a href="#SMBSession.mkdir-574"><span class="linenos">574</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.mkdir-575"><a href="#SMBSession.mkdir-575"><span class="linenos">575</span></a>            <span class="c1"># Prepare path</span>
</span><span id="SMBSession.mkdir-576"><a href="#SMBSession.mkdir-576"><span class="linenos">576</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.mkdir-577"><a href="#SMBSession.mkdir-577"><span class="linenos">577</span></a>            <span class="k">if</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="SMBSession.mkdir-578"><a href="#SMBSession.mkdir-578"><span class="linenos">578</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.mkdir-579"><a href="#SMBSession.mkdir-579"><span class="linenos">579</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.mkdir-580"><a href="#SMBSession.mkdir-580"><span class="linenos">580</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
</span><span id="SMBSession.mkdir-581"><a href="#SMBSession.mkdir-581"><span class="linenos">581</span></a>
</span><span id="SMBSession.mkdir-582"><a href="#SMBSession.mkdir-582"><span class="linenos">582</span></a>            <span class="c1"># Create each dir in the path</span>
</span><span id="SMBSession.mkdir-583"><a href="#SMBSession.mkdir-583"><span class="linenos">583</span></a>            <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
</span><span id="SMBSession.mkdir-584"><a href="#SMBSession.mkdir-584"><span class="linenos">584</span></a>                <span class="n">tmp_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="n">depth</span><span class="p">])</span>
</span><span id="SMBSession.mkdir-585"><a href="#SMBSession.mkdir-585"><span class="linenos">585</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.mkdir-586"><a href="#SMBSession.mkdir-586"><span class="linenos">586</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">createDirectory</span><span class="p">(</span>
</span><span id="SMBSession.mkdir-587"><a href="#SMBSession.mkdir-587"><span class="linenos">587</span></a>                        <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.mkdir-588"><a href="#SMBSession.mkdir-588"><span class="linenos">588</span></a>                        <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">tmp_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.mkdir-589"><a href="#SMBSession.mkdir-589"><span class="linenos">589</span></a>                    <span class="p">)</span>
</span><span id="SMBSession.mkdir-590"><a href="#SMBSession.mkdir-590"><span class="linenos">590</span></a>                <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.mkdir-591"><a href="#SMBSession.mkdir-591"><span class="linenos">591</span></a>                    <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0xc0000035</span><span class="p">:</span>
</span><span id="SMBSession.mkdir-592"><a href="#SMBSession.mkdir-592"><span class="linenos">592</span></a>                        <span class="c1"># STATUS_OBJECT_NAME_COLLISION</span>
</span><span id="SMBSession.mkdir-593"><a href="#SMBSession.mkdir-593"><span class="linenos">593</span></a>                        <span class="c1"># Remote directory already created, this is normal</span>
</span><span id="SMBSession.mkdir-594"><a href="#SMBSession.mkdir-594"><span class="linenos">594</span></a>                        <span class="c1"># Src: https://github.com/fortra/impacket/blob/269ce69872f0e8f2188a80addb0c39fedfa6dcb8/impacket/nt_errors.py#L268C9-L268C19</span>
</span><span id="SMBSession.mkdir-595"><a href="#SMBSession.mkdir-595"><span class="linenos">595</span></a>                        <span class="k">pass</span>
</span><span id="SMBSession.mkdir-596"><a href="#SMBSession.mkdir-596"><span class="linenos">596</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.mkdir-597"><a href="#SMBSession.mkdir-597"><span class="linenos">597</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to create directory &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession.mkdir-598"><a href="#SMBSession.mkdir-598"><span class="linenos">598</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.mkdir-599"><a href="#SMBSession.mkdir-599"><span class="linenos">599</span></a>                            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="SMBSession.mkdir-600"><a href="#SMBSession.mkdir-600"><span class="linenos">600</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.mkdir-601"><a href="#SMBSession.mkdir-601"><span class="linenos">601</span></a>            <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Creates a directory at the specified path on the SMB share.</p>

<p>This method takes a path and attempts to create the directory structure on the SMB share. If the path includes
nested directories, it will create each directory in the sequence. If a directory already exists, it will skip
the creation for that directory without raising an error.</p>

<p>Args:
    path (str, optional): The full path of the directory to create on the SMB share. Defaults to None.</p>

<p>Note:
    The path should use forward slashes ('/') which will be converted to backslashes (ntpath.sep) for SMB compatibility.</p>
</div>


                            </div>
                            <div id="SMBSession.mount" class="classattr">
                                        <input id="SMBSession.mount-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mount</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">local_mount_point</span>, </span><span class="param"><span class="n">remote_path</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.mount-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.mount"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.mount-603"><a href="#SMBSession.mount-603"><span class="linenos">603</span></a>    <span class="k">def</span> <span class="nf">mount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_mount_point</span><span class="p">,</span> <span class="n">remote_path</span><span class="p">):</span>
</span><span id="SMBSession.mount-604"><a href="#SMBSession.mount-604"><span class="linenos">604</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.mount-605"><a href="#SMBSession.mount-605"><span class="linenos">605</span></a><span class="sd">        Generates the command to mount an SMB share on different platforms.</span>
</span><span id="SMBSession.mount-606"><a href="#SMBSession.mount-606"><span class="linenos">606</span></a>
</span><span id="SMBSession.mount-607"><a href="#SMBSession.mount-607"><span class="linenos">607</span></a><span class="sd">        This method takes the local mount point and the remote path of the SMB share and generates the appropriate mount command based on the platform.</span>
</span><span id="SMBSession.mount-608"><a href="#SMBSession.mount-608"><span class="linenos">608</span></a><span class="sd">        It constructs the mount command using the provided parameters and executes it using the os.system() function.</span>
</span><span id="SMBSession.mount-609"><a href="#SMBSession.mount-609"><span class="linenos">609</span></a>
</span><span id="SMBSession.mount-610"><a href="#SMBSession.mount-610"><span class="linenos">610</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession.mount-611"><a href="#SMBSession.mount-611"><span class="linenos">611</span></a><span class="sd">            local_mount_point (str): The local directory where the SMB share will be mounted.</span>
</span><span id="SMBSession.mount-612"><a href="#SMBSession.mount-612"><span class="linenos">612</span></a><span class="sd">            remote_path (str): The remote path on the SMB share to be mounted.</span>
</span><span id="SMBSession.mount-613"><a href="#SMBSession.mount-613"><span class="linenos">613</span></a>
</span><span id="SMBSession.mount-614"><a href="#SMBSession.mount-614"><span class="linenos">614</span></a><span class="sd">        Note:</span>
</span><span id="SMBSession.mount-615"><a href="#SMBSession.mount-615"><span class="linenos">615</span></a><span class="sd">            - For Windows platform, the command uses &#39;net use&#39; to mount the share.</span>
</span><span id="SMBSession.mount-616"><a href="#SMBSession.mount-616"><span class="linenos">616</span></a><span class="sd">            - For Linux platform, the command uses &#39;mount&#39; to mount the share.</span>
</span><span id="SMBSession.mount-617"><a href="#SMBSession.mount-617"><span class="linenos">617</span></a><span class="sd">            - For macOS platform, the command uses &#39;mount_smbfs&#39; to mount the share.</span>
</span><span id="SMBSession.mount-618"><a href="#SMBSession.mount-618"><span class="linenos">618</span></a><span class="sd">            - If the platform is not supported, an error message is displayed.</span>
</span><span id="SMBSession.mount-619"><a href="#SMBSession.mount-619"><span class="linenos">619</span></a>
</span><span id="SMBSession.mount-620"><a href="#SMBSession.mount-620"><span class="linenos">620</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession.mount-621"><a href="#SMBSession.mount-621"><span class="linenos">621</span></a><span class="sd">            None</span>
</span><span id="SMBSession.mount-622"><a href="#SMBSession.mount-622"><span class="linenos">622</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.mount-623"><a href="#SMBSession.mount-623"><span class="linenos">623</span></a>
</span><span id="SMBSession.mount-624"><a href="#SMBSession.mount-624"><span class="linenos">624</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_mount_point</span><span class="p">):</span>
</span><span id="SMBSession.mount-625"><a href="#SMBSession.mount-625"><span class="linenos">625</span></a>            <span class="k">pass</span>
</span><span id="SMBSession.mount-626"><a href="#SMBSession.mount-626"><span class="linenos">626</span></a>
</span><span id="SMBSession.mount-627"><a href="#SMBSession.mount-627"><span class="linenos">627</span></a>        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>
</span><span id="SMBSession.mount-628"><a href="#SMBSession.mount-628"><span class="linenos">628</span></a>            <span class="n">remote_path</span> <span class="o">=</span> <span class="n">remote_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.mount-629"><a href="#SMBSession.mount-629"><span class="linenos">629</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;net use </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2"> </span><span class="se">\\\\</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="se">\\</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="si">}</span><span class="se">\\</span><span class="si">{</span><span class="n">remote_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SMBSession.mount-630"><a href="#SMBSession.mount-630"><span class="linenos">630</span></a>        
</span><span id="SMBSession.mount-631"><a href="#SMBSession.mount-631"><span class="linenos">631</span></a>        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">):</span>
</span><span id="SMBSession.mount-632"><a href="#SMBSession.mount-632"><span class="linenos">632</span></a>            <span class="n">remote_path</span> <span class="o">=</span> <span class="n">remote_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="SMBSession.mount-633"><a href="#SMBSession.mount-633"><span class="linenos">633</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mount -t cifs //</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">remote_path</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2"> -o username=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">,password=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SMBSession.mount-634"><a href="#SMBSession.mount-634"><span class="linenos">634</span></a>        
</span><span id="SMBSession.mount-635"><a href="#SMBSession.mount-635"><span class="linenos">635</span></a>        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;darwin&#39;</span><span class="p">):</span>
</span><span id="SMBSession.mount-636"><a href="#SMBSession.mount-636"><span class="linenos">636</span></a>            <span class="n">remote_path</span> <span class="o">=</span> <span class="n">remote_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="SMBSession.mount-637"><a href="#SMBSession.mount-637"><span class="linenos">637</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mount_smbfs //</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">remote_path</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SMBSession.mount-638"><a href="#SMBSession.mount-638"><span class="linenos">638</span></a>        
</span><span id="SMBSession.mount-639"><a href="#SMBSession.mount-639"><span class="linenos">639</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.mount-640"><a href="#SMBSession.mount-640"><span class="linenos">640</span></a>            <span class="n">command</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SMBSession.mount-641"><a href="#SMBSession.mount-641"><span class="linenos">641</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Unsupported platform for mounting SMB share.&quot;</span><span class="p">)</span>
</span><span id="SMBSession.mount-642"><a href="#SMBSession.mount-642"><span class="linenos">642</span></a>        
</span><span id="SMBSession.mount-643"><a href="#SMBSession.mount-643"><span class="linenos">643</span></a>        <span class="k">if</span> <span class="n">command</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.mount-644"><a href="#SMBSession.mount-644"><span class="linenos">644</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.mount-645"><a href="#SMBSession.mount-645"><span class="linenos">645</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] Executing: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">command</span><span class="p">)</span>
</span><span id="SMBSession.mount-646"><a href="#SMBSession.mount-646"><span class="linenos">646</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generates the command to mount an SMB share on different platforms.</p>

<p>This method takes the local mount point and the remote path of the SMB share and generates the appropriate mount command based on the platform.
It constructs the mount command using the provided parameters and executes it using the os.system() function.</p>

<p>Args:
    local_mount_point (str): The local directory where the SMB share will be mounted.
    remote_path (str): The remote path on the SMB share to be mounted.</p>

<p>Note:
    - For Windows platform, the command uses 'net use' to mount the share.
    - For Linux platform, the command uses 'mount' to mount the share.
    - For macOS platform, the command uses 'mount_smbfs' to mount the share.
    - If the platform is not supported, an error message is displayed.</p>

<p>Returns:
    None</p>
</div>


                            </div>
                            <div id="SMBSession.path_exists" class="classattr">
                                        <input id="SMBSession.path_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">path_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.path_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.path_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.path_exists-648"><a href="#SMBSession.path_exists-648"><span class="linenos">648</span></a>    <span class="k">def</span> <span class="nf">path_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.path_exists-649"><a href="#SMBSession.path_exists-649"><span class="linenos">649</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.path_exists-650"><a href="#SMBSession.path_exists-650"><span class="linenos">650</span></a><span class="sd">        Checks if the specified path exists on the SMB share.</span>
</span><span id="SMBSession.path_exists-651"><a href="#SMBSession.path_exists-651"><span class="linenos">651</span></a>
</span><span id="SMBSession.path_exists-652"><a href="#SMBSession.path_exists-652"><span class="linenos">652</span></a><span class="sd">        This method determines if a given path exists on the SMB share by attempting to list the contents of the path.</span>
</span><span id="SMBSession.path_exists-653"><a href="#SMBSession.path_exists-653"><span class="linenos">653</span></a><span class="sd">        If the path listing is successful and returns one or more entries, the path is considered to exist.</span>
</span><span id="SMBSession.path_exists-654"><a href="#SMBSession.path_exists-654"><span class="linenos">654</span></a>
</span><span id="SMBSession.path_exists-655"><a href="#SMBSession.path_exists-655"><span class="linenos">655</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession.path_exists-656"><a href="#SMBSession.path_exists-656"><span class="linenos">656</span></a><span class="sd">            path (str, optional): The path to check on the SMB share. Defaults to None.</span>
</span><span id="SMBSession.path_exists-657"><a href="#SMBSession.path_exists-657"><span class="linenos">657</span></a>
</span><span id="SMBSession.path_exists-658"><a href="#SMBSession.path_exists-658"><span class="linenos">658</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession.path_exists-659"><a href="#SMBSession.path_exists-659"><span class="linenos">659</span></a><span class="sd">            bool: True if the path exists, False otherwise or if an error occurs.</span>
</span><span id="SMBSession.path_exists-660"><a href="#SMBSession.path_exists-660"><span class="linenos">660</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.path_exists-661"><a href="#SMBSession.path_exists-661"><span class="linenos">661</span></a>
</span><span id="SMBSession.path_exists-662"><a href="#SMBSession.path_exists-662"><span class="linenos">662</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.path_exists-663"><a href="#SMBSession.path_exists-663"><span class="linenos">663</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="SMBSession.path_exists-664"><a href="#SMBSession.path_exists-664"><span class="linenos">664</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.path_exists-665"><a href="#SMBSession.path_exists-665"><span class="linenos">665</span></a>                <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession.path_exists-666"><a href="#SMBSession.path_exists-666"><span class="linenos">666</span></a>                    <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span>
</span><span id="SMBSession.path_exists-667"><a href="#SMBSession.path_exists-667"><span class="linenos">667</span></a>                    <span class="n">path</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.path_exists-668"><a href="#SMBSession.path_exists-668"><span class="linenos">668</span></a>                <span class="p">)</span>
</span><span id="SMBSession.path_exists-669"><a href="#SMBSession.path_exists-669"><span class="linenos">669</span></a>                <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SMBSession.path_exists-670"><a href="#SMBSession.path_exists-670"><span class="linenos">670</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession.path_exists-671"><a href="#SMBSession.path_exists-671"><span class="linenos">671</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="SMBSession.path_exists-672"><a href="#SMBSession.path_exists-672"><span class="linenos">672</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.path_exists-673"><a href="#SMBSession.path_exists-673"><span class="linenos">673</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Checks if the specified path exists on the SMB share.</p>

<p>This method determines if a given path exists on the SMB share by attempting to list the contents of the path.
If the path listing is successful and returns one or more entries, the path is considered to exist.</p>

<p>Args:
    path (str, optional): The path to check on the SMB share. Defaults to None.</p>

<p>Returns:
    bool: True if the path exists, False otherwise or if an error occurs.</p>
</div>


                            </div>
                            <div id="SMBSession.path_isdir" class="classattr">
                                        <input id="SMBSession.path_isdir-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">path_isdir</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">pathFromRoot</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.path_isdir-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.path_isdir"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.path_isdir-675"><a href="#SMBSession.path_isdir-675"><span class="linenos">675</span></a>    <span class="k">def</span> <span class="nf">path_isdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathFromRoot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.path_isdir-676"><a href="#SMBSession.path_isdir-676"><span class="linenos">676</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.path_isdir-677"><a href="#SMBSession.path_isdir-677"><span class="linenos">677</span></a><span class="sd">        Checks if the specified path is a directory on the SMB share.</span>
</span><span id="SMBSession.path_isdir-678"><a href="#SMBSession.path_isdir-678"><span class="linenos">678</span></a>
</span><span id="SMBSession.path_isdir-679"><a href="#SMBSession.path_isdir-679"><span class="linenos">679</span></a><span class="sd">        This method determines if a given path corresponds to a directory on the SMB share. It does this by listing the</span>
</span><span id="SMBSession.path_isdir-680"><a href="#SMBSession.path_isdir-680"><span class="linenos">680</span></a><span class="sd">        contents of the path and filtering for entries that match the basename of the path and are marked as directories.</span>
</span><span id="SMBSession.path_isdir-681"><a href="#SMBSession.path_isdir-681"><span class="linenos">681</span></a>
</span><span id="SMBSession.path_isdir-682"><a href="#SMBSession.path_isdir-682"><span class="linenos">682</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession.path_isdir-683"><a href="#SMBSession.path_isdir-683"><span class="linenos">683</span></a><span class="sd">            path (str, optional): The path to check on the SMB share. Defaults to None.</span>
</span><span id="SMBSession.path_isdir-684"><a href="#SMBSession.path_isdir-684"><span class="linenos">684</span></a>
</span><span id="SMBSession.path_isdir-685"><a href="#SMBSession.path_isdir-685"><span class="linenos">685</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession.path_isdir-686"><a href="#SMBSession.path_isdir-686"><span class="linenos">686</span></a><span class="sd">            bool: True if the path is a directory, False otherwise or if an error occurs.</span>
</span><span id="SMBSession.path_isdir-687"><a href="#SMBSession.path_isdir-687"><span class="linenos">687</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.path_isdir-688"><a href="#SMBSession.path_isdir-688"><span class="linenos">688</span></a>
</span><span id="SMBSession.path_isdir-689"><a href="#SMBSession.path_isdir-689"><span class="linenos">689</span></a>        <span class="k">if</span> <span class="n">pathFromRoot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.path_isdir-690"><a href="#SMBSession.path_isdir-690"><span class="linenos">690</span></a>            <span class="c1"># Replace slashes if any</span>
</span><span id="SMBSession.path_isdir-691"><a href="#SMBSession.path_isdir-691"><span class="linenos">691</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">pathFromRoot</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.path_isdir-692"><a href="#SMBSession.path_isdir-692"><span class="linenos">692</span></a>            
</span><span id="SMBSession.path_isdir-693"><a href="#SMBSession.path_isdir-693"><span class="linenos">693</span></a>            <span class="c1"># Strip wildcards to avoid injections</span>
</span><span id="SMBSession.path_isdir-694"><a href="#SMBSession.path_isdir-694"><span class="linenos">694</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="SMBSession.path_isdir-695"><a href="#SMBSession.path_isdir-695"><span class="linenos">695</span></a>
</span><span id="SMBSession.path_isdir-696"><a href="#SMBSession.path_isdir-696"><span class="linenos">696</span></a>            <span class="c1"># Normalize path and strip leading backslash</span>
</span><span id="SMBSession.path_isdir-697"><a href="#SMBSession.path_isdir-697"><span class="linenos">697</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.path_isdir-698"><a href="#SMBSession.path_isdir-698"><span class="linenos">698</span></a>
</span><span id="SMBSession.path_isdir-699"><a href="#SMBSession.path_isdir-699"><span class="linenos">699</span></a>            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">]:</span>
</span><span id="SMBSession.path_isdir-700"><a href="#SMBSession.path_isdir-700"><span class="linenos">700</span></a>                <span class="c1"># By defininition they exist on the filesystem</span>
</span><span id="SMBSession.path_isdir-701"><a href="#SMBSession.path_isdir-701"><span class="linenos">701</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="SMBSession.path_isdir-702"><a href="#SMBSession.path_isdir-702"><span class="linenos">702</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.path_isdir-703"><a href="#SMBSession.path_isdir-703"><span class="linenos">703</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.path_isdir-704"><a href="#SMBSession.path_isdir-704"><span class="linenos">704</span></a>                    <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession.path_isdir-705"><a href="#SMBSession.path_isdir-705"><span class="linenos">705</span></a>                        <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span>
</span><span id="SMBSession.path_isdir-706"><a href="#SMBSession.path_isdir-706"><span class="linenos">706</span></a>                        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;*&#39;</span>
</span><span id="SMBSession.path_isdir-707"><a href="#SMBSession.path_isdir-707"><span class="linenos">707</span></a>                    <span class="p">)</span>
</span><span id="SMBSession.path_isdir-708"><a href="#SMBSession.path_isdir-708"><span class="linenos">708</span></a>                    <span class="c1"># Filter on directories</span>
</span><span id="SMBSession.path_isdir-709"><a href="#SMBSession.path_isdir-709"><span class="linenos">709</span></a>                    <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SMBSession.path_isdir-710"><a href="#SMBSession.path_isdir-710"><span class="linenos">710</span></a>                        <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span>
</span><span id="SMBSession.path_isdir-711"><a href="#SMBSession.path_isdir-711"><span class="linenos">711</span></a>                        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">==</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">is_directory</span><span class="p">()</span>
</span><span id="SMBSession.path_isdir-712"><a href="#SMBSession.path_isdir-712"><span class="linenos">712</span></a>                    <span class="p">]</span>
</span><span id="SMBSession.path_isdir-713"><a href="#SMBSession.path_isdir-713"><span class="linenos">713</span></a>                    <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SMBSession.path_isdir-714"><a href="#SMBSession.path_isdir-714"><span class="linenos">714</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession.path_isdir-715"><a href="#SMBSession.path_isdir-715"><span class="linenos">715</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="SMBSession.path_isdir-716"><a href="#SMBSession.path_isdir-716"><span class="linenos">716</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.path_isdir-717"><a href="#SMBSession.path_isdir-717"><span class="linenos">717</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Checks if the specified path is a directory on the SMB share.</p>

<p>This method determines if a given path corresponds to a directory on the SMB share. It does this by listing the
contents of the path and filtering for entries that match the basename of the path and are marked as directories.</p>

<p>Args:
    path (str, optional): The path to check on the SMB share. Defaults to None.</p>

<p>Returns:
    bool: True if the path is a directory, False otherwise or if an error occurs.</p>
</div>


                            </div>
                            <div id="SMBSession.path_isfile" class="classattr">
                                        <input id="SMBSession.path_isfile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">path_isfile</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.path_isfile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.path_isfile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.path_isfile-719"><a href="#SMBSession.path_isfile-719"><span class="linenos">719</span></a>    <span class="k">def</span> <span class="nf">path_isfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.path_isfile-720"><a href="#SMBSession.path_isfile-720"><span class="linenos">720</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.path_isfile-721"><a href="#SMBSession.path_isfile-721"><span class="linenos">721</span></a><span class="sd">        Checks if the specified path is a file on the SMB share.</span>
</span><span id="SMBSession.path_isfile-722"><a href="#SMBSession.path_isfile-722"><span class="linenos">722</span></a>
</span><span id="SMBSession.path_isfile-723"><a href="#SMBSession.path_isfile-723"><span class="linenos">723</span></a><span class="sd">        This method determines if a given path corresponds to a file on the SMB share. It does this by listing the</span>
</span><span id="SMBSession.path_isfile-724"><a href="#SMBSession.path_isfile-724"><span class="linenos">724</span></a><span class="sd">        contents of the path and filtering for entries that match the basename of the path and are not marked as directories.</span>
</span><span id="SMBSession.path_isfile-725"><a href="#SMBSession.path_isfile-725"><span class="linenos">725</span></a>
</span><span id="SMBSession.path_isfile-726"><a href="#SMBSession.path_isfile-726"><span class="linenos">726</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession.path_isfile-727"><a href="#SMBSession.path_isfile-727"><span class="linenos">727</span></a><span class="sd">            path (str, optional): The path to check on the SMB share. Defaults to None.</span>
</span><span id="SMBSession.path_isfile-728"><a href="#SMBSession.path_isfile-728"><span class="linenos">728</span></a>
</span><span id="SMBSession.path_isfile-729"><a href="#SMBSession.path_isfile-729"><span class="linenos">729</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession.path_isfile-730"><a href="#SMBSession.path_isfile-730"><span class="linenos">730</span></a><span class="sd">            bool: True if the path is a file, False otherwise or if an error occurs.</span>
</span><span id="SMBSession.path_isfile-731"><a href="#SMBSession.path_isfile-731"><span class="linenos">731</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.path_isfile-732"><a href="#SMBSession.path_isfile-732"><span class="linenos">732</span></a>
</span><span id="SMBSession.path_isfile-733"><a href="#SMBSession.path_isfile-733"><span class="linenos">733</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.path_isfile-734"><a href="#SMBSession.path_isfile-734"><span class="linenos">734</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="SMBSession.path_isfile-735"><a href="#SMBSession.path_isfile-735"><span class="linenos">735</span></a>            <span class="n">search_dir</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession.path_isfile-736"><a href="#SMBSession.path_isfile-736"><span class="linenos">736</span></a>            <span class="n">search_dir</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">search_dir</span><span class="p">)</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span>
</span><span id="SMBSession.path_isfile-737"><a href="#SMBSession.path_isfile-737"><span class="linenos">737</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.path_isfile-738"><a href="#SMBSession.path_isfile-738"><span class="linenos">738</span></a>                <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession.path_isfile-739"><a href="#SMBSession.path_isfile-739"><span class="linenos">739</span></a>                    <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span>
</span><span id="SMBSession.path_isfile-740"><a href="#SMBSession.path_isfile-740"><span class="linenos">740</span></a>                    <span class="n">path</span><span class="o">=</span><span class="n">search_dir</span>
</span><span id="SMBSession.path_isfile-741"><a href="#SMBSession.path_isfile-741"><span class="linenos">741</span></a>                <span class="p">)</span>
</span><span id="SMBSession.path_isfile-742"><a href="#SMBSession.path_isfile-742"><span class="linenos">742</span></a>                <span class="c1"># Filter on files</span>
</span><span id="SMBSession.path_isfile-743"><a href="#SMBSession.path_isfile-743"><span class="linenos">743</span></a>                <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SMBSession.path_isfile-744"><a href="#SMBSession.path_isfile-744"><span class="linenos">744</span></a>                    <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span>
</span><span id="SMBSession.path_isfile-745"><a href="#SMBSession.path_isfile-745"><span class="linenos">745</span></a>                    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">==</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">is_directory</span><span class="p">()</span>
</span><span id="SMBSession.path_isfile-746"><a href="#SMBSession.path_isfile-746"><span class="linenos">746</span></a>                <span class="p">]</span>
</span><span id="SMBSession.path_isfile-747"><a href="#SMBSession.path_isfile-747"><span class="linenos">747</span></a>                <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SMBSession.path_isfile-748"><a href="#SMBSession.path_isfile-748"><span class="linenos">748</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession.path_isfile-749"><a href="#SMBSession.path_isfile-749"><span class="linenos">749</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="SMBSession.path_isfile-750"><a href="#SMBSession.path_isfile-750"><span class="linenos">750</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.path_isfile-751"><a href="#SMBSession.path_isfile-751"><span class="linenos">751</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Checks if the specified path is a file on the SMB share.</p>

<p>This method determines if a given path corresponds to a file on the SMB share. It does this by listing the
contents of the path and filtering for entries that match the basename of the path and are not marked as directories.</p>

<p>Args:
    path (str, optional): The path to check on the SMB share. Defaults to None.</p>

<p>Returns:
    bool: True if the path is a file, False otherwise or if an error occurs.</p>
</div>


                            </div>
                            <div id="SMBSession.ping_smb_session" class="classattr">
                                        <input id="SMBSession.ping_smb_session-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ping_smb_session</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.ping_smb_session-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.ping_smb_session"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.ping_smb_session-753"><a href="#SMBSession.ping_smb_session-753"><span class="linenos">753</span></a>    <span class="k">def</span> <span class="nf">ping_smb_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SMBSession.ping_smb_session-754"><a href="#SMBSession.ping_smb_session-754"><span class="linenos">754</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.ping_smb_session-755"><a href="#SMBSession.ping_smb_session-755"><span class="linenos">755</span></a><span class="sd">        Tests the connectivity to the SMB server by sending an echo command.</span>
</span><span id="SMBSession.ping_smb_session-756"><a href="#SMBSession.ping_smb_session-756"><span class="linenos">756</span></a>
</span><span id="SMBSession.ping_smb_session-757"><a href="#SMBSession.ping_smb_session-757"><span class="linenos">757</span></a><span class="sd">        This method attempts to send an echo command to the SMB server to check if the session is still active.</span>
</span><span id="SMBSession.ping_smb_session-758"><a href="#SMBSession.ping_smb_session-758"><span class="linenos">758</span></a><span class="sd">        It updates the `connected` attribute of the class based on the success or failure of the echo command.</span>
</span><span id="SMBSession.ping_smb_session-759"><a href="#SMBSession.ping_smb_session-759"><span class="linenos">759</span></a>
</span><span id="SMBSession.ping_smb_session-760"><a href="#SMBSession.ping_smb_session-760"><span class="linenos">760</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession.ping_smb_session-761"><a href="#SMBSession.ping_smb_session-761"><span class="linenos">761</span></a><span class="sd">            bool: True if the echo command succeeds (indicating the session is active), False otherwise.</span>
</span><span id="SMBSession.ping_smb_session-762"><a href="#SMBSession.ping_smb_session-762"><span class="linenos">762</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.ping_smb_session-763"><a href="#SMBSession.ping_smb_session-763"><span class="linenos">763</span></a>
</span><span id="SMBSession.ping_smb_session-764"><a href="#SMBSession.ping_smb_session-764"><span class="linenos">764</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.ping_smb_session-765"><a href="#SMBSession.ping_smb_session-765"><span class="linenos">765</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">getSMBServer</span><span class="p">()</span><span class="o">.</span><span class="n">echo</span><span class="p">()</span>
</span><span id="SMBSession.ping_smb_session-766"><a href="#SMBSession.ping_smb_session-766"><span class="linenos">766</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession.ping_smb_session-767"><a href="#SMBSession.ping_smb_session-767"><span class="linenos">767</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession.ping_smb_session-768"><a href="#SMBSession.ping_smb_session-768"><span class="linenos">768</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span>
</span></pre></div>


            <div class="docstring"><p>Tests the connectivity to the SMB server by sending an echo command.</p>

<p>This method attempts to send an echo command to the SMB server to check if the session is still active.
It updates the <code><a href="#SMBSession.connected">connected</a></code> attribute of the class based on the success or failure of the echo command.</p>

<p>Returns:
    bool: True if the echo command succeeds (indicating the session is active), False otherwise.</p>
</div>


                            </div>
                            <div id="SMBSession.put_file" class="classattr">
                                        <input id="SMBSession.put_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">put_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">localpath</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.put_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.put_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.put_file-770"><a href="#SMBSession.put_file-770"><span class="linenos">770</span></a>    <span class="k">def</span> <span class="nf">put_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.put_file-771"><a href="#SMBSession.put_file-771"><span class="linenos">771</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.put_file-772"><a href="#SMBSession.put_file-772"><span class="linenos">772</span></a><span class="sd">        Uploads a single file to the SMB share.</span>
</span><span id="SMBSession.put_file-773"><a href="#SMBSession.put_file-773"><span class="linenos">773</span></a>
</span><span id="SMBSession.put_file-774"><a href="#SMBSession.put_file-774"><span class="linenos">774</span></a><span class="sd">        This method takes a local file path, opens the file, and uploads it to the SMB share at the specified path.</span>
</span><span id="SMBSession.put_file-775"><a href="#SMBSession.put_file-775"><span class="linenos">775</span></a><span class="sd">        It handles exceptions such as broken pipe errors or keyboard interrupts by closing and reinitializing the SMB session.</span>
</span><span id="SMBSession.put_file-776"><a href="#SMBSession.put_file-776"><span class="linenos">776</span></a><span class="sd">        General exceptions are caught and logged, with a traceback provided if debugging is enabled.</span>
</span><span id="SMBSession.put_file-777"><a href="#SMBSession.put_file-777"><span class="linenos">777</span></a>
</span><span id="SMBSession.put_file-778"><a href="#SMBSession.put_file-778"><span class="linenos">778</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession.put_file-779"><a href="#SMBSession.put_file-779"><span class="linenos">779</span></a><span class="sd">            localpath (str, optional): The local file path of the file to be uploaded. Defaults to None.</span>
</span><span id="SMBSession.put_file-780"><a href="#SMBSession.put_file-780"><span class="linenos">780</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.put_file-781"><a href="#SMBSession.put_file-781"><span class="linenos">781</span></a>
</span><span id="SMBSession.put_file-782"><a href="#SMBSession.put_file-782"><span class="linenos">782</span></a>        <span class="c1"># Parse path</span>
</span><span id="SMBSession.put_file-783"><a href="#SMBSession.put_file-783"><span class="linenos">783</span></a>        <span class="n">localpath</span> <span class="o">=</span> <span class="n">localpath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.put_file-784"><a href="#SMBSession.put_file-784"><span class="linenos">784</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">localpath</span><span class="p">:</span>
</span><span id="SMBSession.put_file-785"><a href="#SMBSession.put_file-785"><span class="linenos">785</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">localpath</span><span class="p">))</span>
</span><span id="SMBSession.put_file-786"><a href="#SMBSession.put_file-786"><span class="linenos">786</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.put_file-787"><a href="#SMBSession.put_file-787"><span class="linenos">787</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.put_file-788"><a href="#SMBSession.put_file-788"><span class="linenos">788</span></a>        <span class="c1"># Parse filename</span>
</span><span id="SMBSession.put_file-789"><a href="#SMBSession.put_file-789"><span class="linenos">789</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">localpath</span><span class="p">)</span>
</span><span id="SMBSession.put_file-790"><a href="#SMBSession.put_file-790"><span class="linenos">790</span></a>
</span><span id="SMBSession.put_file-791"><a href="#SMBSession.put_file-791"><span class="linenos">791</span></a>        <span class="c1"># Search for the file</span>
</span><span id="SMBSession.put_file-792"><a href="#SMBSession.put_file-792"><span class="linenos">792</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">tmp_search_path</span><span class="p">)</span>
</span><span id="SMBSession.put_file-793"><a href="#SMBSession.put_file-793"><span class="linenos">793</span></a>        <span class="c1"># Filter the entries</span>
</span><span id="SMBSession.put_file-794"><a href="#SMBSession.put_file-794"><span class="linenos">794</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SMBSession.put_file-795"><a href="#SMBSession.put_file-795"><span class="linenos">795</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="SMBSession.put_file-796"><a href="#SMBSession.put_file-796"><span class="linenos">796</span></a>            <span class="k">if</span> <span class="n">entry</span> <span class="o">==</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SMBSession.put_file-797"><a href="#SMBSession.put_file-797"><span class="linenos">797</span></a>                <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="SMBSession.put_file-798"><a href="#SMBSession.put_file-798"><span class="linenos">798</span></a>            <span class="k">elif</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SMBSession.put_file-799"><a href="#SMBSession.put_file-799"><span class="linenos">799</span></a>                <span class="n">regexp</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;.*&#39;</span><span class="p">)</span>
</span><span id="SMBSession.put_file-800"><a href="#SMBSession.put_file-800"><span class="linenos">800</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
</span><span id="SMBSession.put_file-801"><a href="#SMBSession.put_file-801"><span class="linenos">801</span></a>                    <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="SMBSession.put_file-802"><a href="#SMBSession.put_file-802"><span class="linenos">802</span></a>
</span><span id="SMBSession.put_file-803"><a href="#SMBSession.put_file-803"><span class="linenos">803</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">matching_entries</span><span class="p">)))</span>
</span><span id="SMBSession.put_file-804"><a href="#SMBSession.put_file-804"><span class="linenos">804</span></a>
</span><span id="SMBSession.put_file-805"><a href="#SMBSession.put_file-805"><span class="linenos">805</span></a>        <span class="c1"># Loop and upload</span>
</span><span id="SMBSession.put_file-806"><a href="#SMBSession.put_file-806"><span class="linenos">806</span></a>        <span class="k">for</span> <span class="n">localpath</span> <span class="ow">in</span> <span class="n">matching_entries</span><span class="p">:</span>
</span><span id="SMBSession.put_file-807"><a href="#SMBSession.put_file-807"><span class="linenos">807</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="SMBSession.put_file-808"><a href="#SMBSession.put_file-808"><span class="linenos">808</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="SMBSession.put_file-809"><a href="#SMBSession.put_file-809"><span class="linenos">809</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.put_file-810"><a href="#SMBSession.put_file-810"><span class="linenos">810</span></a>                        <span class="n">localfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">localpath</span><span class="p">)</span>
</span><span id="SMBSession.put_file-811"><a href="#SMBSession.put_file-811"><span class="linenos">811</span></a>                        <span class="n">f</span> <span class="o">=</span> <span class="n">LocalFileIO</span><span class="p">(</span>
</span><span id="SMBSession.put_file-812"><a href="#SMBSession.put_file-812"><span class="linenos">812</span></a>                            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">,</span> 
</span><span id="SMBSession.put_file-813"><a href="#SMBSession.put_file-813"><span class="linenos">813</span></a>                            <span class="n">path</span><span class="o">=</span><span class="n">localpath</span><span class="p">,</span> 
</span><span id="SMBSession.put_file-814"><a href="#SMBSession.put_file-814"><span class="linenos">814</span></a>                            <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span>
</span><span id="SMBSession.put_file-815"><a href="#SMBSession.put_file-815"><span class="linenos">815</span></a>                        <span class="p">)</span>
</span><span id="SMBSession.put_file-816"><a href="#SMBSession.put_file-816"><span class="linenos">816</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">putFile</span><span class="p">(</span>
</span><span id="SMBSession.put_file-817"><a href="#SMBSession.put_file-817"><span class="linenos">817</span></a>                            <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.put_file-818"><a href="#SMBSession.put_file-818"><span class="linenos">818</span></a>                            <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">localfile</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">),</span> 
</span><span id="SMBSession.put_file-819"><a href="#SMBSession.put_file-819"><span class="linenos">819</span></a>                            <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span>
</span><span id="SMBSession.put_file-820"><a href="#SMBSession.put_file-820"><span class="linenos">820</span></a>                        <span class="p">)</span>
</span><span id="SMBSession.put_file-821"><a href="#SMBSession.put_file-821"><span class="linenos">821</span></a>                        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession.put_file-822"><a href="#SMBSession.put_file-822"><span class="linenos">822</span></a>                    <span class="k">except</span> <span class="p">(</span><span class="ne">BrokenPipeError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.put_file-823"><a href="#SMBSession.put_file-823"><span class="linenos">823</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Interrupted.&quot;</span><span class="p">)</span>
</span><span id="SMBSession.put_file-824"><a href="#SMBSession.put_file-824"><span class="linenos">824</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">close_smb_session</span><span class="p">()</span>
</span><span id="SMBSession.put_file-825"><a href="#SMBSession.put_file-825"><span class="linenos">825</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">init_smb_session</span><span class="p">()</span>
</span><span id="SMBSession.put_file-826"><a href="#SMBSession.put_file-826"><span class="linenos">826</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.put_file-827"><a href="#SMBSession.put_file-827"><span class="linenos">827</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to upload &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">localfile</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession.put_file-828"><a href="#SMBSession.put_file-828"><span class="linenos">828</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.put_file-829"><a href="#SMBSession.put_file-829"><span class="linenos">829</span></a>                            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="SMBSession.put_file-830"><a href="#SMBSession.put_file-830"><span class="linenos">830</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.put_file-831"><a href="#SMBSession.put_file-831"><span class="linenos">831</span></a>                    <span class="c1"># [!] The specified localpath is a directory. Use &#39;put -r &lt;directory&gt;&#39; instead.</span>
</span><span id="SMBSession.put_file-832"><a href="#SMBSession.put_file-832"><span class="linenos">832</span></a>                    <span class="k">pass</span>
</span><span id="SMBSession.put_file-833"><a href="#SMBSession.put_file-833"><span class="linenos">833</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.put_file-834"><a href="#SMBSession.put_file-834"><span class="linenos">834</span></a>                <span class="c1"># [!] The specified localpath does not exist.</span>
</span><span id="SMBSession.put_file-835"><a href="#SMBSession.put_file-835"><span class="linenos">835</span></a>                <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Uploads a single file to the SMB share.</p>

<p>This method takes a local file path, opens the file, and uploads it to the SMB share at the specified path.
It handles exceptions such as broken pipe errors or keyboard interrupts by closing and reinitializing the SMB session.
General exceptions are caught and logged, with a traceback provided if debugging is enabled.</p>

<p>Args:
    localpath (str, optional): The local file path of the file to be uploaded. Defaults to None.</p>
</div>


                            </div>
                            <div id="SMBSession.put_file_recursively" class="classattr">
                                        <input id="SMBSession.put_file_recursively-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">put_file_recursively</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">localpath</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.put_file_recursively-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.put_file_recursively"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.put_file_recursively-837"><a href="#SMBSession.put_file_recursively-837"><span class="linenos">837</span></a>    <span class="k">def</span> <span class="nf">put_file_recursively</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.put_file_recursively-838"><a href="#SMBSession.put_file_recursively-838"><span class="linenos">838</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.put_file_recursively-839"><a href="#SMBSession.put_file_recursively-839"><span class="linenos">839</span></a><span class="sd">        Recursively uploads files from a specified local directory to the SMB share.</span>
</span><span id="SMBSession.put_file_recursively-840"><a href="#SMBSession.put_file_recursively-840"><span class="linenos">840</span></a>
</span><span id="SMBSession.put_file_recursively-841"><a href="#SMBSession.put_file_recursively-841"><span class="linenos">841</span></a><span class="sd">        This method walks through the given local directory and all its subdirectories, uploading each file to the</span>
</span><span id="SMBSession.put_file_recursively-842"><a href="#SMBSession.put_file_recursively-842"><span class="linenos">842</span></a><span class="sd">        corresponding directory structure on the SMB share. It first checks if the local path is a directory. If it is,</span>
</span><span id="SMBSession.put_file_recursively-843"><a href="#SMBSession.put_file_recursively-843"><span class="linenos">843</span></a><span class="sd">        it iterates over all files and directories within the local path, creating necessary directories on the SMB share</span>
</span><span id="SMBSession.put_file_recursively-844"><a href="#SMBSession.put_file_recursively-844"><span class="linenos">844</span></a><span class="sd">        and uploading files. If the local path is not a directory, it prints an error message.</span>
</span><span id="SMBSession.put_file_recursively-845"><a href="#SMBSession.put_file_recursively-845"><span class="linenos">845</span></a>
</span><span id="SMBSession.put_file_recursively-846"><a href="#SMBSession.put_file_recursively-846"><span class="linenos">846</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession.put_file_recursively-847"><a href="#SMBSession.put_file_recursively-847"><span class="linenos">847</span></a><span class="sd">            localpath (str, optional): The local directory path from which files will be uploaded. Defaults to None.</span>
</span><span id="SMBSession.put_file_recursively-848"><a href="#SMBSession.put_file_recursively-848"><span class="linenos">848</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.put_file_recursively-849"><a href="#SMBSession.put_file_recursively-849"><span class="linenos">849</span></a>
</span><span id="SMBSession.put_file_recursively-850"><a href="#SMBSession.put_file_recursively-850"><span class="linenos">850</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="SMBSession.put_file_recursively-851"><a href="#SMBSession.put_file_recursively-851"><span class="linenos">851</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="SMBSession.put_file_recursively-852"><a href="#SMBSession.put_file_recursively-852"><span class="linenos">852</span></a>                <span class="c1"># Iterate over all files and directories within the local path</span>
</span><span id="SMBSession.put_file_recursively-853"><a href="#SMBSession.put_file_recursively-853"><span class="linenos">853</span></a>                <span class="n">local_files</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SMBSession.put_file_recursively-854"><a href="#SMBSession.put_file_recursively-854"><span class="linenos">854</span></a>                <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">localpath</span><span class="p">):</span>
</span><span id="SMBSession.put_file_recursively-855"><a href="#SMBSession.put_file_recursively-855"><span class="linenos">855</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession.put_file_recursively-856"><a href="#SMBSession.put_file_recursively-856"><span class="linenos">856</span></a>                        <span class="n">local_files</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="n">files</span>
</span><span id="SMBSession.put_file_recursively-857"><a href="#SMBSession.put_file_recursively-857"><span class="linenos">857</span></a>
</span><span id="SMBSession.put_file_recursively-858"><a href="#SMBSession.put_file_recursively-858"><span class="linenos">858</span></a>                <span class="c1"># Iterate over the found files</span>
</span><span id="SMBSession.put_file_recursively-859"><a href="#SMBSession.put_file_recursively-859"><span class="linenos">859</span></a>                <span class="k">for</span> <span class="n">local_dir_path</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">local_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="SMBSession.put_file_recursively-860"><a href="#SMBSession.put_file_recursively-860"><span class="linenos">860</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[&gt;] Putting files of &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">local_dir_path</span><span class="p">)</span>
</span><span id="SMBSession.put_file_recursively-861"><a href="#SMBSession.put_file_recursively-861"><span class="linenos">861</span></a>
</span><span id="SMBSession.put_file_recursively-862"><a href="#SMBSession.put_file_recursively-862"><span class="linenos">862</span></a>                    <span class="c1"># Create remote directory</span>
</span><span id="SMBSession.put_file_recursively-863"><a href="#SMBSession.put_file_recursively-863"><span class="linenos">863</span></a>                    <span class="n">remote_dir_path</span> <span class="o">=</span> <span class="n">local_dir_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.put_file_recursively-864"><a href="#SMBSession.put_file_recursively-864"><span class="linenos">864</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="SMBSession.put_file_recursively-865"><a href="#SMBSession.put_file_recursively-865"><span class="linenos">865</span></a>                        <span class="n">path</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">remote_dir_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.put_file_recursively-866"><a href="#SMBSession.put_file_recursively-866"><span class="linenos">866</span></a>                    <span class="p">)</span>
</span><span id="SMBSession.put_file_recursively-867"><a href="#SMBSession.put_file_recursively-867"><span class="linenos">867</span></a>
</span><span id="SMBSession.put_file_recursively-868"><a href="#SMBSession.put_file_recursively-868"><span class="linenos">868</span></a>                    <span class="k">for</span> <span class="n">local_file_path</span> <span class="ow">in</span> <span class="n">local_files</span><span class="p">[</span><span class="n">local_dir_path</span><span class="p">]:</span>
</span><span id="SMBSession.put_file_recursively-869"><a href="#SMBSession.put_file_recursively-869"><span class="linenos">869</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.put_file_recursively-870"><a href="#SMBSession.put_file_recursively-870"><span class="linenos">870</span></a>                            <span class="n">f</span> <span class="o">=</span> <span class="n">LocalFileIO</span><span class="p">(</span>
</span><span id="SMBSession.put_file_recursively-871"><a href="#SMBSession.put_file_recursively-871"><span class="linenos">871</span></a>                                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">,</span> 
</span><span id="SMBSession.put_file_recursively-872"><a href="#SMBSession.put_file_recursively-872"><span class="linenos">872</span></a>                                <span class="n">path</span><span class="o">=</span><span class="n">local_dir_path</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">local_file_path</span><span class="p">,</span> 
</span><span id="SMBSession.put_file_recursively-873"><a href="#SMBSession.put_file_recursively-873"><span class="linenos">873</span></a>                                <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span>
</span><span id="SMBSession.put_file_recursively-874"><a href="#SMBSession.put_file_recursively-874"><span class="linenos">874</span></a>                            <span class="p">)</span>
</span><span id="SMBSession.put_file_recursively-875"><a href="#SMBSession.put_file_recursively-875"><span class="linenos">875</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">putFile</span><span class="p">(</span>
</span><span id="SMBSession.put_file_recursively-876"><a href="#SMBSession.put_file_recursively-876"><span class="linenos">876</span></a>                                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.put_file_recursively-877"><a href="#SMBSession.put_file_recursively-877"><span class="linenos">877</span></a>                                <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">remote_dir_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">local_file_path</span><span class="p">),</span> 
</span><span id="SMBSession.put_file_recursively-878"><a href="#SMBSession.put_file_recursively-878"><span class="linenos">878</span></a>                                <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span>
</span><span id="SMBSession.put_file_recursively-879"><a href="#SMBSession.put_file_recursively-879"><span class="linenos">879</span></a>                            <span class="p">)</span>
</span><span id="SMBSession.put_file_recursively-880"><a href="#SMBSession.put_file_recursively-880"><span class="linenos">880</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="SMBSession.put_file_recursively-881"><a href="#SMBSession.put_file_recursively-881"><span class="linenos">881</span></a>
</span><span id="SMBSession.put_file_recursively-882"><a href="#SMBSession.put_file_recursively-882"><span class="linenos">882</span></a>                        <span class="k">except</span> <span class="ne">BrokenPipeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.put_file_recursively-883"><a href="#SMBSession.put_file_recursively-883"><span class="linenos">883</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">set_error</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;[bold red]Failed uploading &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession.put_file_recursively-884"><a href="#SMBSession.put_file_recursively-884"><span class="linenos">884</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SMBSession.put_file_recursively-885"><a href="#SMBSession.put_file_recursively-885"><span class="linenos">885</span></a>                            <span class="k">break</span>
</span><span id="SMBSession.put_file_recursively-886"><a href="#SMBSession.put_file_recursively-886"><span class="linenos">886</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.put_file_recursively-887"><a href="#SMBSession.put_file_recursively-887"><span class="linenos">887</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">set_error</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;[bold red]Failed uploading &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession.put_file_recursively-888"><a href="#SMBSession.put_file_recursively-888"><span class="linenos">888</span></a>                            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SMBSession.put_file_recursively-889"><a href="#SMBSession.put_file_recursively-889"><span class="linenos">889</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.put_file_recursively-890"><a href="#SMBSession.put_file_recursively-890"><span class="linenos">890</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] The specified localpath is a file. Use &#39;put &lt;file&gt;&#39; instead.&quot;</span><span class="p">)</span>
</span><span id="SMBSession.put_file_recursively-891"><a href="#SMBSession.put_file_recursively-891"><span class="linenos">891</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.put_file_recursively-892"><a href="#SMBSession.put_file_recursively-892"><span class="linenos">892</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] The specified localpath does not exist.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Recursively uploads files from a specified local directory to the SMB share.</p>

<p>This method walks through the given local directory and all its subdirectories, uploading each file to the
corresponding directory structure on the SMB share. It first checks if the local path is a directory. If it is,
it iterates over all files and directories within the local path, creating necessary directories on the SMB share
and uploading files. If the local path is not a directory, it prints an error message.</p>

<p>Args:
    localpath (str, optional): The local directory path from which files will be uploaded. Defaults to None.</p>
</div>


                            </div>
                            <div id="SMBSession.rmdir" class="classattr">
                                        <input id="SMBSession.rmdir-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rmdir</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.rmdir-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.rmdir"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.rmdir-894"><a href="#SMBSession.rmdir-894"><span class="linenos">894</span></a>    <span class="k">def</span> <span class="nf">rmdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.rmdir-895"><a href="#SMBSession.rmdir-895"><span class="linenos">895</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.rmdir-896"><a href="#SMBSession.rmdir-896"><span class="linenos">896</span></a><span class="sd">        Removes a directory from the SMB share at the specified path.</span>
</span><span id="SMBSession.rmdir-897"><a href="#SMBSession.rmdir-897"><span class="linenos">897</span></a>
</span><span id="SMBSession.rmdir-898"><a href="#SMBSession.rmdir-898"><span class="linenos">898</span></a><span class="sd">        This method attempts to delete a directory located at the given path on the SMB share. If the operation fails,</span>
</span><span id="SMBSession.rmdir-899"><a href="#SMBSession.rmdir-899"><span class="linenos">899</span></a><span class="sd">        it prints an error message indicating the failure and the reason. If debugging is enabled, it also prints</span>
</span><span id="SMBSession.rmdir-900"><a href="#SMBSession.rmdir-900"><span class="linenos">900</span></a><span class="sd">        the stack trace of the exception.</span>
</span><span id="SMBSession.rmdir-901"><a href="#SMBSession.rmdir-901"><span class="linenos">901</span></a>
</span><span id="SMBSession.rmdir-902"><a href="#SMBSession.rmdir-902"><span class="linenos">902</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession.rmdir-903"><a href="#SMBSession.rmdir-903"><span class="linenos">903</span></a><span class="sd">            path (str, optional): The path of the directory to be removed on the SMB share. Defaults to None.</span>
</span><span id="SMBSession.rmdir-904"><a href="#SMBSession.rmdir-904"><span class="linenos">904</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.rmdir-905"><a href="#SMBSession.rmdir-905"><span class="linenos">905</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.rmdir-906"><a href="#SMBSession.rmdir-906"><span class="linenos">906</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">deleteDirectory</span><span class="p">(</span>
</span><span id="SMBSession.rmdir-907"><a href="#SMBSession.rmdir-907"><span class="linenos">907</span></a>                <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.rmdir-908"><a href="#SMBSession.rmdir-908"><span class="linenos">908</span></a>                <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span><span class="p">),</span> 
</span><span id="SMBSession.rmdir-909"><a href="#SMBSession.rmdir-909"><span class="linenos">909</span></a>            <span class="p">)</span>
</span><span id="SMBSession.rmdir-910"><a href="#SMBSession.rmdir-910"><span class="linenos">910</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.rmdir-911"><a href="#SMBSession.rmdir-911"><span class="linenos">911</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to remove directory &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession.rmdir-912"><a href="#SMBSession.rmdir-912"><span class="linenos">912</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.rmdir-913"><a href="#SMBSession.rmdir-913"><span class="linenos">913</span></a>                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Removes a directory from the SMB share at the specified path.</p>

<p>This method attempts to delete a directory located at the given path on the SMB share. If the operation fails,
it prints an error message indicating the failure and the reason. If debugging is enabled, it also prints
the stack trace of the exception.</p>

<p>Args:
    path (str, optional): The path of the directory to be removed on the SMB share. Defaults to None.</p>
</div>


                            </div>
                            <div id="SMBSession.rm" class="classattr">
                                        <input id="SMBSession.rm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.rm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.rm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.rm-915"><a href="#SMBSession.rm-915"><span class="linenos">915</span></a>    <span class="k">def</span> <span class="nf">rm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.rm-916"><a href="#SMBSession.rm-916"><span class="linenos">916</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.rm-917"><a href="#SMBSession.rm-917"><span class="linenos">917</span></a><span class="sd">        Removes a file from the SMB share at the specified path.</span>
</span><span id="SMBSession.rm-918"><a href="#SMBSession.rm-918"><span class="linenos">918</span></a>
</span><span id="SMBSession.rm-919"><a href="#SMBSession.rm-919"><span class="linenos">919</span></a><span class="sd">        This method attempts to delete a file located at the given path on the SMB share. If the operation fails,</span>
</span><span id="SMBSession.rm-920"><a href="#SMBSession.rm-920"><span class="linenos">920</span></a><span class="sd">        it prints an error message indicating the failure and the reason. If debugging is enabled, it also prints</span>
</span><span id="SMBSession.rm-921"><a href="#SMBSession.rm-921"><span class="linenos">921</span></a><span class="sd">        the stack trace of the exception.</span>
</span><span id="SMBSession.rm-922"><a href="#SMBSession.rm-922"><span class="linenos">922</span></a>
</span><span id="SMBSession.rm-923"><a href="#SMBSession.rm-923"><span class="linenos">923</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession.rm-924"><a href="#SMBSession.rm-924"><span class="linenos">924</span></a><span class="sd">            path (str, optional): The path of the file to be removed on the SMB share. Defaults to None.</span>
</span><span id="SMBSession.rm-925"><a href="#SMBSession.rm-925"><span class="linenos">925</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.rm-926"><a href="#SMBSession.rm-926"><span class="linenos">926</span></a>
</span><span id="SMBSession.rm-927"><a href="#SMBSession.rm-927"><span class="linenos">927</span></a>        <span class="c1"># Parse path</span>
</span><span id="SMBSession.rm-928"><a href="#SMBSession.rm-928"><span class="linenos">928</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.rm-929"><a href="#SMBSession.rm-929"><span class="linenos">929</span></a>        <span class="k">if</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="SMBSession.rm-930"><a href="#SMBSession.rm-930"><span class="linenos">930</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="SMBSession.rm-931"><a href="#SMBSession.rm-931"><span class="linenos">931</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.rm-932"><a href="#SMBSession.rm-932"><span class="linenos">932</span></a>            <span class="n">tmp_search_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.rm-933"><a href="#SMBSession.rm-933"><span class="linenos">933</span></a>        <span class="c1"># Parse filename</span>
</span><span id="SMBSession.rm-934"><a href="#SMBSession.rm-934"><span class="linenos">934</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession.rm-935"><a href="#SMBSession.rm-935"><span class="linenos">935</span></a>
</span><span id="SMBSession.rm-936"><a href="#SMBSession.rm-936"><span class="linenos">936</span></a>        <span class="c1"># Search for the file</span>
</span><span id="SMBSession.rm-937"><a href="#SMBSession.rm-937"><span class="linenos">937</span></a>        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession.rm-938"><a href="#SMBSession.rm-938"><span class="linenos">938</span></a>            <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.rm-939"><a href="#SMBSession.rm-939"><span class="linenos">939</span></a>            <span class="n">path</span><span class="o">=</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span>
</span><span id="SMBSession.rm-940"><a href="#SMBSession.rm-940"><span class="linenos">940</span></a>        <span class="p">)</span>   
</span><span id="SMBSession.rm-941"><a href="#SMBSession.rm-941"><span class="linenos">941</span></a>
</span><span id="SMBSession.rm-942"><a href="#SMBSession.rm-942"><span class="linenos">942</span></a>        <span class="c1"># Filter the entries</span>
</span><span id="SMBSession.rm-943"><a href="#SMBSession.rm-943"><span class="linenos">943</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SMBSession.rm-944"><a href="#SMBSession.rm-944"><span class="linenos">944</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span><span id="SMBSession.rm-945"><a href="#SMBSession.rm-945"><span class="linenos">945</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession.rm-946"><a href="#SMBSession.rm-946"><span class="linenos">946</span></a>                <span class="c1"># Skip directories</span>
</span><span id="SMBSession.rm-947"><a href="#SMBSession.rm-947"><span class="linenos">947</span></a>                <span class="k">continue</span>
</span><span id="SMBSession.rm-948"><a href="#SMBSession.rm-948"><span class="linenos">948</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="o">==</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SMBSession.rm-949"><a href="#SMBSession.rm-949"><span class="linenos">949</span></a>                <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="SMBSession.rm-950"><a href="#SMBSession.rm-950"><span class="linenos">950</span></a>            <span class="k">elif</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="SMBSession.rm-951"><a href="#SMBSession.rm-951"><span class="linenos">951</span></a>                <span class="n">regexp</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;.*&#39;</span><span class="p">)</span>
</span><span id="SMBSession.rm-952"><a href="#SMBSession.rm-952"><span class="linenos">952</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()):</span>
</span><span id="SMBSession.rm-953"><a href="#SMBSession.rm-953"><span class="linenos">953</span></a>                    <span class="n">matching_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="SMBSession.rm-954"><a href="#SMBSession.rm-954"><span class="linenos">954</span></a>        
</span><span id="SMBSession.rm-955"><a href="#SMBSession.rm-955"><span class="linenos">955</span></a>        <span class="n">matching_entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">matching_entries</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_longname</span><span class="p">())</span>
</span><span id="SMBSession.rm-956"><a href="#SMBSession.rm-956"><span class="linenos">956</span></a>
</span><span id="SMBSession.rm-957"><a href="#SMBSession.rm-957"><span class="linenos">957</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matching_entries</span><span class="p">:</span>
</span><span id="SMBSession.rm-958"><a href="#SMBSession.rm-958"><span class="linenos">958</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.rm-959"><a href="#SMBSession.rm-959"><span class="linenos">959</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">deleteFile</span><span class="p">(</span>
</span><span id="SMBSession.rm-960"><a href="#SMBSession.rm-960"><span class="linenos">960</span></a>                    <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.rm-961"><a href="#SMBSession.rm-961"><span class="linenos">961</span></a>                    <span class="n">pathName</span><span class="o">=</span><span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">tmp_search_path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()),</span> 
</span><span id="SMBSession.rm-962"><a href="#SMBSession.rm-962"><span class="linenos">962</span></a>                <span class="p">)</span>
</span><span id="SMBSession.rm-963"><a href="#SMBSession.rm-963"><span class="linenos">963</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.rm-964"><a href="#SMBSession.rm-964"><span class="linenos">964</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Failed to remove file &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
</span><span id="SMBSession.rm-965"><a href="#SMBSession.rm-965"><span class="linenos">965</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.rm-966"><a href="#SMBSession.rm-966"><span class="linenos">966</span></a>                    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Removes a file from the SMB share at the specified path.</p>

<p>This method attempts to delete a file located at the given path on the SMB share. If the operation fails,
it prints an error message indicating the failure and the reason. If debugging is enabled, it also prints
the stack trace of the exception.</p>

<p>Args:
    path (str, optional): The path of the file to be removed on the SMB share. Defaults to None.</p>
</div>


                            </div>
                            <div id="SMBSession.tree" class="classattr">
                                        <input id="SMBSession.tree-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tree</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.tree-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.tree"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.tree-968"><a href="#SMBSession.tree-968"><span class="linenos"> 968</span></a>    <span class="k">def</span> <span class="nf">tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.tree-969"><a href="#SMBSession.tree-969"><span class="linenos"> 969</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.tree-970"><a href="#SMBSession.tree-970"><span class="linenos"> 970</span></a><span class="sd">        Recursively lists the directory structure of the SMB share starting from the specified path.</span>
</span><span id="SMBSession.tree-971"><a href="#SMBSession.tree-971"><span class="linenos"> 971</span></a>
</span><span id="SMBSession.tree-972"><a href="#SMBSession.tree-972"><span class="linenos"> 972</span></a><span class="sd">        This function prints a visual representation of the directory tree of the remote SMB share. It uses</span>
</span><span id="SMBSession.tree-973"><a href="#SMBSession.tree-973"><span class="linenos"> 973</span></a><span class="sd">        recursion to navigate through directories and lists all files and subdirectories in each directory.</span>
</span><span id="SMBSession.tree-974"><a href="#SMBSession.tree-974"><span class="linenos"> 974</span></a><span class="sd">        The output is color-coded and formatted to enhance readability, with directories highlighted in cyan.</span>
</span><span id="SMBSession.tree-975"><a href="#SMBSession.tree-975"><span class="linenos"> 975</span></a>
</span><span id="SMBSession.tree-976"><a href="#SMBSession.tree-976"><span class="linenos"> 976</span></a><span class="sd">        Args:</span>
</span><span id="SMBSession.tree-977"><a href="#SMBSession.tree-977"><span class="linenos"> 977</span></a><span class="sd">            path (str, optional): The starting path on the SMB share from which to begin listing the tree.</span>
</span><span id="SMBSession.tree-978"><a href="#SMBSession.tree-978"><span class="linenos"> 978</span></a><span class="sd">                                  Defaults to the root of the current share.</span>
</span><span id="SMBSession.tree-979"><a href="#SMBSession.tree-979"><span class="linenos"> 979</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.tree-980"><a href="#SMBSession.tree-980"><span class="linenos"> 980</span></a>        
</span><span id="SMBSession.tree-981"><a href="#SMBSession.tree-981"><span class="linenos"> 981</span></a>        <span class="k">def</span> <span class="nf">recurse_action</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="p">[],</span> <span class="n">prompt</span><span class="o">=</span><span class="p">[]):</span>
</span><span id="SMBSession.tree-982"><a href="#SMBSession.tree-982"><span class="linenos"> 982</span></a>            <span class="n">bars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;│   &quot;</span><span class="p">,</span> <span class="s2">&quot;├── &quot;</span><span class="p">,</span> <span class="s2">&quot;└── &quot;</span><span class="p">]</span>
</span><span id="SMBSession.tree-983"><a href="#SMBSession.tree-983"><span class="linenos"> 983</span></a>
</span><span id="SMBSession.tree-984"><a href="#SMBSession.tree-984"><span class="linenos"> 984</span></a>            <span class="n">remote_smb_path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">base_dir</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="SMBSession.tree-985"><a href="#SMBSession.tree-985"><span class="linenos"> 985</span></a>
</span><span id="SMBSession.tree-986"><a href="#SMBSession.tree-986"><span class="linenos"> 986</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SMBSession.tree-987"><a href="#SMBSession.tree-987"><span class="linenos"> 987</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.tree-988"><a href="#SMBSession.tree-988"><span class="linenos"> 988</span></a>                <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span>
</span><span id="SMBSession.tree-989"><a href="#SMBSession.tree-989"><span class="linenos"> 989</span></a>                    <span class="n">shareName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> 
</span><span id="SMBSession.tree-990"><a href="#SMBSession.tree-990"><span class="linenos"> 990</span></a>                    <span class="n">path</span><span class="o">=</span><span class="n">remote_smb_path</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">*&#39;</span>
</span><span id="SMBSession.tree-991"><a href="#SMBSession.tree-991"><span class="linenos"> 991</span></a>                <span class="p">)</span>
</span><span id="SMBSession.tree-992"><a href="#SMBSession.tree-992"><span class="linenos"> 992</span></a>            <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="SMBSession.tree-993"><a href="#SMBSession.tree-993"><span class="linenos"> 993</span></a>                <span class="n">code</span><span class="p">,</span> <span class="n">const</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">getErrorCode</span><span class="p">(),</span> <span class="n">err</span><span class="o">.</span><span class="n">getErrorString</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">err</span><span class="o">.</span><span class="n">getErrorString</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SMBSession.tree-994"><a href="#SMBSession.tree-994"><span class="linenos"> 994</span></a>                <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;Error 0x</span><span class="si">%08x</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">const</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span id="SMBSession.tree-995"><a href="#SMBSession.tree-995"><span class="linenos"> 995</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession.tree-996"><a href="#SMBSession.tree-996"><span class="linenos"> 996</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">errmsg</span><span class="p">))</span>
</span><span id="SMBSession.tree-997"><a href="#SMBSession.tree-997"><span class="linenos"> 997</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-998"><a href="#SMBSession.tree-998"><span class="linenos"> 998</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;91m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">errmsg</span><span class="p">))</span>
</span><span id="SMBSession.tree-999"><a href="#SMBSession.tree-999"><span class="linenos"> 999</span></a>                <span class="k">return</span> 
</span><span id="SMBSession.tree-1000"><a href="#SMBSession.tree-1000"><span class="linenos">1000</span></a>
</span><span id="SMBSession.tree-1001"><a href="#SMBSession.tree-1001"><span class="linenos">1001</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">]]</span>
</span><span id="SMBSession.tree-1002"><a href="#SMBSession.tree-1002"><span class="linenos">1002</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">get_longname</span><span class="p">())</span>
</span><span id="SMBSession.tree-1003"><a href="#SMBSession.tree-1003"><span class="linenos">1003</span></a>
</span><span id="SMBSession.tree-1004"><a href="#SMBSession.tree-1004"><span class="linenos">1004</span></a>            <span class="c1"># </span>
</span><span id="SMBSession.tree-1005"><a href="#SMBSession.tree-1005"><span class="linenos">1005</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SMBSession.tree-1006"><a href="#SMBSession.tree-1006"><span class="linenos">1006</span></a>                <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SMBSession.tree-1007"><a href="#SMBSession.tree-1007"><span class="linenos">1007</span></a>                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="SMBSession.tree-1008"><a href="#SMBSession.tree-1008"><span class="linenos">1008</span></a>                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SMBSession.tree-1009"><a href="#SMBSession.tree-1009"><span class="linenos">1009</span></a>                    <span class="c1"># This is the first entry </span>
</span><span id="SMBSession.tree-1010"><a href="#SMBSession.tree-1010"><span class="linenos">1010</span></a>                    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession.tree-1011"><a href="#SMBSession.tree-1011"><span class="linenos">1011</span></a>                        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession.tree-1012"><a href="#SMBSession.tree-1012"><span class="linenos">1012</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession.tree-1013"><a href="#SMBSession.tree-1013"><span class="linenos">1013</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1014"><a href="#SMBSession.tree-1014"><span class="linenos">1014</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1015"><a href="#SMBSession.tree-1015"><span class="linenos">1015</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1016"><a href="#SMBSession.tree-1016"><span class="linenos">1016</span></a>                            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession.tree-1017"><a href="#SMBSession.tree-1017"><span class="linenos">1017</span></a>                                <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> 
</span><span id="SMBSession.tree-1018"><a href="#SMBSession.tree-1018"><span class="linenos">1018</span></a>                                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()],</span>
</span><span id="SMBSession.tree-1019"><a href="#SMBSession.tree-1019"><span class="linenos">1019</span></a>                                <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;│   &quot;</span><span class="p">]</span>
</span><span id="SMBSession.tree-1020"><a href="#SMBSession.tree-1020"><span class="linenos">1020</span></a>                            <span class="p">)</span>
</span><span id="SMBSession.tree-1021"><a href="#SMBSession.tree-1021"><span class="linenos">1021</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1022"><a href="#SMBSession.tree-1022"><span class="linenos">1022</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession.tree-1023"><a href="#SMBSession.tree-1023"><span class="linenos">1023</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1024"><a href="#SMBSession.tree-1024"><span class="linenos">1024</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1025"><a href="#SMBSession.tree-1025"><span class="linenos">1025</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1026"><a href="#SMBSession.tree-1026"><span class="linenos">1026</span></a>
</span><span id="SMBSession.tree-1027"><a href="#SMBSession.tree-1027"><span class="linenos">1027</span></a>                    <span class="c1"># This is the last entry</span>
</span><span id="SMBSession.tree-1028"><a href="#SMBSession.tree-1028"><span class="linenos">1028</span></a>                    <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
</span><span id="SMBSession.tree-1029"><a href="#SMBSession.tree-1029"><span class="linenos">1029</span></a>                        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession.tree-1030"><a href="#SMBSession.tree-1030"><span class="linenos">1030</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession.tree-1031"><a href="#SMBSession.tree-1031"><span class="linenos">1031</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1032"><a href="#SMBSession.tree-1032"><span class="linenos">1032</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1033"><a href="#SMBSession.tree-1033"><span class="linenos">1033</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1034"><a href="#SMBSession.tree-1034"><span class="linenos">1034</span></a>                            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession.tree-1035"><a href="#SMBSession.tree-1035"><span class="linenos">1035</span></a>                                <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> 
</span><span id="SMBSession.tree-1036"><a href="#SMBSession.tree-1036"><span class="linenos">1036</span></a>                                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()],</span>
</span><span id="SMBSession.tree-1037"><a href="#SMBSession.tree-1037"><span class="linenos">1037</span></a>                                <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;    &quot;</span><span class="p">]</span>
</span><span id="SMBSession.tree-1038"><a href="#SMBSession.tree-1038"><span class="linenos">1038</span></a>                            <span class="p">)</span>
</span><span id="SMBSession.tree-1039"><a href="#SMBSession.tree-1039"><span class="linenos">1039</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1040"><a href="#SMBSession.tree-1040"><span class="linenos">1040</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession.tree-1041"><a href="#SMBSession.tree-1041"><span class="linenos">1041</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1042"><a href="#SMBSession.tree-1042"><span class="linenos">1042</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1043"><a href="#SMBSession.tree-1043"><span class="linenos">1043</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1044"><a href="#SMBSession.tree-1044"><span class="linenos">1044</span></a>                        
</span><span id="SMBSession.tree-1045"><a href="#SMBSession.tree-1045"><span class="linenos">1045</span></a>                    <span class="c1"># These are entries in the middle</span>
</span><span id="SMBSession.tree-1046"><a href="#SMBSession.tree-1046"><span class="linenos">1046</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1047"><a href="#SMBSession.tree-1047"><span class="linenos">1047</span></a>                        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession.tree-1048"><a href="#SMBSession.tree-1048"><span class="linenos">1048</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession.tree-1049"><a href="#SMBSession.tree-1049"><span class="linenos">1049</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1050"><a href="#SMBSession.tree-1050"><span class="linenos">1050</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1051"><a href="#SMBSession.tree-1051"><span class="linenos">1051</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1052"><a href="#SMBSession.tree-1052"><span class="linenos">1052</span></a>                            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession.tree-1053"><a href="#SMBSession.tree-1053"><span class="linenos">1053</span></a>                                <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> 
</span><span id="SMBSession.tree-1054"><a href="#SMBSession.tree-1054"><span class="linenos">1054</span></a>                                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()],</span>
</span><span id="SMBSession.tree-1055"><a href="#SMBSession.tree-1055"><span class="linenos">1055</span></a>                                <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;│   &quot;</span><span class="p">]</span>
</span><span id="SMBSession.tree-1056"><a href="#SMBSession.tree-1056"><span class="linenos">1056</span></a>                            <span class="p">)</span>
</span><span id="SMBSession.tree-1057"><a href="#SMBSession.tree-1057"><span class="linenos">1057</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1058"><a href="#SMBSession.tree-1058"><span class="linenos">1058</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession.tree-1059"><a href="#SMBSession.tree-1059"><span class="linenos">1059</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1060"><a href="#SMBSession.tree-1060"><span class="linenos">1060</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1061"><a href="#SMBSession.tree-1061"><span class="linenos">1061</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1062"><a href="#SMBSession.tree-1062"><span class="linenos">1062</span></a>
</span><span id="SMBSession.tree-1063"><a href="#SMBSession.tree-1063"><span class="linenos">1063</span></a>            <span class="c1"># </span>
</span><span id="SMBSession.tree-1064"><a href="#SMBSession.tree-1064"><span class="linenos">1064</span></a>            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SMBSession.tree-1065"><a href="#SMBSession.tree-1065"><span class="linenos">1065</span></a>                <span class="n">entry</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SMBSession.tree-1066"><a href="#SMBSession.tree-1066"><span class="linenos">1066</span></a>                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_directory</span><span class="p">():</span>
</span><span id="SMBSession.tree-1067"><a href="#SMBSession.tree-1067"><span class="linenos">1067</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession.tree-1068"><a href="#SMBSession.tree-1068"><span class="linenos">1068</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1069"><a href="#SMBSession.tree-1069"><span class="linenos">1069</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1070"><a href="#SMBSession.tree-1070"><span class="linenos">1070</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1071"><a href="#SMBSession.tree-1071"><span class="linenos">1071</span></a>                    <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession.tree-1072"><a href="#SMBSession.tree-1072"><span class="linenos">1072</span></a>                        <span class="n">base_dir</span><span class="o">=</span><span class="n">base_dir</span><span class="p">,</span> 
</span><span id="SMBSession.tree-1073"><a href="#SMBSession.tree-1073"><span class="linenos">1073</span></a>                        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()],</span>
</span><span id="SMBSession.tree-1074"><a href="#SMBSession.tree-1074"><span class="linenos">1074</span></a>                        <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;    &quot;</span><span class="p">]</span>
</span><span id="SMBSession.tree-1075"><a href="#SMBSession.tree-1075"><span class="linenos">1075</span></a>                    <span class="p">)</span>
</span><span id="SMBSession.tree-1076"><a href="#SMBSession.tree-1076"><span class="linenos">1076</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1077"><a href="#SMBSession.tree-1077"><span class="linenos">1077</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession.tree-1078"><a href="#SMBSession.tree-1078"><span class="linenos">1078</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1079"><a href="#SMBSession.tree-1079"><span class="linenos">1079</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1080"><a href="#SMBSession.tree-1080"><span class="linenos">1080</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[1m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prompt</span><span class="o">+</span><span class="p">[</span><span class="n">bars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_longname</span><span class="p">()))</span>
</span><span id="SMBSession.tree-1081"><a href="#SMBSession.tree-1081"><span class="linenos">1081</span></a>
</span><span id="SMBSession.tree-1082"><a href="#SMBSession.tree-1082"><span class="linenos">1082</span></a>        <span class="c1"># Entrypoint</span>
</span><span id="SMBSession.tree-1083"><a href="#SMBSession.tree-1083"><span class="linenos">1083</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.tree-1084"><a href="#SMBSession.tree-1084"><span class="linenos">1084</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_colors</span><span class="p">:</span>
</span><span id="SMBSession.tree-1085"><a href="#SMBSession.tree-1085"><span class="linenos">1085</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession.tree-1086"><a href="#SMBSession.tree-1086"><span class="linenos">1086</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.tree-1087"><a href="#SMBSession.tree-1087"><span class="linenos">1087</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[1;96m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession.tree-1088"><a href="#SMBSession.tree-1088"><span class="linenos">1088</span></a>            <span class="n">recurse_action</span><span class="p">(</span>
</span><span id="SMBSession.tree-1089"><a href="#SMBSession.tree-1089"><span class="linenos">1089</span></a>                <span class="n">base_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="p">,</span> 
</span><span id="SMBSession.tree-1090"><a href="#SMBSession.tree-1090"><span class="linenos">1090</span></a>                <span class="n">path</span><span class="o">=</span><span class="p">[</span><span class="n">path</span><span class="p">],</span>
</span><span id="SMBSession.tree-1091"><a href="#SMBSession.tree-1091"><span class="linenos">1091</span></a>                <span class="n">prompt</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
</span><span id="SMBSession.tree-1092"><a href="#SMBSession.tree-1092"><span class="linenos">1092</span></a>            <span class="p">)</span>
</span><span id="SMBSession.tree-1093"><a href="#SMBSession.tree-1093"><span class="linenos">1093</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">BrokenPipeError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession.tree-1094"><a href="#SMBSession.tree-1094"><span class="linenos">1094</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Interrupted.&quot;</span><span class="p">)</span>
</span><span id="SMBSession.tree-1095"><a href="#SMBSession.tree-1095"><span class="linenos">1095</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">close_smb_session</span><span class="p">()</span>
</span><span id="SMBSession.tree-1096"><a href="#SMBSession.tree-1096"><span class="linenos">1096</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">init_smb_session</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Recursively lists the directory structure of the SMB share starting from the specified path.</p>

<p>This function prints a visual representation of the directory tree of the remote SMB share. It uses
recursion to navigate through directories and lists all files and subdirectories in each directory.
The output is color-coded and formatted to enhance readability, with directories highlighted in cyan.</p>

<p>Args:
    path (str, optional): The starting path on the SMB share from which to begin listing the tree.
                          Defaults to the root of the current share.</p>
</div>


                            </div>
                            <div id="SMBSession.umount" class="classattr">
                                        <input id="SMBSession.umount-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">umount</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">local_mount_point</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.umount-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.umount"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.umount-1098"><a href="#SMBSession.umount-1098"><span class="linenos">1098</span></a>    <span class="k">def</span> <span class="nf">umount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_mount_point</span><span class="p">):</span>
</span><span id="SMBSession.umount-1099"><a href="#SMBSession.umount-1099"><span class="linenos">1099</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.umount-1100"><a href="#SMBSession.umount-1100"><span class="linenos">1100</span></a><span class="sd">        Unmounts the specified local mount point of the remote share.</span>
</span><span id="SMBSession.umount-1101"><a href="#SMBSession.umount-1101"><span class="linenos">1101</span></a>
</span><span id="SMBSession.umount-1102"><a href="#SMBSession.umount-1102"><span class="linenos">1102</span></a><span class="sd">        This method unmounts the specified local mount point of the remote share based on the platform.</span>
</span><span id="SMBSession.umount-1103"><a href="#SMBSession.umount-1103"><span class="linenos">1103</span></a><span class="sd">        It supports Windows, Linux, and macOS platforms for unmounting.</span>
</span><span id="SMBSession.umount-1104"><a href="#SMBSession.umount-1104"><span class="linenos">1104</span></a>
</span><span id="SMBSession.umount-1105"><a href="#SMBSession.umount-1105"><span class="linenos">1105</span></a><span class="sd">        Parameters:</span>
</span><span id="SMBSession.umount-1106"><a href="#SMBSession.umount-1106"><span class="linenos">1106</span></a><span class="sd">            local_mount_point (str): The local mount point to unmount.</span>
</span><span id="SMBSession.umount-1107"><a href="#SMBSession.umount-1107"><span class="linenos">1107</span></a>
</span><span id="SMBSession.umount-1108"><a href="#SMBSession.umount-1108"><span class="linenos">1108</span></a><span class="sd">        Raises:</span>
</span><span id="SMBSession.umount-1109"><a href="#SMBSession.umount-1109"><span class="linenos">1109</span></a><span class="sd">            None</span>
</span><span id="SMBSession.umount-1110"><a href="#SMBSession.umount-1110"><span class="linenos">1110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.umount-1111"><a href="#SMBSession.umount-1111"><span class="linenos">1111</span></a>
</span><span id="SMBSession.umount-1112"><a href="#SMBSession.umount-1112"><span class="linenos">1112</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_mount_point</span><span class="p">):</span>
</span><span id="SMBSession.umount-1113"><a href="#SMBSession.umount-1113"><span class="linenos">1113</span></a>            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>
</span><span id="SMBSession.umount-1114"><a href="#SMBSession.umount-1114"><span class="linenos">1114</span></a>                <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;net use </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2"> /delete&quot;</span>
</span><span id="SMBSession.umount-1115"><a href="#SMBSession.umount-1115"><span class="linenos">1115</span></a>
</span><span id="SMBSession.umount-1116"><a href="#SMBSession.umount-1116"><span class="linenos">1116</span></a>            <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;darwin&#39;</span><span class="p">):</span>
</span><span id="SMBSession.umount-1117"><a href="#SMBSession.umount-1117"><span class="linenos">1117</span></a>                <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;umount </span><span class="si">{</span><span class="n">local_mount_point</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SMBSession.umount-1118"><a href="#SMBSession.umount-1118"><span class="linenos">1118</span></a>
</span><span id="SMBSession.umount-1119"><a href="#SMBSession.umount-1119"><span class="linenos">1119</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.umount-1120"><a href="#SMBSession.umount-1120"><span class="linenos">1120</span></a>                <span class="n">command</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SMBSession.umount-1121"><a href="#SMBSession.umount-1121"><span class="linenos">1121</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Unsupported platform for unmounting SMB share.&quot;</span><span class="p">)</span>
</span><span id="SMBSession.umount-1122"><a href="#SMBSession.umount-1122"><span class="linenos">1122</span></a>        
</span><span id="SMBSession.umount-1123"><a href="#SMBSession.umount-1123"><span class="linenos">1123</span></a>            <span class="k">if</span> <span class="n">command</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.umount-1124"><a href="#SMBSession.umount-1124"><span class="linenos">1124</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="SMBSession.umount-1125"><a href="#SMBSession.umount-1125"><span class="linenos">1125</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[debug] Executing: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">command</span><span class="p">)</span>
</span><span id="SMBSession.umount-1126"><a href="#SMBSession.umount-1126"><span class="linenos">1126</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="SMBSession.umount-1127"><a href="#SMBSession.umount-1127"><span class="linenos">1127</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.umount-1128"><a href="#SMBSession.umount-1128"><span class="linenos">1128</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Cannot unmount a non existing path.&quot;</span><span class="p">)</span>        
</span></pre></div>


            <div class="docstring"><p>Unmounts the specified local mount point of the remote share.</p>

<p>This method unmounts the specified local mount point of the remote share based on the platform.
It supports Windows, Linux, and macOS platforms for unmounting.</p>

<p>Parameters:
    local_mount_point (str): The local mount point to unmount.</p>

<p>Raises:
    None</p>
</div>


                            </div>
                            <div id="SMBSession.test_rights" class="classattr">
                                        <input id="SMBSession.test_rights-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test_rights</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">sharename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.test_rights-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.test_rights"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.test_rights-1132"><a href="#SMBSession.test_rights-1132"><span class="linenos">1132</span></a>    <span class="k">def</span> <span class="nf">test_rights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sharename</span><span class="p">):</span> 
</span><span id="SMBSession.test_rights-1133"><a href="#SMBSession.test_rights-1133"><span class="linenos">1133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.test_rights-1134"><a href="#SMBSession.test_rights-1134"><span class="linenos">1134</span></a><span class="sd">        Tests the read and write access rights of the current SMB session.</span>
</span><span id="SMBSession.test_rights-1135"><a href="#SMBSession.test_rights-1135"><span class="linenos">1135</span></a>
</span><span id="SMBSession.test_rights-1136"><a href="#SMBSession.test_rights-1136"><span class="linenos">1136</span></a><span class="sd">        This method checks the read and write access rights of the current SMB session by attempting to list paths and create/delete temporary directories.</span>
</span><span id="SMBSession.test_rights-1137"><a href="#SMBSession.test_rights-1137"><span class="linenos">1137</span></a><span class="sd">        </span>
</span><span id="SMBSession.test_rights-1138"><a href="#SMBSession.test_rights-1138"><span class="linenos">1138</span></a><span class="sd">        Returns:</span>
</span><span id="SMBSession.test_rights-1139"><a href="#SMBSession.test_rights-1139"><span class="linenos">1139</span></a><span class="sd">            dict: A dictionary containing the read and write access rights status.</span>
</span><span id="SMBSession.test_rights-1140"><a href="#SMBSession.test_rights-1140"><span class="linenos">1140</span></a><span class="sd">                - &quot;readable&quot; (bool): Indicates if the session has read access rights.</span>
</span><span id="SMBSession.test_rights-1141"><a href="#SMBSession.test_rights-1141"><span class="linenos">1141</span></a><span class="sd">                - &quot;writable&quot; (bool): Indicates if the session has write access rights.</span>
</span><span id="SMBSession.test_rights-1142"><a href="#SMBSession.test_rights-1142"><span class="linenos">1142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.test_rights-1143"><a href="#SMBSession.test_rights-1143"><span class="linenos">1143</span></a>
</span><span id="SMBSession.test_rights-1144"><a href="#SMBSession.test_rights-1144"><span class="linenos">1144</span></a>        <span class="c1"># Restore the current share</span>
</span><span id="SMBSession.test_rights-1145"><a href="#SMBSession.test_rights-1145"><span class="linenos">1145</span></a>        <span class="n">current_share</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span>
</span><span id="SMBSession.test_rights-1146"><a href="#SMBSession.test_rights-1146"><span class="linenos">1146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_share</span><span class="p">(</span><span class="n">shareName</span><span class="o">=</span><span class="n">sharename</span><span class="p">)</span>
</span><span id="SMBSession.test_rights-1147"><a href="#SMBSession.test_rights-1147"><span class="linenos">1147</span></a>
</span><span id="SMBSession.test_rights-1148"><a href="#SMBSession.test_rights-1148"><span class="linenos">1148</span></a>        <span class="n">access_rights</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;readable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;writable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><span id="SMBSession.test_rights-1149"><a href="#SMBSession.test_rights-1149"><span class="linenos">1149</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.test_rights-1150"><a href="#SMBSession.test_rights-1150"><span class="linenos">1150</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">listPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="SMBSession.test_rights-1151"><a href="#SMBSession.test_rights-1151"><span class="linenos">1151</span></a>            <span class="n">access_rights</span><span class="p">[</span><span class="s2">&quot;readable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SMBSession.test_rights-1152"><a href="#SMBSession.test_rights-1152"><span class="linenos">1152</span></a>        <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession.test_rights-1153"><a href="#SMBSession.test_rights-1153"><span class="linenos">1153</span></a>            <span class="n">access_rights</span><span class="p">[</span><span class="s2">&quot;readable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession.test_rights-1154"><a href="#SMBSession.test_rights-1154"><span class="linenos">1154</span></a>
</span><span id="SMBSession.test_rights-1155"><a href="#SMBSession.test_rights-1155"><span class="linenos">1155</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SMBSession.test_rights-1156"><a href="#SMBSession.test_rights-1156"><span class="linenos">1156</span></a>            <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s2">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPRSTUVWXYZ0123456759&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)]))</span>
</span><span id="SMBSession.test_rights-1157"><a href="#SMBSession.test_rights-1157"><span class="linenos">1157</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">createDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="n">temp_dir</span><span class="p">)</span>
</span><span id="SMBSession.test_rights-1158"><a href="#SMBSession.test_rights-1158"><span class="linenos">1158</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">deleteDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">,</span> <span class="n">temp_dir</span><span class="p">)</span>
</span><span id="SMBSession.test_rights-1159"><a href="#SMBSession.test_rights-1159"><span class="linenos">1159</span></a>            <span class="n">access_rights</span><span class="p">[</span><span class="s2">&quot;writable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="SMBSession.test_rights-1160"><a href="#SMBSession.test_rights-1160"><span class="linenos">1160</span></a>        <span class="k">except</span> <span class="n">impacket</span><span class="o">.</span><span class="n">smbconnection</span><span class="o">.</span><span class="n">SessionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SMBSession.test_rights-1161"><a href="#SMBSession.test_rights-1161"><span class="linenos">1161</span></a>            <span class="n">access_rights</span><span class="p">[</span><span class="s2">&quot;writable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SMBSession.test_rights-1162"><a href="#SMBSession.test_rights-1162"><span class="linenos">1162</span></a>
</span><span id="SMBSession.test_rights-1163"><a href="#SMBSession.test_rights-1163"><span class="linenos">1163</span></a>        <span class="c1"># Restore the current share</span>
</span><span id="SMBSession.test_rights-1164"><a href="#SMBSession.test_rights-1164"><span class="linenos">1164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_share</span><span class="p">(</span><span class="n">shareName</span><span class="o">=</span><span class="n">current_share</span><span class="p">)</span>
</span><span id="SMBSession.test_rights-1165"><a href="#SMBSession.test_rights-1165"><span class="linenos">1165</span></a>
</span><span id="SMBSession.test_rights-1166"><a href="#SMBSession.test_rights-1166"><span class="linenos">1166</span></a>        <span class="k">return</span> <span class="n">access_rights</span>
</span></pre></div>


            <div class="docstring"><p>Tests the read and write access rights of the current SMB session.</p>

<p>This method checks the read and write access rights of the current SMB session by attempting to list paths and create/delete temporary directories.</p>

<p>Returns:
    dict: A dictionary containing the read and write access rights status.
        - "readable" (bool): Indicates if the session has read access rights.
        - "writable" (bool): Indicates if the session has write access rights.</p>
</div>


                            </div>
                            <div id="SMBSession.set_share" class="classattr">
                                        <input id="SMBSession.set_share-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_share</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">shareName</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.set_share-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.set_share"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.set_share-1170"><a href="#SMBSession.set_share-1170"><span class="linenos">1170</span></a>    <span class="k">def</span> <span class="nf">set_share</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shareName</span><span class="p">):</span>
</span><span id="SMBSession.set_share-1171"><a href="#SMBSession.set_share-1171"><span class="linenos">1171</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.set_share-1172"><a href="#SMBSession.set_share-1172"><span class="linenos">1172</span></a><span class="sd">        Sets the current SMB share to the specified share name.</span>
</span><span id="SMBSession.set_share-1173"><a href="#SMBSession.set_share-1173"><span class="linenos">1173</span></a>
</span><span id="SMBSession.set_share-1174"><a href="#SMBSession.set_share-1174"><span class="linenos">1174</span></a><span class="sd">        This method updates the SMB session to use the specified share name. It checks if the share name is valid</span>
</span><span id="SMBSession.set_share-1175"><a href="#SMBSession.set_share-1175"><span class="linenos">1175</span></a><span class="sd">        and updates the smb_share attribute of the SMBSession instance.</span>
</span><span id="SMBSession.set_share-1176"><a href="#SMBSession.set_share-1176"><span class="linenos">1176</span></a>
</span><span id="SMBSession.set_share-1177"><a href="#SMBSession.set_share-1177"><span class="linenos">1177</span></a><span class="sd">        Parameters:</span>
</span><span id="SMBSession.set_share-1178"><a href="#SMBSession.set_share-1178"><span class="linenos">1178</span></a><span class="sd">            shareName (str): The name of the share to set as the current SMB share.</span>
</span><span id="SMBSession.set_share-1179"><a href="#SMBSession.set_share-1179"><span class="linenos">1179</span></a>
</span><span id="SMBSession.set_share-1180"><a href="#SMBSession.set_share-1180"><span class="linenos">1180</span></a><span class="sd">        Raises:</span>
</span><span id="SMBSession.set_share-1181"><a href="#SMBSession.set_share-1181"><span class="linenos">1181</span></a><span class="sd">            ValueError: If the shareName is None or an empty string.</span>
</span><span id="SMBSession.set_share-1182"><a href="#SMBSession.set_share-1182"><span class="linenos">1182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.set_share-1183"><a href="#SMBSession.set_share-1183"><span class="linenos">1183</span></a>
</span><span id="SMBSession.set_share-1184"><a href="#SMBSession.set_share-1184"><span class="linenos">1184</span></a>        <span class="k">if</span> <span class="n">shareName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.set_share-1185"><a href="#SMBSession.set_share-1185"><span class="linenos">1185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">list_shares</span><span class="p">()</span>
</span><span id="SMBSession.set_share-1186"><a href="#SMBSession.set_share-1186"><span class="linenos">1186</span></a>            <span class="k">if</span> <span class="n">shareName</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="SMBSession.set_share-1187"><a href="#SMBSession.set_share-1187"><span class="linenos">1187</span></a>                <span class="c1"># Doing this in order to keep the case of the share adevertised by the remote machine</span>
</span><span id="SMBSession.set_share-1188"><a href="#SMBSession.set_share-1188"><span class="linenos">1188</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_shares</span><span class="p">[</span><span class="n">shareName</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="SMBSession.set_share-1189"><a href="#SMBSession.set_share-1189"><span class="linenos">1189</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="SMBSession.set_share-1190"><a href="#SMBSession.set_share-1190"><span class="linenos">1190</span></a>                <span class="c1"># Connects the tree</span>
</span><span id="SMBSession.set_share-1191"><a href="#SMBSession.set_share-1191"><span class="linenos">1191</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smb_tree_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smbClient</span><span class="o">.</span><span class="n">connectTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span><span class="p">)</span>
</span><span id="SMBSession.set_share-1192"><a href="#SMBSession.set_share-1192"><span class="linenos">1192</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.set_share-1193"><a href="#SMBSession.set_share-1193"><span class="linenos">1193</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Could not set share &#39;</span><span class="si">%s</span><span class="s2">&#39;, it does not exist remotely.&quot;</span> <span class="o">%</span> <span class="n">shareName</span><span class="p">)</span>
</span><span id="SMBSession.set_share-1194"><a href="#SMBSession.set_share-1194"><span class="linenos">1194</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.set_share-1195"><a href="#SMBSession.set_share-1195"><span class="linenos">1195</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">smb_share</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Sets the current SMB share to the specified share name.</p>

<p>This method updates the SMB session to use the specified share name. It checks if the share name is valid
and updates the smb_share attribute of the SMBSession instance.</p>

<p>Parameters:
    shareName (str): The name of the share to set as the current SMB share.</p>

<p>Raises:
    ValueError: If the shareName is None or an empty string.</p>
</div>


                            </div>
                            <div id="SMBSession.set_cwd" class="classattr">
                                        <input id="SMBSession.set_cwd-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_cwd</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SMBSession.set_cwd-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SMBSession.set_cwd"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SMBSession.set_cwd-1197"><a href="#SMBSession.set_cwd-1197"><span class="linenos">1197</span></a>    <span class="k">def</span> <span class="nf">set_cwd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SMBSession.set_cwd-1198"><a href="#SMBSession.set_cwd-1198"><span class="linenos">1198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SMBSession.set_cwd-1199"><a href="#SMBSession.set_cwd-1199"><span class="linenos">1199</span></a><span class="sd">        Sets the current working directory on the SMB share to the specified path.</span>
</span><span id="SMBSession.set_cwd-1200"><a href="#SMBSession.set_cwd-1200"><span class="linenos">1200</span></a>
</span><span id="SMBSession.set_cwd-1201"><a href="#SMBSession.set_cwd-1201"><span class="linenos">1201</span></a><span class="sd">        This method updates the current working directory (cwd) of the SMB session to the given path if it is a valid directory.</span>
</span><span id="SMBSession.set_cwd-1202"><a href="#SMBSession.set_cwd-1202"><span class="linenos">1202</span></a><span class="sd">        If the specified path is not a directory, the cwd remains unchanged.</span>
</span><span id="SMBSession.set_cwd-1203"><a href="#SMBSession.set_cwd-1203"><span class="linenos">1203</span></a>
</span><span id="SMBSession.set_cwd-1204"><a href="#SMBSession.set_cwd-1204"><span class="linenos">1204</span></a><span class="sd">        Parameters:</span>
</span><span id="SMBSession.set_cwd-1205"><a href="#SMBSession.set_cwd-1205"><span class="linenos">1205</span></a><span class="sd">            path (str): The path to set as the current working directory.</span>
</span><span id="SMBSession.set_cwd-1206"><a href="#SMBSession.set_cwd-1206"><span class="linenos">1206</span></a>
</span><span id="SMBSession.set_cwd-1207"><a href="#SMBSession.set_cwd-1207"><span class="linenos">1207</span></a><span class="sd">        Raises:</span>
</span><span id="SMBSession.set_cwd-1208"><a href="#SMBSession.set_cwd-1208"><span class="linenos">1208</span></a><span class="sd">            ValueError: If the specified path is not a directory.</span>
</span><span id="SMBSession.set_cwd-1209"><a href="#SMBSession.set_cwd-1209"><span class="linenos">1209</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SMBSession.set_cwd-1210"><a href="#SMBSession.set_cwd-1210"><span class="linenos">1210</span></a>
</span><span id="SMBSession.set_cwd-1211"><a href="#SMBSession.set_cwd-1211"><span class="linenos">1211</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SMBSession.set_cwd-1212"><a href="#SMBSession.set_cwd-1212"><span class="linenos">1212</span></a>            <span class="c1"># Set path separators to ntpath sep </span>
</span><span id="SMBSession.set_cwd-1213"><a href="#SMBSession.set_cwd-1213"><span class="linenos">1213</span></a>            <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="SMBSession.set_cwd-1214"><a href="#SMBSession.set_cwd-1214"><span class="linenos">1214</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
</span><span id="SMBSession.set_cwd-1215"><a href="#SMBSession.set_cwd-1215"><span class="linenos">1215</span></a>
</span><span id="SMBSession.set_cwd-1216"><a href="#SMBSession.set_cwd-1216"><span class="linenos">1216</span></a>            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">):</span>
</span><span id="SMBSession.set_cwd-1217"><a href="#SMBSession.set_cwd-1217"><span class="linenos">1217</span></a>                <span class="c1"># Absolute path</span>
</span><span id="SMBSession.set_cwd-1218"><a href="#SMBSession.set_cwd-1218"><span class="linenos">1218</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span>
</span><span id="SMBSession.set_cwd-1219"><a href="#SMBSession.set_cwd-1219"><span class="linenos">1219</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.set_cwd-1220"><a href="#SMBSession.set_cwd-1220"><span class="linenos">1220</span></a>                <span class="c1"># Relative path to the CWD</span>
</span><span id="SMBSession.set_cwd-1221"><a href="#SMBSession.set_cwd-1221"><span class="linenos">1221</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SMBSession.set_cwd-1222"><a href="#SMBSession.set_cwd-1222"><span class="linenos">1222</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span>
</span><span id="SMBSession.set_cwd-1223"><a href="#SMBSession.set_cwd-1223"><span class="linenos">1223</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.set_cwd-1224"><a href="#SMBSession.set_cwd-1224"><span class="linenos">1224</span></a>                    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">+</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">path</span>
</span><span id="SMBSession.set_cwd-1225"><a href="#SMBSession.set_cwd-1225"><span class="linenos">1225</span></a>            
</span><span id="SMBSession.set_cwd-1226"><a href="#SMBSession.set_cwd-1226"><span class="linenos">1226</span></a>            <span class="c1"># Path normalization</span>
</span><span id="SMBSession.set_cwd-1227"><a href="#SMBSession.set_cwd-1227"><span class="linenos">1227</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession.set_cwd-1228"><a href="#SMBSession.set_cwd-1228"><span class="linenos">1228</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">+&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession.set_cwd-1229"><a href="#SMBSession.set_cwd-1229"><span class="linenos">1229</span></a>
</span><span id="SMBSession.set_cwd-1230"><a href="#SMBSession.set_cwd-1230"><span class="linenos">1230</span></a>            <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">]:</span>
</span><span id="SMBSession.set_cwd-1231"><a href="#SMBSession.set_cwd-1231"><span class="linenos">1231</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="SMBSession.set_cwd-1232"><a href="#SMBSession.set_cwd-1232"><span class="linenos">1232</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.set_cwd-1233"><a href="#SMBSession.set_cwd-1233"><span class="linenos">1233</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_isdir</span><span class="p">(</span><span class="n">pathFromRoot</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">ntpath</span><span class="o">.</span><span class="n">sep</span><span class="p">)):</span>
</span><span id="SMBSession.set_cwd-1234"><a href="#SMBSession.set_cwd-1234"><span class="linenos">1234</span></a>                    <span class="c1"># Path exists on the remote </span>
</span><span id="SMBSession.set_cwd-1235"><a href="#SMBSession.set_cwd-1235"><span class="linenos">1235</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">smb_cwd</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="SMBSession.set_cwd-1236"><a href="#SMBSession.set_cwd-1236"><span class="linenos">1236</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SMBSession.set_cwd-1237"><a href="#SMBSession.set_cwd-1237"><span class="linenos">1237</span></a>                    <span class="c1"># Path does not exists or is not a directory on the remote </span>
</span><span id="SMBSession.set_cwd-1238"><a href="#SMBSession.set_cwd-1238"><span class="linenos">1238</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[!] Remote directory &#39;</span><span class="si">%s</span><span class="s2">&#39; does not exist.&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sets the current working directory on the SMB share to the specified path.</p>

<p>This method updates the current working directory (cwd) of the SMB session to the given path if it is a valid directory.
If the specified path is not a directory, the cwd remains unchanged.</p>

<p>Parameters:
    path (str): The path to set as the current working directory.</p>

<p>Raises:
    ValueError: If the specified path is not a directory.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>